<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>PIDæ³¢å½¢ç»˜åˆ¶åŠç§¯åˆ†ä¼˜åŒ–</title>
      <link href="/2022/11/26/PID%E6%B3%A2%E5%BD%A2%E7%BB%98%E5%88%B6%E5%8F%8A%E7%A7%AF%E5%88%86%E4%BC%98%E5%8C%96/"/>
      <url>/2022/11/26/PID%E6%B3%A2%E5%BD%A2%E7%BB%98%E5%88%B6%E5%8F%8A%E7%A7%AF%E5%88%86%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="MATLABä¸²å£ç»˜åˆ¶æ³¢å½¢"><a href="#MATLABä¸²å£ç»˜åˆ¶æ³¢å½¢" class="headerlink" title="MATLABä¸²å£ç»˜åˆ¶æ³¢å½¢"></a>MATLABä¸²å£ç»˜åˆ¶æ³¢å½¢</h2><p>â€‹    å¯¹äº<strong>MATLAB</strong>æˆ‘ä¹Ÿæ˜¯ä¹…ä»°å¤§åï¼Œæœ€è¿‘å®‰è£…äº†ä¸€ä¸ªï¼Œæ„Ÿè§‰åŠŸèƒ½å¾ˆä¸°å¯Œï¼Œä¹Ÿæ¯”è¾ƒæœ‰æ„æ€ã€‚å½“ç„¶æœ¬äººä¹Ÿæ˜¯åˆšå®‰è£…<strong>MABLAB</strong>ä¸ä¹…ï¼Œå¯¹å…¶ç†è§£è¿˜æ˜¯åˆ†æµ…è–„ï¼Œæš‚æ—¶ä¹Ÿåªæ˜¯ä¸€äº›ç®€å•çš„ä½¿ç”¨ã€‚</p><h3 id="å‡½æ•°è¯´æ˜"><a href="#å‡½æ•°è¯´æ˜" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><div class="note pink icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><h4 id="plot-äºŒç»´ç»˜å›¾"><a href="#plot-äºŒç»´ç»˜å›¾" class="headerlink" title="plot( ) äºŒç»´ç»˜å›¾"></a>plot( ) äºŒç»´ç»˜å›¾</h4><p><a href="https://ww2.mathworks.cn/help/matlab/ref/plot.html">äºŒç»´çº¿å›¾ - MATLAB plot - MathWorks ä¸­å›½</a></p><h4 id="axis-æ˜¾ç¤ºèŒƒå›´"><a href="#axis-æ˜¾ç¤ºèŒƒå›´" class="headerlink" title="axis( ) æ˜¾ç¤ºèŒƒå›´"></a>axis( ) æ˜¾ç¤ºèŒƒå›´</h4><p><a href="https://blog.csdn.net/youshijian99/article/details/80842218">(15æ¡æ¶ˆæ¯) Matlab axiså‡½æ•°_GeekçŒ«çš„åšå®¢-CSDNåšå®¢_matlab axis</a></p><h4 id="grid-æ …æ ¼"><a href="#grid-æ …æ ¼" class="headerlink" title="grid æ …æ ¼"></a>grid æ …æ ¼</h4><p><a href="https://www.mathworks.com/help/matlab/ref/grid.html">Display or hide axes grid lines - MATLAB grid (mathworks.com)</a></p></div><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>æ–°å»ºå‡½æ•°æ–‡ä»¶â€”â€”<strong>Serial.m</strong></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Serial</span><span class="params">()</span>   %åˆ›å»ºå‡½æ•°</span></span><br><span class="line">delete(instrfindall);   <span class="comment">%å…ˆå…³é—­ä¸²å£ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å‡ºé”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> x            <span class="comment">%å…¨å±€å˜é‡ï¼Œä¾›ä¸²å£ä¸­æ–­å‡½æ•°ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">global</span> t;<span class="comment">%å…¨å±€å˜é‡ï¼Œè¿™é‡Œæ ¹æ®éœ€è¦ç»˜åˆ¶å›¾å½¢çš„ä¸ªäººéœ€è¦è€Œè®¾</span></span><br><span class="line"><span class="keyword">global</span> m;</span><br><span class="line"><span class="keyword">global</span> <span class="built_in">i</span>;</span><br><span class="line"></span><br><span class="line">t = [<span class="number">0</span>];      <span class="comment">%æ—¶é—´è½´</span></span><br><span class="line">m = [<span class="number">0</span>];      <span class="comment">%æ•°æ®è½´</span></span><br><span class="line"><span class="built_in">i</span> = <span class="number">0</span>;        <span class="comment">%ç”¨äºè®¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%ä¸²å£å‚æ•°é…ç½®</span></span><br><span class="line">x = serial(<span class="string">&#x27;com3&#x27;</span>);</span><br><span class="line">set(x,<span class="string">&#x27;BaudRate&#x27;</span>,<span class="number">115200</span>);</span><br><span class="line">set(x,<span class="string">&#x27;BytesAvailableFcnMode&#x27;</span>,<span class="string">&#x27;Terminator&#x27;</span>) <span class="comment">%ASCIIè§¦å‘ï¼Œå­—ç¬¦è§¦å‘</span></span><br><span class="line">set(x,<span class="string">&#x27;Terminator&#x27;</span>,<span class="string">&#x27;CR/LF&#x27;</span>)         <span class="comment">%æ¥æ”¶åˆ°\r\nåè§¦å‘ä¸­æ–­</span></span><br><span class="line">x.BytesAvailableFcn = @Callback  <span class="comment">%å®šä¹‰ä¸­æ–­å“åº”å‡½æ•°å¯¹è±¡ï¼Œç±»ä¼¼äºä¸­æ–­å‡½æ•°å</span></span><br><span class="line">fopen(x);</span><br><span class="line">pause</span><br><span class="line">fclose(x);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦å»ºå›è°ƒå‡½æ•°æ–‡ä»¶<strong>Callback.m</strong></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Callback</span><span class="params">(obj,event)</span>   %åˆ›å»ºä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œç»˜åˆ¶å›¾åƒ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> t; <span class="comment">%æ—¶é—´</span></span><br><span class="line"><span class="keyword">global</span> m; <span class="comment">%çºµåæ ‡</span></span><br><span class="line"><span class="keyword">global</span> <span class="built_in">i</span>; <span class="comment">%æ—¶é—´å˜åŒ–å€¼</span></span><br><span class="line"></span><br><span class="line">    out = fscanf(obj);</span><br><span class="line">    data = str2num(out)<span class="comment">%å°†æ¥æ”¶åˆ°çš„å­—ç¬¦è½¬æ¢ä¸ºæ•°å€¼</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">%%----------------------ä»¥ä¸‹æ ¹æ®éœ€è¦è‡ªè¡Œç¼–å†™-------------------------------</span></span><br><span class="line">    t = [t <span class="built_in">i</span>];</span><br><span class="line">    m = [m data];</span><br><span class="line">    <span class="built_in">plot</span>(t,m)</span><br><span class="line">    xlabel(<span class="string">&#x27;t&#x27;</span>);</span><br><span class="line">    ylabel(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line">    axis([<span class="built_in">i</span><span class="number">-50</span> <span class="built_in">i</span>+<span class="number">50</span> <span class="number">0</span> <span class="number">1000</span>]);</span><br><span class="line">    grid on;</span><br><span class="line">    <span class="built_in">i</span>=<span class="built_in">i</span>+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ ·å¼é¢„è§ˆ"><a href="#æ ·å¼é¢„è§ˆ" class="headerlink" title="æ ·å¼é¢„è§ˆ"></a>æ ·å¼é¢„è§ˆ</h3><p>å¯ä»¥å‚è€ƒä¸‹æ–‡ã€‚</p><h2 id="ç§¯åˆ†ä¼˜åŒ–"><a href="#ç§¯åˆ†ä¼˜åŒ–" class="headerlink" title="ç§¯åˆ†ä¼˜åŒ–"></a>ç§¯åˆ†ä¼˜åŒ–</h2><h3 id="æ¢¯å½¢ç§¯åˆ†PID"><a href="#æ¢¯å½¢ç§¯åˆ†PID" class="headerlink" title="æ¢¯å½¢ç§¯åˆ†PID"></a>æ¢¯å½¢ç§¯åˆ†PID</h3><p>â€‹    ä»å¾®ç§¯åˆ†çš„è§’åº¦æ¥è¯´ï¼Œå½“å¾®åˆ†åˆ°æ— é™å°æ—¶ï¼ŒçŸ©å½¢ç§¯åˆ†ä¸æ¢¯å½¢ç§¯åˆ†æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚ä½†æ˜¯å®é™…ä¸Šé‡‡æ ·æ—¶é—´ä¸å¯èƒ½æ— ç©·å°ï¼Œé‡‡æ ·å‘¨æœŸè¶Šå¤§ï¼Œåå·®å°±è¶Šå¤§ã€‚è€Œæ¢¯å½¢ç§¯åˆ†åˆ™æ˜¯æ›´åŠ æ¥è¿‘å®é™…æ›²çº¿ï¼Œæ‰€ä»¥ç”¨æ¢¯å½¢ç§¯åˆ†å¯ä»¥å¾—åˆ°æ›´é«˜çš„ç²¾åº¦ã€‚</p><script type="math/tex; mode=display">\int _0^t e(t) \mathrm{d} t = \sum_{i=0}^t \frac{e(i) + e(i-1)}{2}</script><h3 id="ç§¯åˆ†åˆ†ç¦»PID"><a href="#ç§¯åˆ†åˆ†ç¦»PID" class="headerlink" title="ç§¯åˆ†åˆ†ç¦»PID"></a>ç§¯åˆ†åˆ†ç¦»PID</h3><p>åœ¨æ™®é€šçš„PIDæ§åˆ¶ç®—æ³•ä¸­ï¼Œç”±äºç§¯åˆ†ç³»æ•°æ˜¯å¸¸æ•°ï¼Œæ‰€ä»¥åœ¨æ•´ä¸ªæ§åˆ¶è¿‡ç¨‹ä¸­ï¼Œç§¯åˆ†å¢é‡ä¸å˜ã€‚è€Œç³»ç»Ÿå¯¹ç§¯åˆ†é¡¹çš„è¦æ±‚æ˜¯ï¼š<emp>ç³»ç»Ÿåå·®å¤§æ—¶ç§¯åˆ†å‡å¼±ç”šè‡³å…¨æ— ï¼Œåå·®å°æ—¶ç§¯ åˆ†åŠ å¼ºã€‚</emp>ç§¯åˆ†ç³»æ•°å¤§äº†ä¼šäº§ç”Ÿè¶…è°ƒï¼Œå°äº†åˆä¸èƒ½æ¶ˆé™¤é™å·®ã€‚å˜é€Ÿç§¯åˆ†PIDå¯ä»¥æ ¹æ®<strong>ç³»ç»Ÿåå·®å¤§å°</strong>æ”¹å˜ç§¯åˆ†çš„é€Ÿåº¦ã€‚<br>    åœ¨æ™®é€šçš„PIDæ§åˆ¶ç®—æ³•ä¸­ï¼Œå¼•å…¥ç§¯åˆ†ç¯èŠ‚ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†æ¶ˆé™¤é™å·®ã€‚<emp>ä½†åœ¨è¿‡ç¨‹çš„å¯åŠ¨ã€ç»“æŸæˆ–å¤§å¹…åº¦å¢å‡è®¾å®šæ—¶ï¼ŒçŸ­æ—¶é—´å†…ç³»ç»Ÿè¾“å‡ºæœ‰å¾ˆå¤§çš„åå·®ï¼Œ</emp>ä¼šé€ æˆPIDè¿ç®—çš„ç§¯åˆ†ç§¯ç´¯ï¼Œä½¿æ§åˆ¶é‡è¶…è¿‡å¯èƒ½å…è®¸çš„æœ€å¤§åŠ¨ä½œèŒƒå›´å¯¹åº”çš„æé™æ§åˆ¶é‡ï¼Œå¼•èµ·ç³»ç»Ÿè¾ƒå¤§çš„è¶…è°ƒï¼Œç”šè‡³å¼•èµ·è¾ƒå¤§çš„æŒ¯è¡ã€‚ç§¯åˆ†åˆ†ç¦»PIDå¯ä»¥è¾ƒå¥½åœ°è§£å†³è¿™â¼€é—®é¢˜ã€‚</p><h4 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>â€‹    æ€è·¯æ˜¯åå·®å€¼è¾ƒå¤§æ—¶ï¼Œå–æ¶ˆç§¯åˆ†ä½œç”¨ï¼Œä»¥å…è¶…è°ƒé‡å¢å¤§ï¼›è€Œåå·®å€¼è¾ƒå°æ—¶ï¼Œå¼•å…¥ç§¯åˆ†ä½œç”¨ï¼Œä»¥ä¾¿æ¶ˆé™¤é™å·®ï¼Œæâ¾¼æ§åˆ¶ç²¾åº¦ã€‚<br>å…·ä½“çš„å®ç°æ­¥éª¤æ˜¯ï¼šæ ¹æ®å®é™…æƒ…å†µï¼Œè®¾å®šâ¼€ä¸ªé˜ˆå€¼</p><ul><li>å½“åå·®å¤§äºé˜ˆå€¼æ—¶ï¼Œæ¶ˆé™¤ç§¯åˆ†ä»…ç”¨PDæ§åˆ¶ï¼›</li><li>å½“åå·®å°äºç­‰äºé˜ˆå€¼æ—¶ï¼Œå¼•â¼Šç§¯åˆ†é‡‡â½¤PIDæ§åˆ¶ã€‚</li></ul><h4 id="ç§¯åˆ†é¡¹è¡¨è¾¾å¼"><a href="#ç§¯åˆ†é¡¹è¡¨è¾¾å¼" class="headerlink" title="ç§¯åˆ†é¡¹è¡¨è¾¾å¼"></a>ç§¯åˆ†é¡¹è¡¨è¾¾å¼</h4><script type="math/tex; mode=display">U_i(k) = \beta K_i\sum_{j=0}^{k-1}e(j)</script><p>å…¶ä¸­<em>Î²</em>ç§°ä¸º<strong>ç§¯åˆ†å¼€å…³ç³»æ•°</strong></p><script type="math/tex; mode=display">\beta = \begin{cases}1, & |e(k)| \leq \varepsilon \\ 0, & |e(k)| > \varepsilon\end{cases}</script><p>ç”±ä¸Šè¿°è¡¨è¿°åŠå…¬å¼æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç§¯åˆ†åˆ†ç¦»ç®—æ³•çš„æ•ˆæœå…¶å®ä¸<strong>Îµ</strong>å€¼çš„é€‰å–æœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œæ‰€ä»¥Îµå€¼çš„é€‰å–æ˜¯å®ç°çš„éš¾ç‚¹</p><ul><li><p>Îµå€¼è¿‡å¤§åˆ™è¾¾ä¸åˆ°ç§¯åˆ†åˆ†ç¦»çš„æ•ˆæœ</p></li><li><p>Îµå€¼è¿‡å°åˆ™éš¾ä»¥è¿›å…¥ç§¯åˆ†åŒºã€‚</p></li></ul><h3 id="å˜é€Ÿç§¯åˆ†PID"><a href="#å˜é€Ÿç§¯åˆ†PID" class="headerlink" title="å˜é€Ÿç§¯åˆ†PID"></a>å˜é€Ÿç§¯åˆ†PID</h3><h4 id="åŸºæœ¬æ€æƒ³-1"><a href="#åŸºæœ¬æ€æƒ³-1" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>å˜é€Ÿç§¯åˆ†PIDçš„åŸºæœ¬æ€æƒ³æ˜¯<emp>è®¾æ³•æ”¹å˜ç§¯åˆ†é¡¹çš„ç´¯åŠ é€Ÿåº¦ï¼Œä½¿å…¶ä¸åå·®å¤§å°ç›¸å¯¹åº”ã€‚</emp></p><ul><li>åå·®è¶Šå¤§ï¼Œç§¯åˆ†è¶Šæ…¢ï¼›</li><li>åå·®è¶Šå°åˆ™è¶Šå¿«ã€‚</li></ul><p>ä¸ºæ­¤ï¼Œè®¾ç½®ç³»æ•°<strong>f(e(k))</strong> ï¼Œå®ƒæ˜¯<strong>e(k)</strong>çš„å‡½æ•°ã€‚å½“<strong>e(k)</strong>å¢å¤§æ—¶ï¼Œ <strong>f</strong>å‡å°ï¼Œåä¹‹å¢å¤§ã€‚</p><h4 id="ç§¯åˆ†é¡¹è¡¨è¾¾å¼-1"><a href="#ç§¯åˆ†é¡¹è¡¨è¾¾å¼-1" class="headerlink" title="ç§¯åˆ†é¡¹è¡¨è¾¾å¼"></a>ç§¯åˆ†é¡¹è¡¨è¾¾å¼</h4><script type="math/tex; mode=display">U_i(k) = K_i[\sum_{j=0}^{k-1} + f(e(k))*e(k) ]</script><p><strong>f(e(k))</strong>å¯æ ¹æ®å…·ä½“æƒ…å†µè®¾å®šï¼Œæ¯”è¾ƒç®€å•çš„è®¾ç½®ä¸ºï¼š</p><script type="math/tex; mode=display">f(e(k)) = \begin{cases}1, & |e(k)| \leq B \\\frac{A - |e(k)| + B}{A}, & B < |e(k)| \leq A + B \\0, & |e(k)| > A + B\end{cases}</script><p>ç”±ä¸Šè¿°å…¬å¼å¯çŸ¥ï¼Œ<strong>f(e(k))</strong>çš„å€¼åœ¨[0,1]åŒºé—´å˜åŒ–ã€‚</p><ul><li><p>å½“åå·®å€¼<strong>e(k)</strong>å¤§äºåˆ†ç¦»åŒºé—´<strong>A + B</strong>æ—¶ï¼Œä¸å¯¹å½“å‰<strong>e(k)</strong>è¿›è¡Œç´¯åŠ ï¼›</p></li><li><p>å½“åå·®å€¼<strong>e(k)</strong>å°äº<strong>B</strong>æ—¶ï¼ŒåŠ å…¥å½“å‰åå·®<strong>e(k)</strong>è¿›è¡Œç´¯åŠ ï¼›</p></li><li><p>ä»‹äº<strong>B</strong>å’Œ<strong>A + B</strong>ä¹‹é—´æ—¶ï¼ŒæŒ‰ä¸€å®šå‡½æ•°å…³ç³»å˜åŒ–ã€‚</p></li></ul><p>è¿™ç§ç®—æ³•å¯¹Aï¼ŒBä¸¤ä¸ªå‚æ•°çš„è¦æ±‚ä¸ç²¾ç¡®ï¼Œå‚æ•°æ•´å®šè¾ƒå®¹æ˜“ã€‚ </p><h4 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">PID_t</span>&#123;</span></span><br><span class="line">    <span class="type">float</span> target;</span><br><span class="line">    <span class="type">float</span> actual;</span><br><span class="line">    <span class="type">float</span> dead_zone;</span><br><span class="line">    <span class="type">float</span> Kp, Ki, Kd;</span><br><span class="line">    <span class="type">float</span> last_error, pre_error, sum_error;</span><br><span class="line">    <span class="type">float</span> I_MAX;</span><br><span class="line">    <span class="type">float</span> P_out, I_out, D_out, D_last_out;</span><br><span class="line">    <span class="type">float</span> out_MAX, out, out_last;</span><br><span class="line">    <span class="type">float</span> I_up, I_low;</span><br><span class="line">    <span class="type">float</span> RC_DF;</span><br><span class="line">&#125;PID_t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ABS(p-&gt;pre_error) &lt; P-&gt;I_low)</span><br><span class="line">&#123;</span><br><span class="line">    p-&gt;sum_error += (p-&gt;pre_error + p-&gt;last_error)/<span class="number">2</span>;</span><br><span class="line">    p-&gt;sum_error = limit(p-&gt;sum_error, p-&gt;I_MAX, -p-&gt;I_MAX);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(ABS(p-&gt;pre_error) &lt; p-&gt;I_up)</span><br><span class="line">&#123;</span><br><span class="line">    p-&gt;sum_error += ((ABS(p-&gt;pre_error) - p-&gt;I_low)/(p-&gt;I_up - p-&gt;I_low)) * ((p-&gt;last_error + p-&gt;pre_error)/<span class="number">2</span>);</span><br><span class="line">    p-&gt;sum_error = limit(p-&gt;sum_error, p-&gt;I_MAX, -p-&gt;I_MAX);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶å®šä¹‰çš„æ˜¯<strong>I_up,I_low</strong>, ä½†æ˜¯å®é™…ä¸Šè¿™æ˜¯ä¸<strong>error</strong>ç›¸æ¯”è¾ƒçš„</p><h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h2><p>Kp = 350<img src="https://s2.loli.net/2022/11/27/JFxsQNWeq4nuVEP.png" alt="Kp350.png"></p><p>ki = 120</p><p><img src="https://s2.loli.net/2022/11/27/zjaUvYJpVNBcbif.png" alt="Kp350Ki120.png"></p><p>Kd = 100</p><p><img src="https://s2.loli.net/2022/11/27/rZwV9psKjQ8toIJ.png" alt="Kd80.png"></p><p>Kd = 80, up = 80, low = 50</p><p><img src="https://s2.loli.net/2022/11/27/RsTAucIzvqlJtpk.png" alt="up80low50.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ§åˆ¶æ–¹æ³• </tag>
            
            <tag> PID </tag>
            
            <tag> MATLAB </tag>
            
            <tag> USART </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D-Hå‚æ•°æ³•ä¸æœºæ¢°è‡‚æ­£é€†è§£</title>
      <link href="/2022/11/20/D-H%E5%8F%82%E6%95%B0%E6%B3%95%E6%9C%BA%E6%A2%B0%E8%87%82%E6%AD%A3%E9%80%86%E8%A7%A3/"/>
      <url>/2022/11/20/D-H%E5%8F%82%E6%95%B0%E6%B3%95%E6%9C%BA%E6%A2%B0%E8%87%82%E6%AD%A3%E9%80%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="D-Hå‚æ•°æ³•"><a href="#D-Hå‚æ•°æ³•" class="headerlink" title="D-Hå‚æ•°æ³•"></a>D-Hå‚æ•°æ³•</h1><div class="note pink icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><a href="https://blog.csdn.net/maple_2014/article/details/105612912">(14æ¡æ¶ˆæ¯) ä¸€æ–‡å¸¦ä½ å®Œå…¨æŒæ¡æœºå™¨äººDHå‚æ•°å»ºæ¨¡(è¯¦ç»†æ­¥éª¤+å®ä¾‹+ä»£ç )_Marc Ponyçš„åšå®¢-CSDNåšå®¢_dhå»ºæ¨¡</a></p></div><h2 id="åæ ‡å˜æ¢çŸ©é˜µ"><a href="#åæ ‡å˜æ¢çŸ©é˜µ" class="headerlink" title="åæ ‡å˜æ¢çŸ©é˜µ"></a>åæ ‡å˜æ¢çŸ©é˜µ</h2><div class="note pink icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><a href="https://blog.csdn.net/weixin_44097528/article/details/122182393">(14æ¡æ¶ˆæ¯) è¯¦è§£åæ ‡å˜æ¢çŸ©é˜µ_Akinazeçš„åšå®¢-CSDNåšå®¢_åæ ‡å˜æ¢çŸ©é˜µ</a></p></div><h2 id="D-Hå‚æ•°"><a href="#D-Hå‚æ•°" class="headerlink" title="D-Hå‚æ•°"></a>D-Hå‚æ•°</h2><p>â€‹    ä¸€èˆ¬æ¥è¯´ï¼Œæƒ³è¦å¾—åˆ°ä¸¤ä¸ªåæ ‡ç³»ä¹‹é—´çš„å˜æ¢çŸ©é˜µï¼Œéœ€è¦çŸ¥é“å…­ä¸ªé‡ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨<strong>D-H</strong>å‚æ•°æ³•æ—¶ï¼Œéœ€è¦æŒ‰ç…§ç‰¹å®šæ–¹å¼å»ºç«‹åæ ‡ç³»ï¼Œä¾æ‰˜äºè¿™äº›<em>â€œå‰æçº¦æŸâ€</em>ï¼Œæˆ‘ä»¬åªéœ€è¦4ä¸ªå‚æ•°ä¾¿å¯ä»¥å¾—å‡ºä¸¤åæ ‡ç³»ä¹‹é—´çš„å˜æ¢çŸ©é˜µã€‚</p><p>å…ˆè¦ç†è§£åæ ‡ç³»çš„<strong>å»ºç«‹è§„å®š</strong></p><blockquote><ul><li><p><strong>zè½´</strong>çš„æ–¹å‘å‚ç›´äºæ—‹è½¬é¢ï¼Œå³ä¸º<strong>è½¬è½´</strong>;</p></li><li><p><strong>x[i]</strong>æ–¹å‘çš„ç¡®å®šï¼šåŒæ—¶å‚ç›´äºz[i]ä¸z[i-1];</p></li></ul></blockquote><p>ä¾æ®è¿™æ ·çš„è§„å®šï¼Œå¯ä»¥å‘ç°ï¼š</p><blockquote><ul><li><p>z[i-1]<strong>åŒæ—¶å‚ç›´</strong>äºx[i-1]ä¸x[i];</p></li><li><p>x[i]<strong>åŒæ—¶å‚ç›´</strong>äºz[i-1]ä¸z[i];</p></li></ul></blockquote><p>ç”±æ­¤ï¼Œ<strong>z[i-1]å’Œx[i]</strong>ä¾¿æˆäº†è¿æ¥åæ ‡ç³»[i-1]å’Œåæ ‡ç³»[i]çš„é‡è¦å‚è€ƒã€‚å†çœ‹å››ä¸ªå‚æ•°çš„å®šä¹‰</p><div class="note blue icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><ul><li><strong>d[i]</strong>:åæ ‡è½´x[i-1]ä¸åæ ‡è½´x[i]æ²¿ç€<strong>z[i-1]</strong>çš„æœ‰å‘è·ç¦»ï¼›</li><li><strong>Î¸[i]</strong>:åæ ‡è½´x[i-1]ä¸åæ ‡è½´x[i]ä»¥<strong>z[i-1]</strong>ä¸ºè½¬è½´çš„æ—‹è½¬è§’(é€†æ—¶é’ˆï¼Œxiåœ¨å‰ä¸ºæ­£ï¼Œæˆ–è€…è¯´ä»x0è½¬åˆ°x1çš„è§’åº¦)ï¼›</li><li><strong>a[i]</strong>:åæ ‡è½´z[i-1]ä¸åæ ‡è½´z[i]æ²¿ç€<strong>x[i]</strong>çš„æœ‰å‘è·ç¦»ï¼›</li><li><strong>Î±[i]</strong>:åæ ‡è½´z[i-1]ä¸åæ ‡è½´z[i]ä»¥<strong>x[i]</strong>ä¸ºè½¬è½´çš„æ—‹è½¬è§’ï¼›</li></ul></div><h2 id="æ­£å‘æ±‚è§£"><a href="#æ­£å‘æ±‚è§£" class="headerlink" title="æ­£å‘æ±‚è§£"></a>æ­£å‘æ±‚è§£</h2><p>åœ¨å·²çŸ¥å„å…³èŠ‚è§’åº¦çš„æ¡ä»¶ä¸‹ï¼Œæ±‚å‡ºæœºæ¢°è‡‚æœ«ç«¯çš„åæ ‡ã€‚</p><p>ç”±<strong>D-H</strong>å‚æ•°å¯ä»¥å¾—åˆ°åæ ‡ç³»å˜æ¢çŸ©é˜µï¼ˆå°†å…¶è®°ä½œ<strong>$T_i$</strong>ï¼‰ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}x_{i-1} \\ y_{i-1} \\ z_{i-1} \\ 1\end{bmatrix}= \begin{bmatrix} \cos{Î¸_i} & -\sin{Î¸_i} \cos{\alpha_i} & \sin{Î¸_i}\sin{\alpha_i} & a_i\cos{Î¸_i} \\\sin{Î¸_i} & \cos{Î¸_i} \cos{\alpha_i} & -\cos{Î¸_i}\sin{\alpha_i} & a_i\sin{Î¸_i} \\ 0 & \sin{\alpha_i} & \cos{\alpha_i} & d_i \\ 0 & 0 & 0 & 1\end{bmatrix}\begin{bmatrix}x_{i} \\ y_{i} \\z_{i} \\ 1\end{bmatrix}</script><p>â€‹    ä»£å…¥<strong>i</strong>ç³»çš„ç‚¹$(x_i,y_i,z_i)$ï¼Œå·¦ä¹˜å˜æ¢çŸ©é˜µ$T_i$ï¼Œå¾—åˆ°è¿™ä¸ªç‚¹åœ¨<strong>i-1</strong>ç³»çš„åæ ‡ã€‚ç”±æ­¤ï¼Œå°†æœ«ç«¯åæ ‡$C_n$ä¸æ–­å·¦ä¹˜å„å˜æ¢çŸ©é˜µï¼Œä¾¿å¯ä»¥é€’æ¨å‡ºå…¶åœ¨ç¬¬ä¸€ä¸ªåæ ‡ç³»çš„åæ ‡$C_0$ã€‚</p><script type="math/tex; mode=display">C_0 = T_1 T_2 \cdots T_{n-1} T_n C_n</script><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>ä¸»è¦å°±æ˜¯ä¸¤ä¸ªéƒ¨åˆ†</p><blockquote><ul><li>çŸ©é˜µ<strong>Matrix</strong>çš„æ„å»ºåŠå…¶è¿ç®—</li><li>æœºæ¢°è‡‚<strong>robotic_arm</strong>çš„æ„å»ºåŠåŸºæœ¬åŠŸèƒ½</li></ul></blockquote><p>â€‹    éƒ½æ˜¯ç›´æ¥æ¨¡æ‹Ÿæ‰‹ç®—è¿‡ç¨‹ï¼ŒçŸ©é˜µç›¸ä¹˜çš„æ—¶é—´å¤æ‚åº¦æ˜¯<strong>O(mnk)</strong>ï¼Œä¸‰æ¬¡æ–¹é‡çº§çš„ï¼Œå¥½åœ¨çŸ©é˜µè§„æ¨¡éƒ½æ¯”è¾ƒå°ã€‚</p><h4 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">Matrix_t</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> m;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">double</span> matrix[Matrix_MX][Matrix_MX];</span><br><span class="line">&#125;Matrix_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief </span></span><br><span class="line"><span class="comment"> * @param</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">robotic_arm_t</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> n;<span class="comment">//number of nodes</span></span><br><span class="line">    <span class="type">float</span> d[arm_MX_nodes],a[arm_MX_nodes];</span><br><span class="line">    <span class="type">double</span> theta[arm_MX_nodes],alpha[arm_MX_nodes];</span><br><span class="line">    Matrix_t *T[arm_MX_nodes];</span><br><span class="line"></span><br><span class="line">&#125;<span class="type">robotic_arm_t</span>;</span><br></pre></td></tr></table></figure><h4 id="æœºæ¢°è‡‚åˆå§‹åŒ–"><a href="#æœºæ¢°è‡‚åˆå§‹åŒ–" class="headerlink" title="æœºæ¢°è‡‚åˆå§‹åŒ–"></a>æœºæ¢°è‡‚åˆå§‹åŒ–</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief </span></span><br><span class="line"><span class="comment"> * @param n the number of the nodes</span></span><br><span class="line"><span class="comment"> * @param d D-H parameters</span></span><br><span class="line"><span class="comment"> * @param a D-H parameters</span></span><br><span class="line"><span class="comment"> * @param theta D-H parameters</span></span><br><span class="line"><span class="comment"> * @param alpha D-H parameters</span></span><br><span class="line"><span class="comment"> * @return robotic_arm_t* </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">robotic_arm_t</span> *<span class="title function_">robotic_arm_init</span><span class="params">(<span class="type">int</span> n, <span class="type">float</span> *d, <span class="type">float</span> *a, <span class="type">double</span> *theta, <span class="type">double</span> *alpha)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">robotic_arm_t</span> *arm;</span><br><span class="line">    arm = (<span class="type">robotic_arm_t</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">robotic_arm_t</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    arm-&gt;T[i] = (Matrix_t*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Matrix_t));</span><br><span class="line"></span><br><span class="line">    arm-&gt;n = n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        arm-&gt;d[i] = d[i];</span><br><span class="line">        arm-&gt;a[i] = a[i];</span><br><span class="line">        arm-&gt;alpha[i] = alpha[i];</span><br><span class="line">        arm-&gt;theta[i] = theta[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get_Trans(arm);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> arm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œæ„å»ºçš„æ¨¡å‹</p><p><img src="https://s2.loli.net/2022/11/23/FJehTzpxDroZPBg.jpg" alt="robotic_arm.jpg" style="zoom:50%;" /></p><div class="table-container"><table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>d</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>Î¸</td><td>0</td><td>$\omega_0$</td><td>-$\omega_1$</td><td>$\frac{\Pi}{2} - \omega_2$</td></tr><tr><td>Î±</td><td>0</td><td>$-\frac{\Pi}{2}$</td><td>0</td><td>0</td></tr><tr><td>a</td><td>0</td><td>0</td><td>10</td><td>10</td></tr></tbody></table></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> test_d[<span class="number">4</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,test_a[<span class="number">4</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">10</span>&#125;;</span><br><span class="line"><span class="type">double</span> test_theta[<span class="number">4</span>]=&#123;<span class="number">0</span>&#125;,test_alpha[<span class="number">4</span>]=&#123;<span class="number">0</span>,-PI/<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">test_arm = robotic_arm_init(<span class="number">3</span>,test_d,test_a,test_theta,test_alpha);</span><br></pre></td></tr></table></figure><p>$\omega$ä¸ºå…³èŠ‚ï¼ˆèˆµæœºï¼‰è§’åº¦ï¼Œä»¥å›¾ä¸­çŠ¶æ€ä½œä¸ºåˆå§‹å€¼ï¼Œè®¤ä¸ºæ­¤æ—¶å…³èŠ‚ï¼ˆèˆµæœºï¼‰è§’åº¦ä¸º0ã€‚æ‰€ä»¥è¿˜æœ‰ä¸€ä¸ªç”±å…³èŠ‚è§’åº¦åˆ°DHå‚æ•°çš„è½¬æ¢å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æ ¹æ®æœºæ¢°è‡‚å…·ä½“æƒ…å†µå…·ä½“ä¿®æ”¹äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DH_update</span><span class="params">(<span class="type">robotic_arm_t</span> *arm, <span class="type">double</span> *servo)</span></span><br><span class="line">&#123;</span><br><span class="line">    arm-&gt;theta[<span class="number">1</span>] =  servo[<span class="number">0</span>];</span><br><span class="line">    arm-&gt;theta[<span class="number">2</span>] = -servo[<span class="number">1</span>];</span><br><span class="line">    arm-&gt;theta[<span class="number">3</span>] =  PI/<span class="number">2</span>-servo[<span class="number">2</span>];</span><br><span class="line">    get_Trans(arm);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¡ç®—è½¬ç§»çŸ©é˜µT"><a href="#è®¡ç®—è½¬ç§»çŸ©é˜µT" class="headerlink" title="è®¡ç®—è½¬ç§»çŸ©é˜µT"></a>è®¡ç®—è½¬ç§»çŸ©é˜µT</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Get the Transparent Matrix relay on the current arm state</span></span><br><span class="line"><span class="comment"> * @param arm </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_Trans</span><span class="params">(<span class="type">robotic_arm_t</span> *arm)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=arm-&gt;n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        arm-&gt;T[i]-&gt;m=<span class="number">4</span>, arm-&gt;T[i]-&gt;n=<span class="number">4</span>;</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">0</span>][<span class="number">0</span>] =  <span class="built_in">cos</span>(arm-&gt;theta[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">0</span>][<span class="number">1</span>] = -<span class="built_in">sin</span>(arm-&gt;theta[i])*<span class="built_in">cos</span>(arm-&gt;alpha[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">0</span>][<span class="number">2</span>] =  <span class="built_in">sin</span>(arm-&gt;theta[i])*<span class="built_in">sin</span>(arm-&gt;alpha[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">0</span>][<span class="number">3</span>] =  arm-&gt;a[i]*<span class="built_in">cos</span>(arm-&gt;theta[i]);</span><br><span class="line"></span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">1</span>][<span class="number">0</span>] =  <span class="built_in">sin</span>(arm-&gt;theta[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">1</span>][<span class="number">1</span>] =  <span class="built_in">cos</span>(arm-&gt;theta[i])*<span class="built_in">cos</span>(arm-&gt;alpha[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">1</span>][<span class="number">2</span>] = -<span class="built_in">cos</span>(arm-&gt;theta[i])*<span class="built_in">sin</span>(arm-&gt;alpha[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">1</span>][<span class="number">3</span>] =  arm-&gt;a[i]*<span class="built_in">sin</span>(arm-&gt;theta[i]);</span><br><span class="line"></span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">2</span>][<span class="number">0</span>] =  <span class="number">0</span>;</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">2</span>][<span class="number">1</span>] =  <span class="built_in">sin</span>(arm-&gt;alpha[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">2</span>][<span class="number">2</span>] =  <span class="built_in">cos</span>(arm-&gt;alpha[i]);</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">2</span>][<span class="number">3</span>] =  arm-&gt;d[i];</span><br><span class="line"></span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">3</span>][<span class="number">0</span>] =  <span class="number">0</span>;</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">3</span>][<span class="number">1</span>] =  <span class="number">0</span>;</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">3</span>][<span class="number">2</span>] =  <span class="number">0</span>;</span><br><span class="line">        arm-&gt;T[i]-&gt;matrix[<span class="number">3</span>][<span class="number">3</span>] =  <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­£å‘æ±‚è§£-1"><a href="#æ­£å‘æ±‚è§£-1" class="headerlink" title="æ­£å‘æ±‚è§£"></a>æ­£å‘æ±‚è§£</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Get the coordinates of the point in the end coordinate system in the main coordinate system</span></span><br><span class="line"><span class="comment"> *        Suppose the main coordinate system&#x27;s number is 0</span></span><br><span class="line"><span class="comment"> *        å¾—åˆ°æœ«ç«¯åæ ‡ç³»ä¸­çš„ä¸€ä¸ªç‚¹åœ¨ä¸»åæ ‡ç³»ä¸­çš„åæ ‡,å‡è®¾ä¸»åæ ‡ç³»ç¼–å·ä¸º0</span></span><br><span class="line"><span class="comment"> * @param arm </span></span><br><span class="line"><span class="comment"> * @param point </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">foward_solve</span><span class="params">(<span class="type">robotic_arm_t</span> *arm, Matrix_t *point)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=arm-&gt;n; i&gt;<span class="number">0</span>; i--)</span><br><span class="line">    *point = multiply_matrix2(arm-&gt;T[i],point);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€†å‘æ±‚è§£"><a href="#é€†å‘æ±‚è§£" class="headerlink" title="é€†å‘æ±‚è§£"></a>é€†å‘æ±‚è§£</h2><p>â€‹    é’ˆå¯¹äºæˆ‘æ‰‹ä¸Šçš„æœºæ¢°è‡‚ï¼Œç›´æ¥é‡‡ç”¨å‡ ä½•æ³•åˆ†æã€‚å¯æ˜¯æ–¹ç¨‹æˆ‘è§£ä¸å‡ºæ¥ğŸ˜‚ï¼Œäºæ˜¯å°†å…¶ç¨å¾®å˜å½¢ï¼Œåˆ©ç”¨<strong>äºŒåˆ†æ³•</strong>ä¹Ÿèƒ½è¿…é€Ÿæ±‚å¾—ç¬¦åˆç²¾åº¦è¦æ±‚çš„è§£ã€‚</p><p><img src="https://s2.loli.net/2022/11/23/ksmLN1CvphgzIEj.jpg" alt="å‡ ä½•é€†è§£.jpg" style="zoom:50%;" /></p><div class="note blue icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><p>å…·ä½“äºŒåˆ†çš„æ€è·¯å°±æ˜¯<strong>alpha</strong>è¶Šå¤§ï¼Œæœºæ¢°è‡‚ä¼¸å¾—è¶ŠçŸ­ï¼Œ<strong>alpha</strong>è¶Šå°ï¼Œä¼¸å¾—è¶Šé•¿ã€‚æ¯”è¾ƒä¼¸çš„é•¿çŸ­æ˜¯å¦åˆ°è¾¾</p></div><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Use the dichotomy method to find the angle of each joint according to the target coordinates </span></span><br><span class="line"><span class="comment"> *        ç”¨äºŒåˆ†æ³•æ ¹æ®ç›®æ ‡åæ ‡æ±‚å‡ºå…³èŠ‚è§’åº¦ã€‚ï¼ˆä½¿ç”¨äº†å‡ ä½•æ³•ï¼Œä»…é€‚ç”¨äºç‰¹å®šæœºæ¢°è‡‚ï¼‰</span></span><br><span class="line"><span class="comment"> *        æ ¹æ®æœ«ç«¯æœºæ¢°æ‰‹ä½å§¿æ±‚å‡ºæœ€åä¸€ä¸ªå…³èŠ‚çš„åæ ‡(è¿™ä¸€æ­¥è¿˜æ²¡å®ç°)ï¼Œç”±æ­¤è®¡ç®—å…¶ä½™å…³èŠ‚è§’åº¦ã€‚</span></span><br><span class="line"><span class="comment"> * @param arm è‡ªå·±çš„æœºæ¢°è‡‚ï¼Œéé€šè§£</span></span><br><span class="line"><span class="comment"> * @param point æœ€åä¸€ä¸ªå…³èŠ‚çš„åæ ‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">reverse_solve_dichonomy</span><span class="params">(<span class="type">robotic_arm_t</span> *arm, Matrix_t point)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> angle0, angle1, angle2, alpha_l=<span class="number">0</span>, alpha_r=PI, alpha_mid, beta, theta, len_xy, x, y, z, l1, l2, d;</span><br><span class="line">    x = point.matrix[<span class="number">0</span>][<span class="number">0</span>], y = point.matrix[<span class="number">1</span>][<span class="number">0</span>], z = point.matrix[<span class="number">2</span>][<span class="number">0</span>] - arm-&gt;d[<span class="number">1</span>];</span><br><span class="line">    d = <span class="built_in">sqrt</span>(x*x + y*y + z*z);</span><br><span class="line">    l1 = arm-&gt;a[<span class="number">2</span>], l2 = arm-&gt;a[<span class="number">3</span>];</span><br><span class="line">    len_xy = <span class="built_in">sqrt</span>(x*x + y*y);</span><br><span class="line">    <span class="keyword">if</span>(len_xy == <span class="number">0</span>) &#123;theta = PI/<span class="number">2</span>;&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;theta = <span class="built_in">atan</span>(z/len_xy);&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(alpha_r-alpha_l &gt; <span class="number">0.00175</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        alpha_mid = (alpha_l+alpha_r)/<span class="number">2</span>;</span><br><span class="line">        beta = <span class="built_in">asin</span>(<span class="built_in">sin</span>(alpha_mid)*l1/l2);</span><br><span class="line">        <span class="keyword">if</span>(l1*<span class="built_in">cos</span>(alpha_mid) + l2*<span class="built_in">cos</span>(beta) &gt; d)</span><br><span class="line">        &#123;alpha_l = alpha_mid;&#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;alpha_r = alpha_mid;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) &#123;angle0 = PI/<span class="number">2</span>;&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;angle0 = <span class="built_in">atan</span>(y/x);&#125;</span><br><span class="line">    angle1 = theta - alpha_mid;</span><br><span class="line">    angle2 = alpha_mid + beta + PI/<span class="number">2</span>;</span><br><span class="line">    arm-&gt;theta[<span class="number">1</span>] =  angle0;</span><br><span class="line">    arm-&gt;theta[<span class="number">2</span>] = -angle1;</span><br><span class="line">    arm-&gt;theta[<span class="number">3</span>] = PI/<span class="number">2</span> - angle2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¹Ÿå°è¯•äº†ä½¿ç”¨MATLABè§£æ–¹ç¨‹ï¼Œå¾—å‡ºçš„ç»“æœååˆ†çš„å¤æ‚ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯ç›´æ¥ç”¨äºŒåˆ†æ³•æ¯”è¾ƒå¥½ã€‚</p><p><img src="https://s2.loli.net/2022/11/24/EtFa9Bnypj4YwlZ.png" alt="MATLAB.png"></p><h1 id="ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³•"><a href="#ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³•"></a>ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³•</h1><p>â€‹    åœ¨ä¹‹å‰çš„é€†è§£è¿‡ç¨‹ä¸­ï¼Œåªèƒ½é’ˆå¯¹å•ä¸ªæœºæ¢°è‡‚çš„å‡ ä½•ç‰¹å¾å•ç‹¬æ±‚è§£ï¼Œä¸å…·æœ‰æ³›ç”¨æ€§ã€‚è€Œä¸”ä»¥æˆ‘çš„æ•°å­¦æ°´å¹³ä¹Ÿåªèƒ½æ±‚è§£ç»“æ„ç®€å•çš„æœºæ¢°è‡‚ğŸ¤£ï¼Œå½“å…³èŠ‚æ•°å¢åŠ ç”šè‡³å†—ä½™æ—¶ï¼Œæ— æ³•ç›´æ¥ç”¨æ•°å­¦æ–¹æ³•æ±‚è§£ï¼Œæˆ–è€…è¯´æ˜¯å¤šè§£ã€‚æ‰€ä»¥å°è¯•é‡‡ç”¨<strong>ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³•(Particle Swarm Optimization, PSO)</strong>æ¥å®ç°ä¸€ç§é€šç”¨çš„è§£æ³•ã€‚</p><div class="note pink icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><a href="https://zhuanlan.zhihu.com/p/346355572">ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³•(Particle Swarm Optimization, PSO)çš„è¯¦ç»†è§£è¯» - çŸ¥ä¹ (zhihu.com)</a></p></div><p>è¿™ä½å¤§ä½¬å†™å¾—éå¸¸è¯¦ç»†ï¼Œæˆ‘è¿™é‡Œæ˜¯ä½¿ç”¨cè¯­è¨€å®ç°çš„ï¼Œå¹¶å°†å…¶ç”¨åœ¨äº†æœºæ¢°è‡‚é€†è§£ä¸Šé¢ã€‚</p><h2 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h3><ul><li>ç²’å­ç¾¤åˆå§‹åŒ–åŠå„ç²’å­éšæœºåˆå§‹åŒ–</li><li>å¼€å§‹è¿­ä»£<ul><li>è®¡ç®—é€‚åº”å€¼</li><li>æ›´æ–°ä¸ªä½“åŠç¾¤ä½“æœ€ä¼˜è§£ä¸æœ€ä¼˜é€‚åº”å€¼</li><li>æ›´æ–°wå€¼ï¼Œç²’å­é€Ÿåº¦ï¼Œç²’å­ä½ç½®</li></ul></li><li>ç»“æŸè¿­ä»£</li><li>è¿”å›å¯»å¾—çš„æœ€ä¼˜è§£</li></ul><h3 id="ç»“æ„ä½“-1"><a href="#ç»“æ„ä½“-1" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h3><p>çœ‹å®Œä¸Šé¢çš„åšå®¢ä¹‹åï¼Œæƒ³å¿…è¿™äº›å®šä¹‰æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief </span></span><br><span class="line"><span class="comment"> * @param X current state ç›®å‰åæ ‡ï¼ˆè§£ï¼‰</span></span><br><span class="line"><span class="comment"> * @param V current velocity ç›®å‰é€Ÿåº¦</span></span><br><span class="line"><span class="comment"> * @param opt_X optimal solution of individual&#x27;s history ä¸ªä½“å†å²æœ€ä¼˜è§£</span></span><br><span class="line"><span class="comment"> * @param opt_A optimal adaptability of individual&#x27;s history ä¸ªä½“å†å²æœ€ä¼˜é€‚åº”å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">bird_t</span>&#123;</span></span><br><span class="line">    <span class="type">double</span> X[arm_MX_nodes], V[arm_MX_nodes];</span><br><span class="line">    <span class="type">double</span> opt_X[arm_MX_nodes];</span><br><span class="line">    <span class="type">double</span> opt_A;</span><br><span class="line">&#125;<span class="type">bird_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief </span></span><br><span class="line"><span class="comment"> * @param N size of the bird population ç§ç¾¤è§„æ¨¡</span></span><br><span class="line"><span class="comment"> * @param D è§£çš„ç»´åº¦</span></span><br><span class="line"><span class="comment"> * @param K è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment"> * @param W æƒ¯æ€§æƒé‡</span></span><br><span class="line"><span class="comment"> * @param C_ind ä¸ªä½“å­¦ä¹ å› å­</span></span><br><span class="line"><span class="comment"> * @param C_pop ç¾¤ä½“å­¦ä¹ å› å­</span></span><br><span class="line"><span class="comment"> * @param opt_X_pop optimal solution of population&#x27;s history ç¾¤ä½“å†å²æœ€ä¼˜è§£</span></span><br><span class="line"><span class="comment"> * @param opt_A_pop optimal adapatability of population&#x27;s history ç¾¤ä½“å†å²æœ€ä¼˜è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">bird_population_t</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> N, D, K;</span><br><span class="line">    <span class="type">double</span> W, C_ind, C_pop;</span><br><span class="line">    <span class="type">double</span> opt_X_pop[arm_MX_nodes];</span><br><span class="line">    <span class="type">double</span> opt_A_pop;</span><br><span class="line">    <span class="type">bird_t</span> *bird[N_MX_SIZE];</span><br><span class="line"></span><br><span class="line">&#125;<span class="type">bird_population_t</span>;</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>â€‹    å•ä¸ªç²’å­çš„åˆå§‹åŒ–ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦ç”¨ <em>â€˜birdâ€™</em> æ¥å‘½åå‘¢ï¼Œå› ä¸ºè¿™ä¸ªç®—æ³•å…¶å®ä¹Ÿç®—æ˜¯ä¸€ç§ä»¿ç”Ÿçš„æ€è·¯ï¼Œä½œè€…æ˜¯å—åˆ°é¸Ÿç¾¤è§…é£Ÿçš„å¯å‘å‘æ˜äº†è¿™ä¸ªç®—æ³•ã€‚æˆ‘ç¬¬ä¸€çœ¼çœ‹åˆ°è¿™ä¸ªç®—æ³•æƒ³åˆ°çš„å°±æ˜¯é—ä¼ ç®—æ³•ï¼Œå…¶å®æ„Ÿè§‰éƒ½æ˜¯ä¼˜åŒ–çš„æœç´¢æ–¹æ³•ï¼Œä¸è¿‡ç›¸æ¯”äºé—ä¼ ç®—æ³•æ­¤ç®—æ³•åœ¨æ±‚æœºæ¢°è‡‚é€†è§£çš„åº”ç”¨ä¸­æ›´èƒœä¸€ç­¹ï¼Œå…·ä½“æ€ä¹ˆä¸ªä¼˜åŠ¿æ³•è¿˜æœ‰å¾…å»ç ”ç©¶ç ”ç©¶ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief ç²’å­éšæœºåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * åœ¨è¿™é‡Œé¢åˆ†é…ç©ºé—´ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿå¯ä»¥é˜²æ­¢ç©ºé—´æµªè´¹</span></span><br><span class="line"><span class="comment"> * @param pop </span></span><br><span class="line"><span class="comment"> * @return bird_t* </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bird_t</span> *<span class="title function_">bird_init</span><span class="params">(<span class="type">bird_population_t</span> *pop)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">bird_t</span> *bird;</span><br><span class="line">    bird = (<span class="type">bird_t</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">bird_t</span>));</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;pop-&gt;D; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        bird-&gt;X[i] = PI*(rand()%<span class="number">180</span>)/<span class="number">180</span>;</span><br><span class="line">        bird-&gt;V[i] = PI*(rand()%<span class="number">20</span><span class="number">-10</span>)/<span class="number">180</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    bird-&gt;opt_A = BADDEST;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bird;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief ç²’å­ç¾¤åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * @param n </span></span><br><span class="line"><span class="comment"> * @param d </span></span><br><span class="line"><span class="comment"> * @param k </span></span><br><span class="line"><span class="comment"> * @param w </span></span><br><span class="line"><span class="comment"> * @param c_ind </span></span><br><span class="line"><span class="comment"> * @param c_pop </span></span><br><span class="line"><span class="comment"> * @return bird_population_t* </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bird_population_t</span> *<span class="title function_">bird_population_init</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> d, <span class="type">int</span> k, <span class="type">double</span> w, <span class="type">double</span> c_ind, <span class="type">double</span> c_pop)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">bird_population_t</span> *bird_population;</span><br><span class="line">    bird_population = (<span class="type">bird_population_t</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">bird_population_t</span>));</span><br><span class="line"></span><br><span class="line">    bird_population-&gt;N = n, bird_population-&gt;D = d, bird_population-&gt;K = k;</span><br><span class="line">    bird_population-&gt;W = w, bird_population-&gt;C_ind = c_ind, bird_population-&gt;C_pop = c_pop;</span><br><span class="line"></span><br><span class="line">    srand((<span class="type">unsigned</span>)time( <span class="literal">NULL</span> ) );     </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        bird_population-&gt;bird[i] = bird_init(bird_population);</span><br><span class="line">    &#125;</span><br><span class="line">    bird_population-&gt;opt_A_pop = BADDEST;</span><br><span class="line">    <span class="keyword">return</span> bird_population;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿­ä»£è¿‡ç¨‹"><a href="#è¿­ä»£è¿‡ç¨‹" class="headerlink" title="è¿­ä»£è¿‡ç¨‹"></a>è¿­ä»£è¿‡ç¨‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;bird_pop-&gt;K; i++)<span class="comment">//K</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;bird_pop-&gt;N;j++)<span class="comment">//N</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//è®¡ç®—é€‚åº”å€¼</span></span><br><span class="line">            Matrix_t *judge_point = point_init(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">            <span class="type">double</span> ada=<span class="number">0</span>;<span class="comment">//é€‚åº”å€¼</span></span><br><span class="line">            DH_update(arm,bird_pop-&gt;bird[j]-&gt;X);</span><br><span class="line">            foward_solve(arm,judge_point);</span><br><span class="line">            ada += (point.matrix[<span class="number">0</span>][<span class="number">0</span>] - judge_point-&gt;matrix[<span class="number">0</span>][<span class="number">0</span>])*(point.matrix[<span class="number">0</span>][<span class="number">0</span>] - judge_point-&gt;matrix[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">            ada += (point.matrix[<span class="number">1</span>][<span class="number">0</span>] - judge_point-&gt;matrix[<span class="number">1</span>][<span class="number">0</span>])*(point.matrix[<span class="number">1</span>][<span class="number">0</span>] - judge_point-&gt;matrix[<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">            ada += (point.matrix[<span class="number">2</span>][<span class="number">0</span>] - judge_point-&gt;matrix[<span class="number">2</span>][<span class="number">0</span>])*(point.matrix[<span class="number">2</span>][<span class="number">0</span>] - judge_point-&gt;matrix[<span class="number">2</span>][<span class="number">0</span>]);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ›´æ–°ä¸ªä½“ä¸ç¾¤ä½“æœ€ä¼˜é€‚åº”å€¼ä¸æœ€ä¼˜è§£</span></span><br><span class="line">            <span class="keyword">if</span>(ada &lt; bird_pop-&gt;bird[j]-&gt;opt_A)</span><br><span class="line">            &#123;</span><br><span class="line">                bird_pop-&gt;bird[j]-&gt;opt_A = ada;</span><br><span class="line">                <span class="keyword">for</span>(k=<span class="number">0</span>; k &lt; arm-&gt;n; k++)</span><br><span class="line">                &#123;bird_pop-&gt;bird[j]-&gt;opt_X[k] = bird_pop-&gt;bird[j]-&gt;X[k];&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(ada &lt; bird_pop-&gt;opt_A_pop)</span><br><span class="line">            &#123;</span><br><span class="line">                bird_pop-&gt;opt_A_pop = ada;</span><br><span class="line">                <span class="keyword">for</span>(k=<span class="number">0</span>; k &lt; arm-&gt;n; k++)</span><br><span class="line">                &#123;bird_pop-&gt;opt_X_pop[k] = bird_pop-&gt;bird[j]-&gt;X[k];&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ›´æ–°wå€¼ï¼Œæ›´æ–°å„ç»´åº¦é€Ÿåº¦ä¸ä½ç½®</span></span><br><span class="line">            w = W_MAX - (W_MAX - W_MIN)*((<span class="type">double</span>)i/bird_pop-&gt;K);</span><br><span class="line">            <span class="keyword">for</span>(k=<span class="number">0</span>; k &lt; arm-&gt;n; k++)</span><br><span class="line">            &#123;</span><br><span class="line">                bird_pop-&gt;bird[j]-&gt;V[k] = (w+(rand()/<span class="number">16384</span><span class="number">-1</span>)*<span class="number">0.15</span>)*(bird_pop-&gt;bird[j]-&gt;V[k]) + (rand()/<span class="number">16384</span>)*<span class="number">1.8</span>*(bird_pop-&gt;opt_X_pop[k] - bird_pop-&gt;bird[j]-&gt;X[k]) + (rand()/<span class="number">16384</span>)*<span class="number">1.6</span>*(bird_pop-&gt;bird[j]-&gt;opt_X[k] - bird_pop-&gt;bird[j]-&gt;X[k]);</span><br><span class="line">                bird_pop-&gt;bird[j]-&gt;V[k] = (bird_pop-&gt;bird[j]-&gt;V[k] &gt; V_MAX) ? V_MAX : bird_pop-&gt;bird[j]-&gt;V[k];</span><br><span class="line">                bird_pop-&gt;bird[j]-&gt;V[k] = (bird_pop-&gt;bird[j]-&gt;V[k] &lt; V_MIN) ? V_MIN : bird_pop-&gt;bird[j]-&gt;V[k];</span><br><span class="line">                bird_pop-&gt;bird[j]-&gt;X[k] += bird_pop-&gt;bird[j]-&gt;V[k]; </span><br><span class="line">                bird_pop-&gt;bird[j]-&gt;X[k] = (bird_pop-&gt;bird[j]-&gt;X[k] &gt; X_MAX) ? X_MAX : bird_pop-&gt;bird[j]-&gt;X[k];</span><br><span class="line">                bird_pop-&gt;bird[j]-&gt;X[k] = (bird_pop-&gt;bird[j]-&gt;X[k] &lt; X_MIN) ? X_MIN : bird_pop-&gt;bird[j]-&gt;X[k];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ‰“å°è°ƒè¯•</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;    bird%d: \r\n        å½“å‰ä½ç½®X: &quot;</span>,j);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> m=<span class="number">0</span>; m&lt;arm-&gt;n; m++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%.3f|%.1f, &quot;</span>,bird_pop-&gt;bird[j]-&gt;X[m],rad_angle(bird_pop-&gt;bird[j]-&gt;X[m]));&#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\r\n        å½“å‰é€Ÿåº¦V: &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> m=<span class="number">0</span>; m&lt;arm-&gt;n; m++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%.3f|%.1f, &quot;</span>,bird_pop-&gt;bird[j]-&gt;V[m],rad_angle(bird_pop-&gt;bird[j]-&gt;V[m]));&#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            <span class="built_in">free</span>(judge_point);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//æ‰“å°è°ƒè¯•</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d æœ€é€‚å€¼: %.3f æƒ¯æ€§w: %.3f\r\n&quot;</span>,i,bird_pop-&gt;opt_A_pop,w);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;   è§’åº¦X: &quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>; k &lt; arm-&gt;n; k++) &#123;<span class="built_in">printf</span>(<span class="string">&quot;%.2f|%.1f &quot;</span>,bird_pop-&gt;opt_X_pop[k],rad_angle(bird_pop-&gt;opt_X_pop[k]));&#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä¸€äº›å°ç»†èŠ‚"><a href="#ä¸€äº›å°ç»†èŠ‚" class="headerlink" title="ä¸€äº›å°ç»†èŠ‚"></a>ä¸€äº›å°ç»†èŠ‚</h3><p><img src="https://s2.loli.net/2022/11/23/2PGk5JcVnpuKwIq.png" alt="bug1.png"  /></p><p>â€‹    å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘æ·»åŠ äº†æ—¶é—´éšæœºæ•°ç§å­ï¼Œä½†æ˜¯ç”Ÿæˆçš„ç²’å­ä»ç„¶æ˜¯å…¨éƒ½ä¸€æ ·çš„ã€‚è¿™é‡Œè¦å°†<code>srand((insigned)time(NULL));</code>æå‰è‡³åˆå§‹åŒ–å‡½æ•°å¤–ã€‚</p><p>â€‹    </p><p><code>w = W_MAX - (W_MAX - W_MIN)*((double)i/bird_pop-&gt;K);</code> åœ¨ç»™<strong>w</strong>åŠ æƒçš„æ—¶å€™åˆ«å¿˜äº†<code>double</code>ï¼Œä¸ç„¶åé¢ç®—å‡ºæ¥ä¸€ç›´æ˜¯0ã€‚</p><h1 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h1><p>æ„Ÿè°¢å¤§å®¶è€å¿ƒçœ‹å®Œäº†æœ¬ç¯‡åšå®¢ï¼Œå¦‚æœè§‰å¾—ä¸é”™çš„è¯æ¬¢è¿åˆ†äº«ç»™ä»–äººã€‚ç”±äºæœ¬äººæ°´å¹³æœ‰é™ï¼Œéš¾å…æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºæ‰¹è¯„æŒ‡æ­£ã€‚å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨æˆ‘çš„ä»£ç ä»“åº“æ‰¾åˆ°ï¼Œåç»­ä¹Ÿä¼šå°†å…¶ç§»æ¤åˆ°STM32ä¸Šã€‚åœ¨è¿™é‡Œè´´ä¸Šä¸»è¦ä»£ç æ–¹ä¾¿éšæ—¶æŸ¥çœ‹ï¼Œæ€è·¯ä¸ä»£ç ç›¸äº’å¯¹ç…§ä¹Ÿæ›´å®¹æ˜“ç†è§£ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> è¿åŠ¨å­¦åˆ†æ </tag>
            
            <tag> æœºæ¢°è‡‚ </tag>
            
            <tag> D-Hå‚æ•°æ³• </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³• </tag>
            
            <tag> STM32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DIYå¹³è¡¡å°è½¦</title>
      <link href="/2022/11/12/DIY%E5%B9%B3%E8%A1%A1%E5%B0%8F%E8%BD%A6/"/>
      <url>/2022/11/12/DIY%E5%B9%B3%E8%A1%A1%E5%B0%8F%E8%BD%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢„æœŸæ•ˆæœ"><a href="#é¢„æœŸæ•ˆæœ" class="headerlink" title="é¢„æœŸæ•ˆæœ"></a>é¢„æœŸæ•ˆæœ</h2><h3 id="åŸºæœ¬ç›®æ ‡"><a href="#åŸºæœ¬ç›®æ ‡" class="headerlink" title="åŸºæœ¬ç›®æ ‡"></a>åŸºæœ¬ç›®æ ‡</h3><ul><li>æ ¹æ®æŒ‡ä»¤å®ç°ç²¾å‡†çš„é€Ÿåº¦æ§åˆ¶</li><li>è‡ªèº«åæ ‡å’Œå§¿æ€çš„è§£ç®—</li><li>ä¸ä¸Šä½æœºä¼ è¾“æ•°æ®</li></ul><h3 id="æ›´æœ‰æ„æ€çš„ç›®æ ‡"><a href="#æ›´æœ‰æ„æ€çš„ç›®æ ‡" class="headerlink" title="æ›´æœ‰æ„æ€çš„ç›®æ ‡"></a>æ›´æœ‰æ„æ€çš„ç›®æ ‡</h3><ul><li>åŒè½®å¹³è¡¡è½¦</li><li>æ§åˆ¶é›·è¾¾å¹³ç¨³</li></ul><h2 id="åŸºæœ¬æ–¹æ¡ˆ"><a href="#åŸºæœ¬æ–¹æ¡ˆ" class="headerlink" title="åŸºæœ¬æ–¹æ¡ˆ"></a>åŸºæœ¬æ–¹æ¡ˆ</h2><h3 id="ç”µæœºé©±åŠ¨"><a href="#ç”µæœºé©±åŠ¨" class="headerlink" title="ç”µæœºé©±åŠ¨"></a>ç”µæœºé©±åŠ¨</h3><p>â€‹    ç”µæœºä½¿ç”¨<strong>12V</strong>ä¾›ç”µï¼Œå¯ä»¥ç›´æ¥ç”±ç”µæºæ¨¡å—ä¾›ç”µã€‚ä½¿ç”¨<strong>TB6612é©±åŠ¨æ¨¡å—</strong>å¯ä»¥æ»¡è¶³ä¸¤ä¸ªç”µæœºçš„é©±åŠ¨éœ€æ±‚ã€‚</p><h3 id="ä½å§¿æµ‹é‡"><a href="#ä½å§¿æµ‹é‡" class="headerlink" title="ä½å§¿æµ‹é‡"></a>ä½å§¿æµ‹é‡</h3><p>â€‹    ä½¿ç”¨<strong>MPU6050</strong>å¯ä»¥è·å–è§’é€Ÿåº¦å’ŒåŠ é€Ÿåº¦å€¼ï¼ˆä½†æ˜¯ä¹‹å‰è¯•ç”¨çš„æ—¶å€™å‘ç°å…¶è‡ªå¸¦çš„åº“ä½å§¿è§£ç®—ä¼šæœ‰ä¸å°‘æ—¶é—´çš„åˆå§‹åŒ–å»¶è¿Ÿï¼‰ã€‚</p><p>â€‹    MPU6050ä½¿ç”¨<strong>IIC</strong>é€šä¿¡ï¼Œåœ¨è·å¾—äº†æ–°çš„æµ‹é‡ä¹‹åä¼šåœ¨<strong>INT</strong>è„šè¾“å‡ºé«˜ç”µå¹³ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å³æ—¶æ€§ï¼Œå°†ä¸€ä¸ªGPIOé…ç½®ä¸ºå¤–éƒ¨ä¸­æ–­ï¼Œåœ¨ä¸­æ–­å‡½æ•°é‡Œæ›´æ–°æ•°æ®ã€‚</p><h3 id="è½®é€Ÿè·å–"><a href="#è½®é€Ÿè·å–" class="headerlink" title="è½®é€Ÿè·å–"></a>è½®é€Ÿè·å–</h3><p>â€‹    å°†ä¸¤ä¸ªå®šæ—¶å™¨é…ç½®ä¸º<strong>ç¼–ç å™¨æ¥å£æ¨¡å¼</strong>ï¼Œåˆ†åˆ«æ¥æ”¶ä¸¤ä¸ªç”µæœºå¯¹åº”çš„ç¼–ç å™¨æ•°æ®ã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ABåŒç›¸è¾“å…¥çš„ç¼–ç å™¨ï¼Œå‚è€ƒæ‰‹å†Œï¼š</p><blockquote><p>å¦‚æœè®¡æ•°å™¨åªåœ¨TI2çš„è¾¹æ²¿è®¡æ•°ï¼Œåˆ™ç½®TIMx_SMCRå¯„å­˜å™¨ä¸­çš„SMS=001ï¼›å¦‚æœåªåœ¨TI1è¾¹æ²¿è®¡æ•°ï¼Œåˆ™ç½®SMS=010ï¼›å¦‚æœè®¡æ•°å™¨åŒæ—¶åœ¨TI1å’ŒTI2è¾¹æ²¿è®¡æ•°ï¼Œåˆ™ç½®SMS=011ã€‚  </p></blockquote><p>å¯¹å¯„å­˜å™¨çš„é…ç½®å·²ç»è¢«å°è£…åœ¨åº“å‡½æ•°<strong>TIM_EncoderInterfaceConfigï¼ˆ ï¼‰</strong>é‡Œäº†ï¼Œåªéœ€è¦é€‰æ‹©é…ç½®<strong>æ¨¡å¼3</strong>å³å¯ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼ŒTI1å’ŒTI2åˆ†åˆ«å¯¹åº”TIMxçš„<strong>channel1</strong>å’Œ<strong>channel2</strong>çš„å¼•è„šï¼Œé»˜è®¤æƒ…å†µä¸‹TIM2å°±æ˜¯<strong>PA0 PA1</strong>,TIM3æ˜¯<strong>PA6 PA7</strong>ã€‚</p><p>ä¹Ÿå¯ä»¥ä¸MPU6050ä¼ æ„Ÿå™¨æ•°æ®èåˆã€‚</p><h3 id="è¿åŠ¨æ§åˆ¶"><a href="#è¿åŠ¨æ§åˆ¶" class="headerlink" title="è¿åŠ¨æ§åˆ¶"></a>è¿åŠ¨æ§åˆ¶</h3><h4 id="ç›´ç«‹ç¯"><a href="#ç›´ç«‹ç¯" class="headerlink" title="ç›´ç«‹ç¯"></a>ç›´ç«‹ç¯</h4><p>ç›´ç«‹ç¯ä½¿å°è½¦ä¿æŒç›´ç«‹ï¼Œå³ä¿æŒåœ¨<strong>æœºæ¢°ä¸­å€¼Î¸</strong>çš„ä½ç½®ï¼Œç†æƒ³æƒ…å†µä¸‹æ˜¯ä¿æŒ0Â°ã€‚</p><p> $PWM_{balance} = KP <em> Î¸ + KD </em> \Delta Î¸$ </p><h4 id="é€Ÿåº¦ç¯"><a href="#é€Ÿåº¦ç¯" class="headerlink" title="é€Ÿåº¦ç¯"></a>é€Ÿåº¦ç¯</h4><p>â€‹    æ ¹æ®ä¸Šä½æœºå‘å¸ƒçš„é€Ÿåº¦æŒ‡ä»¤æˆ–è€…ç”±<strong>ä½ç½®ç¯</strong>è®¡ç®—å‡ºçš„ç›®æ ‡é€Ÿåº¦è®¡ç®—å‡ºè¾“å‡ºåŠ›çŸ©ã€‚</p><script type="math/tex; mode=display">PWM_{speed} = KP_s * Error + KD_s * \Delta Error</script><h4 id="é€Ÿåº¦ç¯ï¼ˆå¹³è¡¡è½¦ï¼‰"><a href="#é€Ÿåº¦ç¯ï¼ˆå¹³è¡¡è½¦ï¼‰" class="headerlink" title="é€Ÿåº¦ç¯ï¼ˆå¹³è¡¡è½¦ï¼‰"></a>é€Ÿåº¦ç¯ï¼ˆå¹³è¡¡è½¦ï¼‰</h4><p>â€‹    ä½†æ˜¯ç”±äºå®‰è£…ç­‰å¤–ç•Œå› ç´ å½±å“ï¼Œå°è½¦ä»¥ä¸ºçš„<strong>0Â°</strong>å¹¶éçœŸæ­£çš„å¹³è¡¡æ€ï¼Œäºæ˜¯æˆ‘ä»¬å¼•å…¥äº†<strong>é€Ÿåº¦ç¯</strong>ã€‚å½“å°è½¦é€Ÿåº¦ç¨³å®šæ—¶ï¼Œä¾¿å¯ä»¥è®¤ä¸ºå°è½¦è¿›å…¥å¹³è¡¡æ€ã€‚é€Ÿåº¦ç¯çš„è¾“å‡ºå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª<strong>è§’åº¦</strong>ï¼Œä½œä¸ºç›´ç«‹ç¯çš„è¾“å…¥ï¼Œç›´ç«‹ç¯ä¾¿æ¼”å˜æˆäº†ä½¿å°è½¦ä¿æŒä¸€å®šè§’åº¦ï¼Œåœ¨ä¿æŒè§’åº¦çš„æ—¶å€™ä¾¿ä¼šäº§ç”Ÿé€Ÿåº¦ã€‚</p><script type="math/tex; mode=display">balance \_ IN \_ speed = KP_S * Error + KD_S * \Delta Error</script><script type="math/tex; mode=display">PWM \_ balance \_ speed=KP * (Î¸ + balance \_ IN \_ speed) + KD * \Delta Î¸</script><p>åˆå¹¶æ•´ç†åä¾¿å¯å¾—åˆ°</p><script type="math/tex; mode=display">PWM \_ balance \_ speed = KP * Î¸ + KD * \Delta Î¸ + KPï¼ˆ KP_S * Error + KD_S * \Delta Errorï¼‰</script><p>ä¸¤è€…å…¶å®æ˜¯çº¿æ€§ç›¸åŠ çš„ï¼Œç›´æ¥å°†KP <em> KP_Såˆå¹¶ä¸ºKP_Sï¼ŒKP </em> KD_Såˆå¹¶ä¸ºKD_Sï¼Œæœ€ç»ˆç®€åŒ–ä¸º</p><script type="math/tex; mode=display">PWM_{balance} = KP * \theta + KD * \Delta \theta</script><script type="math/tex; mode=display">PWM_{speed} = KP_s *Error + KD_s * \Delta Error</script><script type="math/tex; mode=display">PWM = PWM_{speed} + PWM_{balance}</script><h4 id="è½¬å‘ç¯"><a href="#è½¬å‘ç¯" class="headerlink" title="è½¬å‘ç¯"></a>è½¬å‘ç¯</h4><p>â€‹    è½¬å‘ç¯æ¯”è¾ƒç®€å•ï¼Œç›´æ¥æ ¹æ®<strong>è§’åº¦</strong>è¾“å‡ºä¸€ä¸ªé€Ÿåº¦å·®ï¼Œç”¨<strong>PD</strong>æ§åˆ¶å³å¯ã€‚</p><h3 id="æ§åˆ¶é›·è¾¾å¹³ç¨³"><a href="#æ§åˆ¶é›·è¾¾å¹³ç¨³" class="headerlink" title="æ§åˆ¶é›·è¾¾å¹³ç¨³"></a>æ§åˆ¶é›·è¾¾å¹³ç¨³</h3><p>â€‹    æ ¹æ®è½¦å­å§¿æ€æ§åˆ¶èˆµæœºè§’åº¦ä»¥å°½å¯èƒ½ä¿è¯é›·è¾¾å¹³ç¨³ã€‚</p><h2 id="è¿åŠ¨æ¨¡å‹"><a href="#è¿åŠ¨æ¨¡å‹" class="headerlink" title="è¿åŠ¨æ¨¡å‹"></a>è¿åŠ¨æ¨¡å‹</h2><p>â€‹    è®¾ï¼šè½¦å­é€Ÿåº¦ä¸º<strong>v</strong> ï¼› ä¸¤è½®é€Ÿåº¦åˆ†åˆ«ä¸º<strong>v1ï¼Œv2</strong> ï¼›ä¸¤è½®é—´è·ä¸º<strong>d</strong> ï¼›é€Ÿåº¦ç¬å¿ƒä¸ºç‚¹ <strong>P</strong> ï¼› é€Ÿåº¦ç¬å¿ƒç¦»ä¸¤è½®è·ç¦»åˆ†åˆ«ä¸º <strong>r1 , r2</strong> ï¼›è½¦èº«è§’é€Ÿåº¦ä¸º <strong>w</strong> ï¼› è½¦å­è¿åŠ¨è½¨è¿¹åŠå¾„ä¸º<strong>R</strong> ï¼›<strong>é€†æ—¶é’ˆ</strong>è½¬ä¸ºæ­£æ–¹å‘</p><p>â€‹    å¯ä»¥ç®—å¾—ï¼š</p><script type="math/tex; mode=display">v =\frac{1}{2} ( v_1 + v_2 )</script><script type="math/tex; mode=display">\omega = \frac{v_2 - v_1}{d}</script><p>â€‹    </p><script type="math/tex; mode=display">R = d\frac{v_1 + v_2}{2(v_2 - v_1)}</script><p>ç›®å‰çš„æƒ³æ³•æ˜¯å»ºç«‹ä¸€ä¸ª<strong>ä¸–ç•Œåæ ‡ç³»</strong>å’Œä¸€ä¸ª<strong>è½¦å­åæ ‡ç³»</strong>ã€‚</p><ul><li>åœ¨<strong>è½¦å­åæ ‡ç³»</strong>ä¸­å¯ä»¥è½»æ¾åœ°è®¡ç®—å‡º<strong>ä¸‹ä¸€æ—¶åˆ»</strong>è½¦å­çš„ä½ç½®å’Œå§¿æ€ ï¼›</li><li>è€Œé€šè¿‡<strong>è¿™ä¸€æ—¶åˆ»</strong>è½¦å­çš„ä½ç½®å’Œå§¿æ€åˆå¯ä»¥å¾—åˆ°æ­¤æ—¶è½¦å­åæ ‡ç³»ä¸ä¸–ç•Œåæ ‡ç³»çš„<strong>å˜æ¢çŸ©é˜µ</strong>ï¼›</li><li>åˆ©ç”¨<strong>å˜æ¢çŸ©é˜µ</strong>å¯ä»¥å°†<strong>è½¦å­åæ ‡ç³»ä¸­</strong>ä¸‹ä¸€æ—¶åˆ»çš„ä½å§¿è½¬æ¢åˆ°<strong>ä¸–ç•Œåæ ‡ç³»</strong>ã€‚</li></ul><p>â€‹    å¦‚æ­¤ä¾¿å¯ä»¥å®ŒæˆçŠ¶æ€é€’æ¨ã€‚</p><script type="math/tex; mode=display">\Delta \theta_k = \frac{v_{k-1}}{R_{k-1}} \Delta t</script><script type="math/tex; mode=display">\Delta x_k = R_{k-1} (1 - \cos {\Delta \theta_k})</script><script type="math/tex; mode=display">\Delta y_k = R_{k-1} \sin{\Delta \theta_k}</script><script type="math/tex; mode=display">x_k = x_{k-1} + \Delta x_k \sin{\theta_{k-1}} + \Delta y_k \cos{\theta_{k-1}}</script><script type="math/tex; mode=display">y_k = y_{k-1} - \Delta x_k \cos{\theta_{k-1}} + \Delta y_k \sin{\theta_{k-1}}</script><script type="math/tex; mode=display">\theta_k = \theta_{k-1} + \Delta \theta_k</script>]]></content>
      
      
      
        <tags>
            
            <tag> è¿åŠ¨å­¦åˆ†æ </tag>
            
            <tag> å¹³è¡¡å°è½¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¡å°”æ›¼æ»¤æ³¢å­¦ä¹ ç¬”è®°</title>
      <link href="/2022/11/04/Kalman%20filter%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/11/04/Kalman%20filter%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="å¡å°”æ›¼æ»¤æ³¢"><a href="#å¡å°”æ›¼æ»¤æ³¢" class="headerlink" title="å¡å°”æ›¼æ»¤æ³¢"></a>å¡å°”æ›¼æ»¤æ³¢</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>â€‹    æœ€è¿‘åœ¨å­¦ä¹ å¡å°”æ›¼æ»¤æ³¢ç®—æ³•ï¼Œè¿™å…¶ä¸­ç”¨åˆ°äº†ä¸€äº›æ•°å­¦å’Œç°ä»£æ§åˆ¶ç†è®ºçš„çŸ¥è¯†ã€‚ç”±äºæˆ‘åœ¨å­¦ä¹ ä¹‹å‰æ²¡æœ‰å•¥çŸ¥è¯†å‚¨å¤‡ï¼Œåœ¨ç½‘ä¸Šçœ‹äº†å¾ˆå¤šåšå®¢ã€èŠ±äº†å¾ˆå¤šæ—¶é—´ä¹‹åä¾ç„¶æ˜¯ä¸€ç§ä¼¼æ‡‚éæ‡‚çš„æ„Ÿè§‰ã€‚ç»ˆäºæ‰¾åˆ°äº†ä¸€äº›å¾ˆæ£’çš„æ•™ç¨‹ï¼Œæ„Ÿè§‰ç®—æ˜¯ç¨å¾®ç†è§£äº†ä¸€äº›ï¼Œæ•´ç†äº†ä¸€äº›å­¦ä¹ ç¬”è®°ï¼Œæ¢³ç†æ€è·¯ï¼Œä¹Ÿæ–¹ä¾¿æ—¥åæŸ¥é˜…ã€‚</p><p><strong>æ•™ç¨‹é“¾æ¥</strong></p><div class="note pink icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><ul><li><a href="https://www.bilibili.com/video/BV1ez4y1X7eR/?spm_id_from=333.788&amp;vd_source=0f383e93e945bca07eaef9a9ee5d9db3">ã€å¡å°”æ›¼æ»¤æ³¢å™¨ã€‘1_é€’å½’ç®—æ³•_Recursive Processing_å“”å“©å“”å“©_bilibili</a></li><li><a href="https://www.bilibili.com/video/BV1Rh41117MT/?spm_id_from=333.337.search-card.all.click&amp;vd_source=0f383e93e945bca07eaef9a9ee5d9db3">ä»æ”¾å¼ƒåˆ°ç²¾é€šï¼å¡å°”æ›¼æ»¤æ³¢ä»ç†è®ºåˆ°å®è·µ~_å“”å“©å“”å“©_bilibili</a></li><li><a href="https://blog.csdn.net/Yemiekai/article/details/116372288">https://blog.csdn.net/Yemiekai/article/details/116372288</a></li></ul></div><h2 id="æ•°å­¦åŸºç¡€"><a href="#æ•°å­¦åŸºç¡€" class="headerlink" title="æ•°å­¦åŸºç¡€"></a>æ•°å­¦åŸºç¡€</h2><h3 id="åæ–¹å·®çŸ©é˜µ"><a href="#åæ–¹å·®çŸ©é˜µ" class="headerlink" title="åæ–¹å·®çŸ©é˜µ"></a>åæ–¹å·®çŸ©é˜µ</h3><blockquote><p>å°†<strong>æ–¹å·®ã€åæ–¹å·®</strong>åœ¨ä¸€ä¸ªçŸ©é˜µä¸­è¡¨ç°å‡ºæ¥ï¼Œä½“ç°å˜é‡é—´çš„<strong>è”åŠ¨å…³ç³»</strong></p></blockquote><p>å‡è®¾æœ‰<strong>X,Y,Z</strong>ä¸‰ç»„æ•°æ®ï¼Œæ¯ç»„æ•°æ®æœ‰<strong>n</strong>ä¸ª</p><h4 id="æ–¹å·®ï¼š"><a href="#æ–¹å·®ï¼š" class="headerlink" title="æ–¹å·®ï¼š"></a>æ–¹å·®ï¼š</h4><script type="math/tex; mode=display">\sigma_x^2 = \frac{1}{n}\sum(x_i - \bar{x})^2</script><p>æ–¹å·®è¶Šå¤§ï¼Œæ•°æ®æ³¢åŠ¨è¶Šå¤§</p><h4 id="åæ–¹å·®ï¼š"><a href="#åæ–¹å·®ï¼š" class="headerlink" title="åæ–¹å·®ï¼š"></a>åæ–¹å·®ï¼š</h4><script type="math/tex; mode=display">\sigma_x\sigma_y = \sigma_y\sigma_x = \frac{1}{n}\sum(x_i - \bar{}x)(y_i - \bar{y})</script><p>åæ–¹å·®è¶Šå°ï¼ŒX,Yç›¸å…³æ€§è¶Šä½</p><h4 id="åæ–¹å·®çŸ©é˜µï¼š"><a href="#åæ–¹å·®çŸ©é˜µï¼š" class="headerlink" title="åæ–¹å·®çŸ©é˜µï¼š"></a>åæ–¹å·®çŸ©é˜µï¼š</h4><script type="math/tex; mode=display">\begin{bmatrix}\sigma_x^2 & \sigma_x\sigma_y & \sigma_x\sigma_z \\ \sigma_y\sigma_x & \sigma_y^2 & \sigma_y\sigma_z \\ \sigma_z\sigma_x & \sigma_z\sigma_y & \sigma_z^2\\ \end{bmatrix}</script><h4 id="è¿‡æ¸¡çŸ©é˜µ"><a href="#è¿‡æ¸¡çŸ©é˜µ" class="headerlink" title="è¿‡æ¸¡çŸ©é˜µ"></a>è¿‡æ¸¡çŸ©é˜µ</h4><p>è¿‡æ¸¡çŸ©é˜µ<strong>a</strong>ç”¨ä»¥è®¡ç®—åæ–¹å·®çŸ©é˜µ<strong>P</strong>ï¼š</p><script type="math/tex; mode=display">P = \frac{1}{n}a^Ta</script><p>ç»“åˆå…¬å¼å®¹æ˜“ç†è§£ï¼š(æ­¤å¤„ä¸º3x3çŸ©é˜µ)</p><script type="math/tex; mode=display">a = \begin{bmatrix}x1 & y1 & z1 \\ x2 & y2 & z2 \\ x3 & y3 & z3 \\ \end{bmatrix} - \frac{1}{3}\begin{bmatrix}1 & 1 & 1 \\ 1 & 1 & 1 \\ 1 & 1 & 1 \\ \end{bmatrix}\begin{bmatrix}x1 & y1 & z1 \\ x2 & y2 & z2 \\ x3 & y3 & z3 \\ \end{bmatrix}</script><p>è¢«å‡æ•°å³ä¸º<strong>åŸçŸ©é˜µ</strong>ï¼Œè€Œå‡æ•°åˆ™ä¸º<strong>å¹³å‡å€¼çŸ©é˜µ</strong></p><h3 id="çŠ¶æ€ç©ºé—´æ–¹ç¨‹"><a href="#çŠ¶æ€ç©ºé—´æ–¹ç¨‹" class="headerlink" title="çŠ¶æ€ç©ºé—´æ–¹ç¨‹"></a>çŠ¶æ€ç©ºé—´æ–¹ç¨‹</h3><script type="math/tex; mode=display">\hat{X}_k = A\hat{X}_{k-1} + Bu_{k-1} + W_{k-1}</script><script type="math/tex; mode=display">Z_k = HX_k + V_k</script><p><strong>å˜é‡è¯´æ˜ï¼š</strong></p><ul><li><script type="math/tex">\hat{X}_k</script>ï¼šå®é™…çŠ¶æ€å€¼</li><li><script type="math/tex">\hat{X}_{k-1}</script>ï¼šä¸Šä¸€æ—¶åˆ»çŠ¶æ€å€¼</li><li>$u_k-1$ï¼šæ§åˆ¶è¾“å…¥é‡</li><li><em>Aã€Hã€B</em>ï¼šè½¬æ¢çŸ©é˜µ</li><li>$Z_k$ï¼šæµ‹é‡å€¼</li><li>$W_{k-1}$ï¼šè¿‡ç¨‹å™ªå£°</li><li>$V_k$ï¼šæµ‹é‡å™ªå£°</li></ul><p><strong>å…³äºä¼ é€’æ–¹ç¨‹ï¼š</strong></p><p>â€‹    å¦‚æœæˆ‘ä»¬æŒæ¡äº†ä¸€ä¸ªç‰©ä½“çš„è¿åŠ¨è§„å¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶åˆ»çš„çŠ¶æ€å¯ä»¥é€šè¿‡ä¸Šä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€è®¡ç®—å‡ºæ¥ã€‚ä½†æ˜¯ä¹Ÿä¸èƒ½ä¿è¯å®Œå…¨ç²¾å‡†ï¼Œæ‰€ä»¥æ·»åŠ äº†<strong>è¿‡ç¨‹å™ªå£°â€”â€”W</strong></p><p>â€‹    ä¸¾ä¸ªä¾‹å­â€”â€”ç»å…¸çš„é˜»å°¼å¼¹ç°§æŒ¯å­æ¨¡å‹ï¼š</p><p><img src="https://s2.loli.net/2022/11/05/njC8ubrIcYQRiF9.jpg" alt="é˜»å°¼å¼¹ç°§.jpg"></p><p>å¼¹ç°§æ¢å¤åŠ› = kXï¼Œé˜»åŠ› = Bvã€‚å°†Xçš„å¯¼æ•°vè®°ä½œ$\dot{X}$ï¼ŒXçš„äºŒé˜¶å¯¼aè®°ä½œ$\ddot{X}$ï¼Œä¾¿å¯ä»¥å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">m\ddot{X} + B\dot{X} + kX = F</script><p>å–çŠ¶æ€å˜é‡<strong>X1ä¸ºä½ç§»</strong>ï¼Œ<strong>X2ä¸ºé€Ÿåº¦</strong>ï¼ŒFè®°ä¸ºæ§åˆ¶è¾“å…¥<strong>u</strong>ï¼Œæ ¹æ®ä¹‹å‰å…¬å¼å¯å¾—ï¼š</p><script type="math/tex; mode=display">\dot{X_1} = X_2</script><script type="math/tex; mode=display">\dot{X_2} = \ddot{X} = \frac{1}{m}u - \frac{B}{m}X_2 - \frac{k}{m}X_1</script><p>å†™æˆçŸ©é˜µçš„å½¢å¼å°±æ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix} \dot{X_1} \\ \dot{X_2} \end{bmatrix} = \begin{bmatrix} 0 & 1 \\ -\frac{k}{m} & -\frac{B}{m} \end{bmatrix}\begin{bmatrix} X_1 \\ X_2 \end{bmatrix} + \begin{bmatrix} 0 \\ \frac{1}{m} \end{bmatrix}u</script><p>å¯¹åº”ç€çŠ¶æ€è¶‹åŠ¿çŸ©é˜µä¸çŠ¶æ€çš„å…³ç³»ï¼š</p><script type="math/tex; mode=display">\dot{X_t} = AX_t + Bu_t</script><p>å†™æˆç¦»æ•£çš„å½¢å¼å°±æ˜¯ï¼š</p><script type="math/tex; mode=display">X_k = AX_{k-1} + Bu_{k}</script><p>å½“ç„¶æœ€ååŠ ä¸Šä¸ç¡®å®šå› ç´ W</p><p><strong>å…³äºæµ‹é‡æ–¹ç¨‹ï¼š</strong></p><p>â€‹    ä¸€èˆ¬è€Œè¨€æˆ‘ä»¬å¯èƒ½ä¼šä¹ æƒ¯æŠŠ<strong>å¾…æ±‚é‡</strong>æ”¾åœ¨ç­‰å¼å·¦è¾¹ï¼Œå·²çŸ¥é‡æ”¾åœ¨ç­‰å¼å³è¾¹ã€‚ä½†æ˜¯åœ¨è¿™é‡Œ$Z_k$æ‰æ˜¯æˆ‘ä»¬å®é™…è·å¾—çš„æ•°æ®ã€‚</p><p>â€‹    å…³äºè½¬æ¢çŸ©é˜µHï¼Œä¸€èˆ¬æˆ‘ä»¬æ— æ³•ç›´æ¥æµ‹å¾—éœ€è¦çš„å¾…æµ‹é‡ï¼Œæ‰€ä»¥ä¼šæµ‹é‡å…¶ä»–é‡è®¡ç®—å‡ºå¾…æµ‹é‡ã€‚ä¸¾ä¸ªä¾‹å­</p><blockquote><p>æ¿€å…‰æµ‹è·ä»ªæµ‹è·ï¼šå‘å°„æ¿€å…‰ï¼Œæ ¹æ®è¿”å›ç”¨æ—¶è®¡ç®—è·ç¦»ã€‚ç›´æ¥è·å¾—çš„ç‰©ç†é‡æ˜¯ <strong>æ—¶é—´($Z_n$)</strong>ï¼Œè€Œæˆ‘ä»¬æƒ³è·å¾—çš„ <strong>è·ç¦»($X_n$)</strong>ï¼Œäºæ˜¯æœ‰äº†è½¬æ¢çŸ©é˜µ <strong>H($ \begin{bmatrix}\frac{2}{c}\end{bmatrix}$)</strong></p><script type="math/tex; mode=display">Z_n = \begin{bmatrix}\frac{2}{c}\end{bmatrix}X_n + V_n</script></blockquote><h2 id="æ•´ä½“ä»‹ç»"><a href="#æ•´ä½“ä»‹ç»" class="headerlink" title="æ•´ä½“ä»‹ç»"></a>æ•´ä½“ä»‹ç»</h2><h3 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h3><p><strong>å…ˆéªŒä¼°è®¡æ–¹ç¨‹ï¼š</strong></p><script type="math/tex; mode=display">\hat{X}_k^- = A\hat{X}_{k-1} + Bu_{k-1}</script><p><strong>å…ˆéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µï¼š</strong></p><script type="math/tex; mode=display">P_k^{-} = AP_{k-1}A^T + Q</script><h3 id="çŸ«æ­£"><a href="#çŸ«æ­£" class="headerlink" title="çŸ«æ­£"></a>çŸ«æ­£</h3><p><strong>å¡å°”æ›¼å¢ç›Šï¼š</strong></p><script type="math/tex; mode=display">K_k = \frac{P_k^- H^T}{HP_k^- H^T + R}</script><p><strong>åéªŒä¼°è®¡ï¼š</strong></p><script type="math/tex; mode=display">\hat{X}_k = \hat{X}_k^- + K_k( Z_k - H\hat{X}_k^-)</script><p><strong>åéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µï¼š</strong></p><script type="math/tex; mode=display">P_k = ( I - K_kH)P_k^-</script><h3 id="å˜é‡è¯´æ˜"><a href="#å˜é‡è¯´æ˜" class="headerlink" title="å˜é‡è¯´æ˜"></a>å˜é‡è¯´æ˜</h3><ul><li><script type="math/tex">\hat{X}_k^-</script>ï¼škæ—¶åˆ»å…ˆéªŒä¼°è®¡å€¼â€”â€”<strong>ç®—å‡ºæ¥çš„</strong></li><li>$\hat{X}_k$ï¼šæœ€ä¼˜ä¼°è®¡å€¼</li><li>$\hat{X}_{k-1}$ï¼šk-1æ—¶åˆ»æœ€ä¼˜ä¼°è®¡å€¼</li><li>$u_k-1$ï¼šæ§åˆ¶è¾“å…¥é‡</li><li>$K_k$ï¼šå¡å°”æ›¼å¢ç›Š</li><li>$Z_k$ï¼šæµ‹é‡å€¼â€”â€”<strong>æµ‹å‡ºæ¥çš„</strong></li><li>$W_{k-1}$ï¼šè¿‡ç¨‹å™ªå£°</li><li>$V_k$ï¼šæµ‹é‡å™ªå£°</li><li>Hï¼šç”±çŠ¶æ€é‡å‘æµ‹é‡é‡è½¬æ¢çš„çŸ©é˜µ</li></ul><p>å˜é‡<strong>å¸¦ä¸ªå¸½å­</strong>ä¸€èˆ¬æ˜¯<strong>ä¼°è®¡å€¼</strong>ï¼›å˜é‡å³ä¸Šè§’<strong>æœ‰ä¸ªâ€-â€œ</strong>ä¸€èˆ¬æ˜¯<strong>å…ˆéªŒå€¼</strong>ã€‚</p><h3 id="æµç¨‹æ¦‚è¿°"><a href="#æµç¨‹æ¦‚è¿°" class="headerlink" title="æµç¨‹æ¦‚è¿°"></a>æµç¨‹æ¦‚è¿°</h3><ol><li>ç”±ä¸Šä¸€æ—¶åˆ»<strong>æœ€ä¼˜ä¼°è®¡å€¼ $\hat{X}_{k-1}$</strong>è®¡ç®—<strong>å…ˆéªŒä¼°è®¡å€¼ $\hat{X}_k^-$</strong></li><li>è·å–<strong>æµ‹é‡å€¼ $Z_k$</strong></li><li>ç”±ä¸Šä¸€æ—¶åˆ»<strong>è¯¯å·®åæ–¹å·®çŸ©é˜µ $P_{k-1}$</strong>è®¡ç®—<strong>å…ˆéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µ $P_K^-$</strong></li><li>è®¡ç®—<strong>å¡å°”æ›¼å¢ç›Š$K_k$</strong></li><li>è®¡ç®—<strong>æœ€ä¼˜ä¼°è®¡å€¼<script type="math/tex">\hat{X}_k</script></strong></li><li>æ›´æ–°<strong>åéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µ $P_k$</strong></li><li>ä¸æ–­æ›´æ–°è¿­ä»£</li></ol><h2 id="å…¬å¼è¯´æ˜ä¸æ¨å¯¼"><a href="#å…¬å¼è¯´æ˜ä¸æ¨å¯¼" class="headerlink" title="å…¬å¼è¯´æ˜ä¸æ¨å¯¼"></a>å…¬å¼è¯´æ˜ä¸æ¨å¯¼</h2><h3 id="å…ˆéªŒä¼°è®¡æ–¹ç¨‹"><a href="#å…ˆéªŒä¼°è®¡æ–¹ç¨‹" class="headerlink" title="å…ˆéªŒä¼°è®¡æ–¹ç¨‹"></a>å…ˆéªŒä¼°è®¡æ–¹ç¨‹</h3><blockquote><script type="math/tex; mode=display">\hat{X}_k^- = A\hat{X}_{k-1} + Bu_{k-1}</script></blockquote><p>â€‹    ç”±ä¸Šä¸€æ—¶åˆ»çš„<strong>æœ€ä¼˜ä¼°è®¡å€¼</strong>ï¼Œæ ¹æ®è¿åŠ¨æ¨¡å‹æ¨æµ‹è¿™ä¸€æ—¶åˆ»çš„çŠ¶æ€å€¼ï¼Œå³<strong>å…ˆéªŒä¼°è®¡å€¼</strong>ã€‚å’Œ<strong>ä¼ é€’æ–¹ç¨‹</strong>ç±»ä¼¼ã€‚</p><h3 id="åéªŒä¼°è®¡æ–¹ç¨‹"><a href="#åéªŒä¼°è®¡æ–¹ç¨‹" class="headerlink" title="åéªŒä¼°è®¡æ–¹ç¨‹"></a>åéªŒä¼°è®¡æ–¹ç¨‹</h3><blockquote><script type="math/tex; mode=display">\hat{X}_k = \hat{X}_k^- + K_k( Z_k - H\hat{X}_k^-)</script></blockquote><p>â€‹    æƒ³è¦å¾—åˆ°<strong>æœ€ä¼˜ä¼°è®¡å€¼</strong>ï¼Œæ¦‚æ‹¬æ¥è¯´æ˜¯æ ¹æ®æ•°æ®çš„å¯é æ€§å°†<strong>æµ‹é‡å€¼</strong>å’Œ<strong>è®¡ç®—å€¼</strong>åŠ æƒå åŠ èµ·æ¥ï¼Œå¾—åˆ°çš„å°±æ˜¯<strong>åéªŒä¼°è®¡å€¼</strong>ï¼Œä¹Ÿå°±æ˜¯æ»¤æ³¢è¿‡åå¾—åˆ°çš„è¿™ä¸€æ—¶åˆ»çš„<strong>æœ€ä¼˜ä¼°è®¡å€¼</strong>ã€‚æ ¹æ®<strong>æ•°æ®èåˆ</strong>åŸç†å¾—åˆ°å…¬å¼ï¼š</p><script type="math/tex; mode=display">\hat{X}_k = \hat{X}_k^- + G( H^-Z_k - \hat{X}_k^-)</script><p>ä½†æ˜¯æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„éƒ½æ˜¯ä»¤ $G = K_kH$ å˜æ¢åçš„å½¢å¼ï¼Œå³ï¼š</p><script type="math/tex; mode=display">\hat{X}_k = \hat{X}_{k}^- + K_k ( Z_k - H\hat{X}_{k}^- )</script><p>å…¶ä¸­ $K_k$âˆˆ[0, $H^-$]</p><ul><li>å½“$K_k$ == 0 æ—¶ï¼Œæµ‹é‡è¯¯å·®å¾ˆå¤§ï¼Œä¿¡ä»»è®¡ç®—å‡ºæ¥çš„å€¼ï¼Œå³ $\hat{X}_{k} == \hat{X}_{k}^-$;</li><li>å½“$K_k == H^-$æ—¶ï¼Œæ— æµ‹é‡è¯¯å·®ï¼Œä¿¡ä»»æµ‹é‡å€¼ï¼Œå³$\hat{X}_{k} == H^-Z_k$ï¼›</li></ul><h3 id="å¡å°”æ›¼å¢ç›Š"><a href="#å¡å°”æ›¼å¢ç›Š" class="headerlink" title="å¡å°”æ›¼å¢ç›Š"></a>å¡å°”æ›¼å¢ç›Š</h3><blockquote><script type="math/tex; mode=display">K_k = \frac{P_k^- H^T}{HP_k^- H^T + R}</script></blockquote><p>è¦è®¡ç®—å¡å°”æ›¼å¢ç›Šï¼Œå³æ±‚å‡ºä½¿è¯¯å·®åæ–¹å·®æœ€å°çš„ $k_k$ï¼Œåœ¨æ±‚å‡ºå…¶å…³äº$K_k$ çš„è¡¨è¾¾å¼åå†æ±‚å¯¼å¾—åˆ°æå€¼ç‚¹ã€‚</p><h3 id="çŠ¶æ€ç©ºé—´æ–¹ç¨‹ï¼š"><a href="#çŠ¶æ€ç©ºé—´æ–¹ç¨‹ï¼š" class="headerlink" title="çŠ¶æ€ç©ºé—´æ–¹ç¨‹ï¼š"></a><strong>çŠ¶æ€ç©ºé—´æ–¹ç¨‹ï¼š</strong></h3><blockquote><script type="math/tex; mode=display">\hat{X}_k^- = A\hat{X}_{k-1} + Bu_{k-1} + W_{k-1}</script><script type="math/tex; mode=display">Z_k = HX_k + V_k</script></blockquote><p><img src="https://s2.loli.net/2022/11/03/hviNkZWEIeG39sw.jpg" alt="note1.jpg"></p><p><img src="https://s2.loli.net/2022/11/03/iwQRzfS7FlnPmZM.jpg" alt="note2.jpg"></p><h3 id="å…ˆåéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µ"><a href="#å…ˆåéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µ" class="headerlink" title="å…ˆåéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µ"></a>å…ˆåéªŒè¯¯å·®åæ–¹å·®çŸ©é˜µ</h3><blockquote><script type="math/tex; mode=display">P_k^{-} = AP_{k-1}A^T + Q</script><script type="math/tex; mode=display">P_k = ( I - K_kH)P_k^-</script></blockquote><p><img src="https://s2.loli.net/2022/11/03/8bS1wKNJ3EoAOy2.jpg" alt="note.jpg"></p><h2 id="åº”ç”¨ä¸¾ä¾‹"><a href="#åº”ç”¨ä¸¾ä¾‹" class="headerlink" title="åº”ç”¨ä¸¾ä¾‹"></a>åº”ç”¨ä¸¾ä¾‹</h2><p>ï¼ˆå¾…è¡¥å……ï¼‰</p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>â€‹    æ„Ÿè°¢å¤§å®¶è€å¿ƒçœ‹å®Œäº†æœ¬ç¯‡åšå®¢ï¼Œæ¬¢è¿å¤§å®¶åˆ†äº«ï¼›ç”±äºæˆ‘è‡ªå·±ä¹Ÿæ˜¯åˆå­¦è€…ï¼Œå¯¹å¡å°”æ›¼æ»¤æ³¢çš„ç†è§£è¿˜ä¸ç®—æ·±å…¥ï¼Œéš¾å…ä¼šæœ‰ä¸å®Œå–„ä¹‹å¤„ï¼Œè¿™ç¯‡æ–‡ç« ä½œä¸ºä¸€ç¯‡ç¬”è®°ç”±äºå¤§å®¶åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Kalman Filter </tag>
            
            <tag> æ»¤æ³¢ç®—æ³• </tag>
            
            <tag> æ§åˆ¶æ–¹æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IIC &amp; PCA9685</title>
      <link href="/2022/11/01/%E8%88%B5%E6%9C%BA%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9D%97%E8%B0%83%E8%AF%95%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/11/01/%E8%88%B5%E6%9C%BA%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9D%97%E8%B0%83%E8%AF%95%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>â€‹    æœ‰äº›æ—¶å€™éœ€è¦åŒæ—¶é©±åŠ¨å¤šä¸ªèˆµæœºï¼Œéœ€è¦ä¸ºæ¯ä¸€ä¸ªèˆµæœºè°ƒåˆ¶å‡ºå¯¹åº”çš„<strong>PWM</strong>è„‰å†²ä¿¡å·ï¼›å¦‚æœèˆµæœºå¾ˆå¤šçš„è¯ï¼Œä¼šå ç”¨ä¸»æ§çš„å¾ˆå¤šèµ„æºã€‚å¹¸è¿çš„æ˜¯æœ‰è¿™æ ·ä¸€æ¬¾æ¨¡å—ï¼Œåªéœ€è¦<strong>ä¸¤ä¸ªGPIOå£</strong>ï¼Œä¾¿å¯ä»¥é€šè¿‡<strong>I^2^Cé€šä¿¡åè®®</strong>æ§åˆ¶<strong>16</strong>è·¯èˆµæœºï¼ˆäº‹å®ä¸Šå¯ä»¥ä¸²è”å¤šä¸ªæ¨¡å—ï¼Œæ§åˆ¶æ›´å¤šèˆµæœºï¼‰ã€‚åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å…¶ä½¿ç”¨æ–¹æ³•å’Œä»£ç å®ç°æ–¹æ³•ã€‚</p><h1 id="I-2-Cé€šè®¯åè®®"><a href="#I-2-Cé€šè®¯åè®®" class="headerlink" title="I^2^Cé€šè®¯åè®®"></a>I^2^Cé€šè®¯åè®®</h1><p>ä¸€ç¯‡ä»‹ç»çš„å¾ˆè¯¦ç»†çš„æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/362287272">ä¸€æ–‡çœ‹æ‡‚I2Cåè®® - çŸ¥ä¹ (zhihu.com)</a></p><div class="note pink icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p>è¿™é‡Œé™„ä¸Šè¾ƒä¸ºæƒå¨çš„æ–‡ä»¶é“¾æ¥</p><ul><li><a href="https://semitia.top/upload_flies/TI_I2C_slva704.pdf">https://semitia.top/upload_flies/TI_I2C_slva704.pdf</a></li><li><a href="https://semitia.top/upload_flies/NXP_I2C_UM10204.pdf">https://semitia.top/upload_flies/NXP_I2C_UM10204.pdf</a></li><li><a href="https://semitia.top/upload_flies/ZLG_I2C.pdf">https://semitia.top/upload_flies/ZLG_I2C.pdf</a></li></ul></div><p>æ­¤ç¯‡ç¬”è®°åˆ™æ˜¯ç»“åˆ<strong>ã€ŠTI_I2C_slva704ã€‹</strong>å’Œ<strong>ä»£ç </strong>ç®€å•è®°å½•ä¸€äº›åŸºæœ¬åŠŸèƒ½ã€‚</p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>â€‹    <strong>IIC</strong>ä½¿ç”¨ä¸¤ä¸ªæ¥å£<strong>(SCLå’ŒSDA)</strong>è¿›è¡Œ<strong>åŠåŒå·¥é€šä¿¡</strong>ã€‚åˆ†ä¸º<strong>ä¸»æœºï¼ˆMaster)</strong>å’Œ<strong>ä»æœºï¼ˆSlave deviceï¼‰</strong>ï¼Œæ¯ä¸ªè®¾å¤‡æœ‰è‡ªå·±ç‰¹å®šçš„<strong>åœ°å€</strong>ï¼Œä¸€ä¸ªè®¾å¤‡æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå¯„å­˜å™¨å‚¨å­˜æ•°æ®ï¼Œä¸»æœºé€šè¿‡IICæ€»çº¿å¯¹è®¾å¤‡åŠå…¶å¯„å­˜å™¨è¿›è¡Œè¯»å†™å’Œé…ç½®ã€‚</p><h2 id="ä¸»æœºè®¿é—®ä»æœºçš„ä¸€èˆ¬æµç¨‹"><a href="#ä¸»æœºè®¿é—®ä»æœºçš„ä¸€èˆ¬æµç¨‹" class="headerlink" title="ä¸»æœºè®¿é—®ä»æœºçš„ä¸€èˆ¬æµç¨‹"></a>ä¸»æœºè®¿é—®ä»æœºçš„ä¸€èˆ¬æµç¨‹</h2><h3 id="å‘é€æ•°æ®ï¼š"><a href="#å‘é€æ•°æ®ï¼š" class="headerlink" title="å‘é€æ•°æ®ï¼š"></a>å‘é€æ•°æ®ï¼š</h3><ol><li>ä¸»æœºå‘é€<strong>START</strong>ä¿¡å·å’Œ<strong>è®¾å¤‡åœ°å€</strong>æ¥æŒ‡å®šä¸€ä¸ªè®¾å¤‡</li><li>ä¸»æœºå‘é€æ•°æ®</li><li>ä¸»æœºå‘é€<strong>STOP</strong>ä¿¡å·</li></ol><h3 id="æ¥æ”¶æ•°æ®ï¼š"><a href="#æ¥æ”¶æ•°æ®ï¼š" class="headerlink" title="æ¥æ”¶æ•°æ®ï¼š"></a>æ¥æ”¶æ•°æ®ï¼š</h3><ol><li>ä¸»æœºå‘é€<strong>START</strong>ä¿¡å·å’Œ<strong>è®¾å¤‡åœ°å€</strong>æ¥æŒ‡å®šä¸€ä¸ªè®¾å¤‡</li><li>ä¸»æœºæŒ‡å®šè¦è¯»å–çš„<strong>å¯„å­˜å™¨</strong></li><li>ä¸»æœºè¯»å–æ•°æ®</li><li>ä¸»æœºå‘é€<strong>STOP</strong>ä¿¡å·</li></ol><h2 id="STARTå’ŒSTOPä¿¡å·"><a href="#STARTå’ŒSTOPä¿¡å·" class="headerlink" title="STARTå’ŒSTOPä¿¡å·"></a>STARTå’ŒSTOPä¿¡å·</h2><ul><li><strong>STATRT</strong>ï¼šåœ¨<strong>SCL</strong>æ‹‰é«˜çš„æƒ…å†µä¸‹ï¼Œ<strong>SDA</strong>ç”µå¹³ç”±é«˜å˜ä½ï¼Œå³<strong>ä¸‹é™æ²¿</strong></li><li><strong>STOP</strong>ï¼šåœ¨<strong>SCL</strong>æ‹‰é«˜çš„æƒ…å†µä¸‹ï¼Œ<strong>SDA</strong>ç”µå¹³ç”±ä½å˜é«˜ï¼Œå³<strong>ä¸Šå‡æ²¿</strong></li></ul><p><img src="https://s2.loli.net/2022/11/02/Rkjp2zrVq8NGIy9.png" alt="IIC_1.png"></p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="START"><a href="#START" class="headerlink" title="START"></a>START</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">IIC_Start</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">SDA_OUT();     </span><br><span class="line">IIC_SDA=<span class="number">1</span>;    </span><br><span class="line">IIC_SCL=<span class="number">1</span>;</span><br><span class="line">delay_us(<span class="number">4</span>);</span><br><span class="line">IIC_SDA=<span class="number">0</span>;</span><br><span class="line">delay_us(<span class="number">4</span>);</span><br><span class="line">IIC_SCL=<span class="number">0</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><ul><li><code>SDA_OUT();</code>ï¼šå°†<strong>SDA</strong>ç«¯å£è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼ï¼›åœ¨åˆ‡æ¢è¯»å†™çŠ¶æ€çš„æ—¶å€™ï¼Œä¹Ÿè¦ä¿®æ”¹IOå£é…ç½®</li><li><code>IIC_SCL=0;</code>ï¼šIICæ€»çº¿æ¥ä¸Šæ‹‰ç”µé˜»ï¼Œæ•…é»˜è®¤<strong>é«˜ç”µå¹³</strong>çŠ¶æ€ä¸º<strong>æ€»çº¿ç©ºé—²</strong>çŠ¶æ€ï¼›ä¸»æœºæ¥ä¸‹æ¥è¦å‘é€æŒ‡ä»¤ï¼Œæ‰€ä»¥è¦æ‹‰ä½ç”µå¹³ï¼Œä¸»æœºæ§åˆ¶ä½æ€»çº¿ã€‚</li></ul><h4 id="STOP"><a href="#STOP" class="headerlink" title="STOP"></a>STOP</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">IIC_Stop</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">SDA_OUT();<span class="comment">//sdaÃÃŸÃŠÃ¤Â³Ã¶</span></span><br><span class="line">IIC_SCL=<span class="number">0</span>;</span><br><span class="line">IIC_SDA=<span class="number">0</span>;<span class="comment">//STOP:when CLK is high DATA change form low to high</span></span><br><span class="line">delay_us(<span class="number">4</span>);</span><br><span class="line">IIC_SCL=<span class="number">1</span>; </span><br><span class="line">IIC_SDA=<span class="number">1</span>;<span class="comment">//Â·Â¢Ã‹ÃI2CÃ—ÃœÃÃŸÂ½Ã¡ÃŠÃ¸ÃÃ…ÂºÃ…</span></span><br><span class="line">delay_us(<span class="number">4</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ACK-NACK-æœ‰æ— åº”ç­”"><a href="#ACK-NACK-æœ‰æ— åº”ç­”" class="headerlink" title="ACK/NACK æœ‰æ— åº”ç­”"></a>ACK/NACK æœ‰æ— åº”ç­”</h2><p>â€‹    åœ¨å®Œæˆä¸€ä¸ªå­—èŠ‚çš„ä¿¡æ¯ä¼ è¾“åï¼Œ<strong>æ¥æ”¶æ–¹</strong>å¯ä»¥å‘é€<strong>ACK</strong>ä»¥å‘ŠçŸ¥å‘é€æ–¹æ•°æ®è¢«æˆåŠŸæ¥æ”¶ï¼›ä¹Ÿå¯ä»¥é€‰æ‹©ä¸å‘é€ã€‚åœ¨æ¥æ”¶æ–¹å‘é€ACKä¹‹å‰ï¼Œå‘é€æ–¹å¿…é¡»é‡Šæ”¾SDAçº¿ï¼›æ¥æ”¶æ–¹<strong>æ‹‰ä½SDA</strong>ä»¥å‘é€ACKã€‚</p><p>â€‹    å€˜è‹¥åœ¨ACKä½SDAä»ç„¶ä¸ºé«˜ç”µä½ï¼Œåˆ™è®¤ä¸ºæ˜¯<strong>NACKâ€”â€”æ— åº”ç­”</strong>ï¼Œæ— åº”ç­”çš„ä¸€äº›æƒ…å†µï¼š</p><ul><li>æ¥æ”¶æ–¹æ²¡æœ‰åšå¥½æ¥æ”¶çš„å‡†å¤‡</li><li>æ¥æ”¶æ–¹æ— æ³•ç†è§£æ¥æ”¶åˆ°çš„æ•°æ®</li><li>æ¥æ”¶æ–¹æ— æ³•å†æ¥æ”¶æ›´å¤šæ•°æ®</li><li>ä¸»æœºä½œä¸ºæ¥æ”¶æ–¹å®Œæˆäº†æ•°æ®æ¥æ”¶</li></ul><p>â€‹    åœ¨è¿™æ ·çš„è§„å®šä¸‹ï¼Œå¦‚æœå‡ºç°äº†ä¸»æœºæ•°æ®æ¥æ”¶å¤±è´¥çš„æƒ…å†µçš„è¯è¯¥å¦‚ä½•åˆ¤å®šå‘¢ï¼Ÿæ˜¯ä¸æ˜¯å†²çªäº†å‘¢ï¼Ÿæˆ–è®¸ä¸»æœºå¯ä»¥é€šè¿‡ç¼–ç¨‹åˆ¤å®šæ¥å—å¤±è´¥ï¼Œè¿›è€Œé€‰æ‹©æ˜¯å¦é‡æ–°è¯·æ±‚æ•°æ®ã€‚</p><p><img src="https://s2.loli.net/2022/11/02/4eo2YpZhjNr7V5s.png" alt="IIC_2.png"></p><h2 id="WRITEå†™æ“ä½œ"><a href="#WRITEå†™æ“ä½œ" class="headerlink" title="WRITEå†™æ“ä½œ"></a>WRITEå†™æ“ä½œ</h2><ul><li><p>æ•°æ®ä¼ è¾“ä»¥<strong>ä¸€ä¸ªå­—(8bits)</strong>èŠ‚ä¸ºå•ä½ï¼Œæœ€å…ˆå‘é€<strong>MSB</strong>ï¼›</p></li><li><p>åœ¨<strong>STOPå’ŒSTART</strong>ä¿¡å·å¤–éœ€ä¿è¯<strong>SDA</strong>åªåœ¨<strong>SCL</strong>ä¸º<strong>ä½ç”µå¹³</strong>æ—¶å‘ç”Ÿè·³å˜ï¼›<strong>SCLé«˜</strong>æ—¶ä¿è¯<strong>SDA</strong>ç¨³å®šä»¥è¯»å–æ•°æ®ã€‚</p></li></ul><p>æ³¨ï¼š</p><p><strong>MSB &amp; LSB</strong>ï¼š</p><blockquote><p>MSB stands for most significant bit, while LSB is least significant bit. In binary terms, the MSB is the bit that has the greatest effect on the number, and it is the left-most bit. For example, for a binary number 0011 0101, the Most Significant 4 bits would be 0011. The Least Significant 4 bits would be 0101.</p></blockquote><h3 id="åè®®æµç¨‹"><a href="#åè®®æµç¨‹" class="headerlink" title="åè®®æµç¨‹"></a>åè®®æµç¨‹</h3><ol><li>ä¸»æœºå‘é€<strong>START</strong>ä¿¡å·</li><li>ä¸»æœºå‘é€<strong>7bitsè®¾å¤‡åœ°å€</strong></li><li><strong>R/W</strong>ä½ç½®0â€”â€”å†™0ï¼Œè¯»1</li><li>ç­‰å¾…åº”ç­”</li><li>ä¸»æœºå‘é€<strong>ä»è®¾å¤‡å¯„å­˜å™¨åœ°å€</strong></li><li>ç­‰å¾…åº”ç­”</li><li>å†™å…¥æ•°æ®</li><li>ç­‰å¾…åº”ç­”</li><li>ä¸»æœºå‘é€<strong>STOP</strong>ä¿¡å·ï¼Œæ“ä½œç»“æŸã€‚</li></ol><p><img src="https://s2.loli.net/2022/11/02/zMwCgD3Qt1vx5cy.png" alt="IIC_3.png"></p><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>æ­¤å¤„ä»…ä¸ºå‘é€ä¸€ä¸ªå­—èŠ‚çš„æµç¨‹ï¼Œå®Œæ•´æµç¨‹è¯·å‚è€ƒä¸‹æ–¹PCA9685å®æˆ˜ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">IIC_Send_Byte</span><span class="params">(u8 txd)</span></span><br><span class="line">&#123;                        </span><br><span class="line">    u8 t;   </span><br><span class="line">SDA_OUT();     </span><br><span class="line">    IIC_SCL=<span class="number">0</span>;<span class="comment">//Ã€Â­ÂµÃÃŠÂ±Ã–Ã“Â¿ÂªÃŠÂ¼ÃŠÃ½Â¾ÃÂ´Â«ÃŠÃ¤</span></span><br><span class="line">    <span class="keyword">for</span>(t=<span class="number">0</span>;t&lt;<span class="number">8</span>;t++)</span><br><span class="line">    &#123;              </span><br><span class="line">        IIC_SDA=(txd&amp;<span class="number">0x80</span>)&gt;&gt;<span class="number">7</span>;</span><br><span class="line">        txd&lt;&lt;=<span class="number">1</span>;   </span><br><span class="line">delay_us(<span class="number">2</span>); </span><br><span class="line">IIC_SCL=<span class="number">1</span>;</span><br><span class="line">delay_us(<span class="number">2</span>); </span><br><span class="line">IIC_SCL=<span class="number">0</span>;</span><br><span class="line">delay_us(<span class="number">2</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="READè¯»æ“ä½œ"><a href="#READè¯»æ“ä½œ" class="headerlink" title="READè¯»æ“ä½œ"></a>READè¯»æ“ä½œ</h2><h3 id="åè®®æµç¨‹-1"><a href="#åè®®æµç¨‹-1" class="headerlink" title="åè®®æµç¨‹"></a>åè®®æµç¨‹</h3><ol><li>å‰ä¸¤ä¸ªå­—èŠ‚ä¸å†™æ“ä½œç›¸åŒ</li><li>ä¸»æœºé‡å¤å‘é€ä¸€æ¬¡<strong>START</strong>ä¿¡å·</li><li>ä¸»æœºå‘é€ä»è®¾å¤‡åœ°å€</li><li><strong>R/Wç½®</strong><span class='p red'>1</span>â€”â€”è¯»æ“ä½œ</li><li>ç­‰å¾…åº”ç­”</li><li>ä¸»æœºè¯»å–æ•°æ®</li><li>ä¸»æœº<strong>ä¸å‘é€</strong>åº”ç­”ä¿¡å·</li><li>ä¸»æœºå‘é€<strong>STOP</strong>ä¿¡å·</li></ol><p><img src="https://s2.loli.net/2022/11/02/hQueywRLE3xf4v5.png" alt="IIC_4.png"></p><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>åŒæ ·æ˜¯åªè¯»å–ä¸€ä¸ªå­—èŠ‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">u8 <span class="title function_">IIC_Read_Byte</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> ack)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> i,receive=<span class="number">0</span>;</span><br><span class="line">SDA_IN();</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++ )</span><br><span class="line">&#123;</span><br><span class="line">        IIC_SCL=<span class="number">0</span>; </span><br><span class="line">        delay_us(<span class="number">2</span>);</span><br><span class="line">IIC_SCL=<span class="number">1</span>;</span><br><span class="line">        receive&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(READ_SDA)receive++;   </span><br><span class="line">delay_us(<span class="number">1</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span> (!ack)</span><br><span class="line">        IIC_NAck();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        IIC_Ack();</span><br><span class="line">    <span class="keyword">return</span> receive;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="PCA9685èŠ¯ç‰‡"><a href="#PCA9685èŠ¯ç‰‡" class="headerlink" title="PCA9685èŠ¯ç‰‡"></a>PCA9685èŠ¯ç‰‡</h1><p>èŠ¯ç‰‡æ‰‹å†Œï¼š<a href="https://semitia.top/upload_flies/PCA9685.pdf">https://semitia.top/upload_flies/PCA9685.pdf</a></p><p>èŠ¯ç‰‡æ‰‹å†Œçš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åœ¨è¿™é‡Œåªè®°å½•ä¸€äº›ä½¿ç”¨æŒ‡å¯¼æ€§ç›¸å¯¹æ›´é«˜çš„ä¸€äº›å†…å®¹ï¼ˆä¸»è¦å‚è€ƒç¬¬ä¸ƒå°èŠ‚ï¼‰ã€‚</p><h2 id="åœ°å€"><a href="#åœ°å€" class="headerlink" title="åœ°å€"></a>åœ°å€</h2><h3 id="è®¾å¤‡åœ°å€"><a href="#è®¾å¤‡åœ°å€" class="headerlink" title="è®¾å¤‡åœ°å€"></a>è®¾å¤‡åœ°å€</h3><p><img src="https://s2.loli.net/2022/11/02/zYo4QDi6RUrBw1L.png" alt="IIC_5.png"></p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹è®¾å¤‡åœ°å€æ˜¯<strong>0x40</strong>ï¼Œå¦‚æœç®—ä¸Šæœ€å<strong>R/W</strong>ä½çš„è¯å°±æ˜¯<strong>0x80</strong>ã€‚</p><p>åœ¨æ¨¡å—ä¸Šèƒ½å¤Ÿçœ‹åˆ°å…­ä¸ªç•™ç©ºçš„ç„Šç‚¹ï¼Œå¯ä»¥é€‰æ‹©æŠŠéƒ¨åˆ†ç„Šç‚¹ç„Šä¸Šï¼Œè®¾å¤‡çš„åœ°å€å¯¹åº”ä½å°±ä¼šè¢«<strong>ç½®ä¸€</strong>ã€‚æ¯”å¦‚æŠŠ<strong>ç¬¬0ä½</strong>ç„Šä¸Šï¼Œåœ°å€å°±å˜ä¸ºäº†<strong>1000001</strong>ã€‚</p><h3 id="å¯„å­˜å™¨åœ°å€"><a href="#å¯„å­˜å™¨åœ°å€" class="headerlink" title="å¯„å­˜å™¨åœ°å€"></a>å¯„å­˜å™¨åœ°å€</h3><p>è¿™æ˜¯éƒ¨åˆ†å¯„å­˜å™¨æ€»è§ˆè¡¨ï¼Œä¸€å…±æœ‰16ä¸ªledã€‚å„ä¸ªå¯„å­˜å™¨çš„åœ°å€ä¹Ÿéƒ½å¾ˆæ¸…æ¥šåœ°åˆ—äº†å‡ºæ¥</p><p><img src="https://s2.loli.net/2022/11/02/mXtORuGvFCWUkNr.png" alt="IIC_6.png"></p><h2 id="éƒ¨åˆ†å¯„å­˜å™¨ä»‹ç»"><a href="#éƒ¨åˆ†å¯„å­˜å™¨ä»‹ç»" class="headerlink" title="éƒ¨åˆ†å¯„å­˜å™¨ä»‹ç»"></a>éƒ¨åˆ†å¯„å­˜å™¨ä»‹ç»</h2><h3 id="MODE1å¯„å­˜å™¨"><a href="#MODE1å¯„å­˜å™¨" class="headerlink" title="MODE1å¯„å­˜å™¨"></a>MODE1å¯„å­˜å™¨</h3><p><img src="https://s2.loli.net/2022/11/02/oJsCdm8rMcOBLFj.png" alt="IIC_7.png"></p><p>æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯<strong>ç¬¬å››ä½</strong>ï¼Œå³<strong>SLEEP</strong>ä½ï¼Œå› ä¸ºåœ¨è¯»å†™å…¶ä»–å¯„å­˜å™¨çš„æ—¶å€™ä¼šéœ€è¦å°†èŠ¯ç‰‡ä¼‘çœ ï¼Œå¾…ä¼šåœ¨åŸç ä»‹ç»ä¸­ä¹Ÿä¼šè§åˆ°ã€‚</p><p><img src="https://s2.loli.net/2022/11/02/KA7VLulbwsmYzqn.png" alt="IIC_8.png"></p><h3 id="LED-ON-OFF-H-L"><a href="#LED-ON-OFF-H-L" class="headerlink" title="LED_ON_OFF_H_L"></a>LED_ON_OFF_H_L</h3><p>æ¯ä¸ªPWM(led)è¾“å‡ºç«¯å£çš„é…ç½®å¯¹åº”å››ä¸ªå¯„å­˜å™¨</p><ul><li>LEDn_ON_H</li><li>LEDn_ON_L</li><li>LEDn_OFF_H</li><li>LED_OFF_L</li></ul><p>æ¯ä¸ªå¯„å­˜å™¨æ˜¯<strong>8ä½</strong>å¯„å­˜å™¨ï¼Œä½†æ˜¯<strong>ON</strong>æˆ–<strong>OFF</strong>åªä¼šåˆ†åˆ«å‚¨å­˜<strong>åäºŒä½</strong>çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯<em>L</em>å­˜8ä½ï¼Œ<em>H</em>å­˜4ä½</p><p><img src="https://s2.loli.net/2022/11/02/lFafpNvyibHqVjo.png" alt="IIC_9.png"></p><p>å…·ä½“çš„å¯„å­˜å™¨æ•°æ®å’ŒPWMæ³¢å½¢çš„å…³ç³»å¦‚ä¸‹</p><blockquote><p>â€‹    <strong>ON</strong>å’Œ<strong>OFF</strong>åˆ†åˆ«å­˜å‚¨ç€èŒƒå›´<strong>0~4096</strong>çš„å€¼(ç¡®å®æ˜¯4096è€Œé4095)ï¼Œæˆ‘ä»¬æŠŠä¸¤ä¸ªå€¼è®°ä½œ<strong>cnt_on, cnt_off</strong>å§ã€‚æœ‰ä¸€ä¸ªè®¡æ•°å™¨ä»0è®¡æ•°åˆ°<strong>4095</strong>ï¼Œæˆ‘ä»¬æŠŠè®¡æ•°å™¨çš„å€¼è®°ä½œ<strong>CNT</strong>ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯<code>cnt_on &lt; cnt_off</code>ï¼š</p><ul><li>å½“<code>CNT == cnt_on</code>æ—¶ï¼ŒPWMæ³¢<strong>ç”±ä½å˜é«˜</strong>ï¼›</li><li>å½“<code>CNT == cnt_off</code>æ—¶ï¼ŒPWMæ³¢<strong>ç”±é«˜å˜ä½</strong>ï¼›</li></ul><p>å½“<code>cnt_off &lt; cnt_on</code>æ—¶ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‘¨æœŸå†…<code>CNT == cnt_off</code>ä¸åšå˜åŒ–ã€‚</p><p>å¯ä»¥çœ‹å‡ºï¼Œæ§åˆ¶ç²¾åº¦æ˜¯<strong>1/4096</strong>å‘¨æœŸã€‚</p></blockquote><p>å…·ä½“çš„PWMè°ƒåˆ¶æ–¹æ³•æˆ‘ä»¬ç»“åˆå®˜æ–¹æ‰‹å†Œé‡Œé¢ç»™å‡ºçš„ä¸¤ä¸ªä¾‹å­å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼š</p><p><img src="https://s2.loli.net/2022/11/02/e9yZhwCiX5AImpc.png" alt="IIC_10.png"></p><p>ï¼ˆè¿™é‡Œæˆ‘æ„Ÿè§‰ <em>Fig 7</em> å›¾é‡Œçš„<strong>819</strong>æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯<strong>410</strong>ï¼‰</p><p><img src="https://s2.loli.net/2022/11/02/82lKZfsdSYL9EnW.png" alt="IIC_11.png"></p><h3 id="PRE-SCALE"><a href="#PRE-SCALE" class="headerlink" title="PRE_SCALE"></a>PRE_SCALE</h3><p><img src="https://s2.loli.net/2022/11/02/Y9Ch54OApUxLM8e.png" alt="IIC_12.png"></p><p>â€‹    <strong>PRE_SCALE</strong>å¯„å­˜å™¨ç”¨ä»¥è°ƒåˆ¶PWMé¢‘ç‡ã€‚é©±åŠ¨èˆµæœºçš„è¯æˆ‘ä»¬éœ€è¦<strong>20ms</strong>çš„è„‰å†²ï¼Œé¢‘ç‡ä¸º<strong>50Hz</strong>ã€‚</p><p>â€‹    å¦‚æœå­¦ä¹ è¿‡STM32ç”¨å®šæ—¶å™¨è¾“å‡ºPWMçš„è¯åº”è¯¥å¾ˆå®¹æ˜“ç†è§£ï¼Œåªä¸è¿‡è¿™é‡Œçš„<strong>è‡ªåŠ¨é‡è£…è½½å€¼</strong>å›ºå®šä¸º4096ã€‚</p><p>â€‹    æ—¶é’Ÿç»™å‡ºçš„æ˜¯<strong>25MHz</strong>çš„é¢‘ç‡ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®<strong>nåˆ†é¢‘</strong>ï¼Œé‚£ä¹ˆ<strong>è®¡æ•°å™¨</strong>å°±ä¼šæ¯è¿‡<strong>$\frac{n}{25000000}$</strong>ç§’è®¡æ•°ä¸€æ¬¡ï¼Œé‚£ä¹ˆ$T_n = \frac{4096n}{25000000}$ç§’å°±æ˜¯ä¸€ä¸ªå‘¨æœŸã€‚å‡å¦‚æˆ‘ä»¬è¦<strong>50Hz</strong>çš„è„‰å†²ï¼Œé‚£ä¹ˆå‘¨æœŸåº”è¯¥æ˜¯<strong>20ms</strong>ï¼Œä»¤$T_n == 0.02s$ï¼Œè§£å¾—nï¼Œé‚£ä¹ˆåˆ†é¢‘ç³»æ•°è®¾ç½®ä¸º<strong>n-1</strong>å³å¯ã€‚</p><p>â€‹    ä¸ºä»€ä¹ˆè¦å‡å»ä¸€å‘¢ï¼Ÿå› ä¸ºä¸åˆ†é¢‘å…¶å®ä¹Ÿå°±æ˜¯<strong>ä¸€åˆ†é¢‘</strong>ï¼Œä½†æ˜¯é»˜è®¤<code>prescale value == 0</code>æ—¶æ˜¯ä¸åˆ†é¢‘ã€‚</p><h2 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="Writeå†™æ•°æ®"><a href="#Writeå†™æ•°æ®" class="headerlink" title="Writeå†™æ•°æ®"></a>Writeå†™æ•°æ®</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">pca_write1</span><span class="params">(u8 adr,u8 data)</span></span><br><span class="line">&#123; </span><br><span class="line">IIC_Start();</span><br><span class="line"></span><br><span class="line">IIC_Send_Byte(pca_adr1);</span><br><span class="line">IIC_Wait_Ack();</span><br><span class="line"></span><br><span class="line">IIC_Send_Byte(adr);</span><br><span class="line">IIC_Wait_Ack();</span><br><span class="line"></span><br><span class="line">IIC_Send_Byte(data);</span><br><span class="line">IIC_Wait_Ack();</span><br><span class="line"></span><br><span class="line">IIC_Stop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/11/02/zMwCgD3Qt1vx5cy.png" alt="IIC_3.png"></p><p>è¿™é‡Œè´´ä¸Šä¹‹å‰çš„æµç¨‹å›¾æ–¹ä¾¿æ¯”å¯¹ã€‚</p><h3 id="Readè¯»æ•°æ®"><a href="#Readè¯»æ•°æ®" class="headerlink" title="Readè¯»æ•°æ®"></a>Readè¯»æ•°æ®</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">u8 <span class="title function_">pca_read1</span><span class="params">(u8 adr)</span></span><br><span class="line">&#123;</span><br><span class="line">u8 data;</span><br><span class="line">IIC_Start();</span><br><span class="line"></span><br><span class="line">IIC_Send_Byte(pca_adr1);</span><br><span class="line">IIC_Wait_Ack();</span><br><span class="line"></span><br><span class="line">IIC_Send_Byte(adr);</span><br><span class="line">IIC_Wait_Ack();</span><br><span class="line"></span><br><span class="line">IIC_Start();</span><br><span class="line"></span><br><span class="line">IIC_Send_Byte(pca_adr1|<span class="number">0x01</span>);</span><br><span class="line">IIC_Wait_Ack();</span><br><span class="line"></span><br><span class="line">data=IIC_Read_Byte(<span class="number">0</span>);</span><br><span class="line">IIC_Stop();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/11/02/hQueywRLE3xf4v5.png" alt="IIC_4.png"></p><h3 id="è®¾ç½®åˆ†é¢‘ç³»æ•°"><a href="#è®¾ç½®åˆ†é¢‘ç³»æ•°" class="headerlink" title="è®¾ç½®åˆ†é¢‘ç³»æ•°"></a>è®¾ç½®åˆ†é¢‘ç³»æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">pca_setfreq1</span><span class="params">(<span class="type">float</span> freq)</span> </span><br><span class="line">&#123;</span><br><span class="line">u8 prescale,oldmode,newmode;</span><br><span class="line"><span class="type">double</span> prescaleval;</span><br><span class="line">freq *= <span class="number">0.92</span>; </span><br><span class="line">prescaleval = <span class="number">25000000</span>;</span><br><span class="line">prescaleval /= <span class="number">4096</span>;</span><br><span class="line">prescaleval /= freq;</span><br><span class="line">prescaleval -= <span class="number">1</span>;</span><br><span class="line">prescale =<span class="built_in">floor</span>(prescaleval + <span class="number">0.5f</span>);</span><br><span class="line"></span><br><span class="line">oldmode = pca_read1(pca_mode1); <span class="comment">//è·å–ä¹‹å‰modeå¯„å­˜å™¨é…ç½®çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">newmode = (oldmode&amp;<span class="number">0x7F</span>) | <span class="number">0x10</span>; <span class="comment">// ç¡çœ æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">pca_write1(pca_mode1, newmode); <span class="comment">// è¿›å…¥ç¡çœ </span></span><br><span class="line"></span><br><span class="line">pca_write1(pca_pre, prescale); <span class="comment">// è®¾ç½®åˆ†é¢‘ç³»æ•°</span></span><br><span class="line"></span><br><span class="line">pca_write1(pca_mode1, oldmode); <span class="comment">//å†™å›åŸæ¥</span></span><br><span class="line">delay_ms(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">pca_write1(pca_mode1, oldmode | <span class="number">0xa1</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    æ³¨æ„æ‰‹å†Œé‡Œä¹Ÿå¤šæ¬¡å¼ºè°ƒï¼Œ<span class='p red'>åªæœ‰åœ¨è®¾å¤‡è¿›å…¥ç¡çœ æ¨¡å¼ä¹‹åæ‰èƒ½ä¿®æ”¹åˆ†é¢‘ç³»æ•°</span></p><p>è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹<strong>MODE1</strong>å¯„å­˜å™¨é‡Œçš„<emp>RESTART</emp>ä½</p><div class="note info modern"><p>åœ¨<strong>ä¸åœæ­¢PWMé€šé“è¾“å‡º</strong>çš„æƒ…å†µä¸‹å°†è®¾å¤‡è®¾ç½®ä¸ºsleepæ¨¡å¼ï¼Œ<strong>RESTART</strong>ä½ä¼šåœ¨ä¸€ä¸ªPWMå‘¨æœŸåè¢«ç½®1ï¼Œ<strong>LED</strong>å¯„å­˜å™¨é‡Œé¢çš„æ•°æ®ä¼šè¢«ä¿å­˜ã€‚æƒ³è¦é‡å¯ï¼Œå‘<strong>RESTART</strong>ä½å†™1å³å¯ï¼Œæ­¤æ—¶è¯¥ä½ä¼šè¢«è‡ªåŠ¨<strong>ç½®0</strong>ã€‚</p></div><p>â€‹    å½“ç„¶ï¼Œåœ¨è¿™æ®µä»£ç ä¸­è¿˜è®¾ç½®äº†<strong>ALLCALLã€AL</strong>ä½ã€‚</p><h3 id="è°ƒåˆ¶PWMå ç©ºæ¯”"><a href="#è°ƒåˆ¶PWMå ç©ºæ¯”" class="headerlink" title="è°ƒåˆ¶PWMå ç©ºæ¯”"></a>è°ƒåˆ¶PWMå ç©ºæ¯”</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">pca_setpwm1</span><span class="params">(u8 num, u32 on, u32 off)</span> </span><br><span class="line">&#123;</span><br><span class="line">pca_write1(LED0_ON_L+<span class="number">4</span>*num,on);</span><br><span class="line">pca_write1(LED0_ON_H+<span class="number">4</span>*num,on&gt;&gt;<span class="number">8</span>);</span><br><span class="line">pca_write1(LED0_OFF_L+<span class="number">4</span>*num,off);</span><br><span class="line">pca_write1(LED0_OFF_H+<span class="number">4</span>*num,off&gt;&gt;<span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªâ€œLEDâ€æœ‰å››ä¸ªå¯„å­˜å™¨ï¼Œæ‰€ä»¥<strong>ç¬¬nä¸ª</strong>ledåœ°å€ä¸º<strong>LED0</strong>åœ°å€åŠ <strong>4n</strong>ã€‚</p><h1 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h1><p>æ„Ÿè°¢å¤§å®¶è€å¿ƒçœ‹å®Œäº†æœ¬ç¯‡åšå®¢ï¼Œæ¬¢è¿å¤§å®¶åˆ†äº«ï¼›å®Œæ•´çš„å·¥ç¨‹å¯ä»¥åœ¨æˆ‘çš„<strong>GiHub</strong>ä»“åº“æ‰¾åˆ°ã€‚ç”±äºæœ¬äººæ°´å¹³æœ‰é™ï¼Œå¯èƒ½æœ‰ä¸å®Œå–„ä¹‹å¤„ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> STM32 </tag>
            
            <tag> IIC </tag>
            
            <tag> èˆµæœº </tag>
            
            <tag> PCA9685 </tag>
            
            <tag> é€šè®¯åè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰è¶£çš„ä½è¿ç®—</title>
      <link href="/2022/10/29/%E6%9C%89%E8%B6%A3%E7%9A%84%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
      <url>/2022/10/29/%E6%9C%89%E8%B6%A3%E7%9A%84%E4%BD%8D%E8%BF%90%E7%AE%97/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ‰æ„æ€çš„æ“ä½œ"><a href="#æœ‰æ„æ€çš„æ“ä½œ" class="headerlink" title="æœ‰æ„æ€çš„æ“ä½œ"></a>æœ‰æ„æ€çš„æ“ä½œ</h1><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><p>ä½è¿ç®—æ˜¯ç®—æ³•é¢˜é‡Œæ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç§ç±»å‹ï¼Œå®ƒä»¬åˆ©ç”¨äºŒè¿›åˆ¶ä½è¿ç®—çš„ç‰¹æ€§è¿›è¡Œä¸€äº›å¥‡å¦™çš„ä¼˜åŒ–å’Œè®¡ç®—ã€‚å¸¸ç”¨çš„ä½è¿ç®—ç¬¦å·åŒ…æ‹¬ï¼šâ€œâˆ§â€ æŒ‰ä½å¼‚æˆ–ï¼ˆå–ä¸åŒï¼‰ã€â€œ&amp;â€ æŒ‰ä½ä¸ï¼ˆå–äº¤ï¼‰ã€â€œ|â€ æŒ‰ä½æˆ–ï¼ˆå–å¹¶ï¼‰ã€â€œ~â€ å–åã€â€œ&lt;&lt;â€ ç®—æœ¯å·¦ç§»å’Œ â€œ&gt;&gt;â€ ç®—æœ¯å³ç§»ã€‚</p><ul><li>n &amp; (n - 1) å¯ä»¥å»é™¤ n çš„ä½çº§è¡¨ç¤ºä¸­æœ€ä½çš„é‚£ä¸€ä½ï¼Œä¾‹å¦‚å¯¹äºäºŒè¿›åˆ¶è¡¨ç¤º 11110100 ï¼Œå‡å» 1 å¾—åˆ° 11110011ï¼Œè¿™ä¸¤ä¸ªæ•°æŒ‰ä½ä¸å¾—åˆ° 11110000ã€‚</li><li>n &amp; (-n) å¯ä»¥å¾—åˆ° n çš„ä½çº§è¡¨ç¤ºä¸­æœ€ä½çš„é‚£ä¸€ä½ï¼Œä¾‹å¦‚å¯¹äºäºŒè¿›åˆ¶è¡¨ç¤º 11110100ï¼Œå–è´Ÿå¾—åˆ° 00001100ï¼Œè¿™ä¸¤ä¸ªæ•°æŒ‰ä½ä¸å¾—åˆ° 00000100ã€‚</li></ul><h2 id="è·å–äºŒè¿›åˆ¶æ•°ä¸­1çš„ä¸ªæ•°"><a href="#è·å–äºŒè¿›åˆ¶æ•°ä¸­1çš„ä¸ªæ•°" class="headerlink" title="è·å–äºŒè¿›åˆ¶æ•°ä¸­1çš„ä¸ªæ•°"></a>è·å–äºŒè¿›åˆ¶æ•°ä¸­1çš„ä¸ªæ•°</h2><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">bitset_contains</span><span class="params">(u32 s,<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(((s&gt;&gt;i) &amp; <span class="number">0x01</span>) == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bitset_size0</span><span class="params">(u32 s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        n += <span class="built_in">bitset_contains</span>(s,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>int bitset_contains(u32 s,int i)</code>å°±æ˜¯åˆ¤æ–­sçš„<strong>ç¬¬iä½</strong>ï¼ˆä»<strong>ç¬¬0ä½</strong>å¼€å§‹è®¡èµ·ï¼‰æ˜¯å¦ä¸º1ã€‚</p><p><code>int bitset_size0(u32 s)</code>å°±æ˜¯ä¸€ä½ä½çœ‹æ˜¯ä¸æ˜¯1ï¼Œæ˜¯å°±<strong>è®¡æ•°åŠ ä¸€</strong>ã€‚</p><p>æœ€åæ•ˆæœå°±æ˜¯<strong>ç»Ÿè®¡sä¸º1çš„ä½æ•°</strong></p><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">bitset_size</span><span class="params">(u32 s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    s = (s &amp; <span class="number">0x55555555</span>) + ((s&gt;&gt;<span class="number">1</span>) &amp; <span class="number">0x55555555</span>); <span class="comment">//01010101010101010101010101010101</span></span><br><span class="line">    s = (s &amp; <span class="number">0x33333333</span>) + ((s&gt;&gt;<span class="number">2</span>) &amp; <span class="number">0x33333333</span>); <span class="comment">//00110011001100110011001100110011</span></span><br><span class="line">    s = (s &amp; <span class="number">0x0f0f0f0f</span>) + ((s&gt;&gt;<span class="number">4</span>) &amp; <span class="number">0x0f0f0f0f</span>); <span class="comment">//00001111000011110000111100001111</span></span><br><span class="line">    s = (s &amp; <span class="number">0x00ff00ff</span>) + ((s&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0x00ff00ff</span>); <span class="comment">//00000000111111110000000011111111</span></span><br><span class="line">    s = (s &amp; <span class="number">0x0000ffff</span>) + ((s&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0x0000ffff</span>);<span class="comment">//00000000000000001111111111111111</span></span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    ä¸€èˆ¬æ¥è¯´ï¼Œçœ‹åˆ°è¿™æ ·çš„<strong>åå…­è¿›åˆ¶</strong>æ•°å°±ä¼šä¸ç”±è‡ªä¸»åœ°æƒ³æŠŠå®ƒä»¬è½¬æ¢ä¸º<strong>äºŒè¿›åˆ¶</strong>çœ‹çœ‹ã€‚è½¬æ¢ä¹‹åå‘¢å°±èƒ½ç¨å¾®çœ‹å‡ºä¸€äº›ç«¯å€ªäº†ã€‚ğŸ˜</p><p>â€‹    <code>0x55555555</code>å°†såˆ†ä¸º<strong>ä¸¤ä¸ªä¸€ç»„</strong>ï¼Œæ¯ä¸€ç»„ä¸¤ä½æ•°ã€‚å…¶å®å°±æ˜¯==åˆ†åˆ«åˆ¤æ–­ä¸€ç»„é‡Œçš„ä¸¤ä½æ•°æ˜¯ä¸æ˜¯1==ã€‚</p><ul><li>éƒ½æ˜¯1ï¼Œåˆ™å˜ä¸º<strong>1+1=10</strong>ï¼›</li><li>åªæœ‰ä¸€ä¸ªï¼Œå°±å˜ä¸º<strong>01</strong>ï¼›</li><li>æ²¡æœ‰åˆ™ä¸º<strong>0</strong></li></ul><p>â€‹    å˜æ¢å®Œäº†ä¹‹åå‘¢ï¼Œå‚¨å­˜çš„å°±æ˜¯è¿™ä¸€ç»„é‡Œ <em>â€œ1â€</em> çš„ä¸ªæ•°ã€‚</p><p>â€‹    <code>0x33333333</code>åˆ™æ˜¯å°†såˆ†ä¸º<strong>å››ä¸ªä¸€ç»„</strong>ï¼Œä¸€ç»„é‡ŒåŒæ ·æ˜¯<strong>ä¸¤ä¸ªæ•°</strong>ï¼Œåªä¸è¿‡ä¸€ä¸ªæ•°æ˜¯<strong>ä¸¤ä½</strong>ã€‚æ“ä½œçš„ç»“æœå‘¢å°±æ˜¯<strong>å°†ä¸¤ä¸ªæ•°å„è‡ªä¸¤ä¸ªä½é‡Œ1çš„ä¸ªæ•°</strong>åŠ èµ·æ¥ï¼Œå³<strong>å››ä¸ªä½é‡Œ1çš„ä¸ªæ•°</strong>ã€‚</p><p>â€‹    <code>0x0f0f0f0f</code>å°†såˆ†ä¸º<strong>å…«ä¸ªä¸€ç»„</strong>ï¼Œç»Ÿè®¡<strong>å…«ä¸ªä½é‡Œ1çš„ä¸ªæ•°</strong></p><p>â€‹    <code>0x00ff00ff</code>å°†såˆ†ä¸º<strong>åå…­ä¸ªä¸€ç»„</strong>ï¼Œç»Ÿè®¡<strong>åå…­ä½é‡Œ1çš„ä¸ªæ•°</strong></p><p>â€‹    <code>0x0000ffff</code>å°†æ•´ä¸ª32ä½çš„sçœ‹ä½œä¸€ç»„ï¼Œç»Ÿè®¡<strong>æ‰€æœ‰1çš„ä¸ªæ•°</strong></p><h2 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h2><p>â€‹    ä¸¤ç§æ–¹æ³•æ¯”è¾ƒæ¥çœ‹ï¼Œæ˜æ˜¾æ˜¯ç¬¬ä¸€ç§æ–¹æ³•ç®€å•æ˜“æ‡‚ï¼Œä¹Ÿå®¹æ˜“æƒ³åˆ°ï¼›ä½†æ˜¯ä»è¿ç®—æ•ˆç‡ä¸Šæ¥çœ‹ï¼Œç¬¬äºŒç§è¿œè¿œé«˜äºç¬¬ä¸€ç§ã€‚</p><h1 id="é¥æ§æ•°æ®è§£æ"><a href="#é¥æ§æ•°æ®è§£æ" class="headerlink" title="é¥æ§æ•°æ®è§£æ"></a>é¥æ§æ•°æ®è§£æ</h1><p><img src="https://s2.loli.net/2022/10/29/7vaHiBuG1CXbV9m.png" alt="é¥æ§åè®®.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">RemoteReceive</span><span class="params">(<span class="keyword">volatile</span> <span class="type">uint8_t</span> *<span class="type">const</span> ptr_sbus_rx_buffer)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(ptr_sbus_rx_buffer == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    RC_Ctl.rc.ch0 = (ptr_sbus_rx_buffer[<span class="number">0</span>] | (ptr_sbus_rx_buffer[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>)) &amp;<span class="number">0x07ff</span>;</span><br><span class="line">    RC_Ctl.rc.ch1 = (ptr_sbus_rx_buffer[<span class="number">1</span>] &gt;&gt; <span class="number">3</span>) | (ptr_sbus_rx_buffer[<span class="number">2</span>] &lt;&lt; <span class="number">5</span>) &amp; <span class="number">0x07ff</span>;</span><br><span class="line">    RC_Ctl.rc.ch2 = (ptr_sbus_rx_buffer[<span class="number">2</span>] &gt;&gt; <span class="number">6</span>) | (ptr_sbus_rx_buffer[<span class="number">3</span>] &lt;&lt; <span class="number">2</span>) | (ptr_sbus_rx_buffer[<span class="number">4</span>] &lt;&lt; <span class="number">10</span>) &amp; <span class="number">0x07ff</span>;</span><br><span class="line">    RC_Ctl.rc.ch3 = (ptr_sbus_rx_buffer[<span class="number">4</span>] &gt;&gt; <span class="number">1</span>) | (ptr_sbus_rx_buffer[<span class="number">5</span>] &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x07ff</span>; </span><br><span class="line">    RC_Ctl.rc.s1 = (ptr_sbus_rx_buffer[<span class="number">5</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x0003</span>;</span><br><span class="line">    RC_Ctl.rc.s2 = (ptr_sbus_rx_buffer[<span class="number">5</span>] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0003</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¾ç…§<strong>é€šä¿¡åè®®</strong>åˆ©ç”¨<strong>ä½ç§»è¿ç®—</strong>å’Œ<strong>æˆ–ã€ä¸è¿ç®—</strong>ï¼Œå°†æ•°æ®ä»<strong>ptr_sbus_rx_buffer</strong>å‰¥ç¦»æå–è‡³<strong>RC_Ctl.rc.xx</strong>ä¸­ã€‚</p><ul><li>ä½ç§»æ“ä½œåï¼Œéœ€è¦æå–çš„æ•°æ®åœ¨<strong>å11ä½(æˆ–å2ä½)</strong>ï¼Œ<strong>0x07ff</strong>æ¢æˆäºŒè¿›åˆ¶å°±æ˜¯<strong>0000011111111111</strong>ï¼Œè¿‡æ»¤æ‰ä¸éœ€è¦çš„ä½æ•°ï¼›<strong>0x0003</strong>åŒç†</li><li><strong>ch0</strong>è·å–buffer[0]<strong>å…¨éƒ¨å…«ä½</strong>å’Œbuffer[1]<strong>ä½ä¸‰ä½</strong></li><li><strong>ch1</strong>è·å–buffer[1]<strong>é«˜äº”ä½</strong>å’Œbuffer[2]<strong>ä½å…­ä½</strong></li><li><strong>ch2</strong>è·å–buffer[2]<strong>é«˜ä¸¤ä½</strong>å’Œbuffer[3]<strong>å…¨éƒ¨å…«ä½</strong>å’Œbuffer[4]<strong>ä½ä¸€ä½</strong></li><li><strong>ch3</strong>è·å–buffer[4]<strong>é«˜ä¸ƒä½</strong>å’Œbuffer[5]<strong>ä½å››ä½</strong></li><li><strong>s1</strong>è·å–buffer[5]<strong>é«˜ä¸¤ä½</strong></li><li><strong>s2</strong>è·å–buffer[5]<strong>ç¬¬äº”ç¬¬å…­ä½</strong></li></ul><p>ä¸çŸ¥é“æ˜¯ä¸æ˜¯æåäº†ï¼Œæ ¹æ®åè®®æ¥çœ‹æ˜¯<strong>s1</strong>è·å–buffer[5]<strong>ç¬¬äº”ç¬¬å…­ä½</strong>ï¼Œ<strong>s2</strong>è·å–buffer[5]<strong>é«˜ä¸¤ä½</strong></p><h1 id="ä½è¿ç®—å®ç°å››åˆ™è¿ç®—"><a href="#ä½è¿ç®—å®ç°å››åˆ™è¿ç®—" class="headerlink" title="ä½è¿ç®—å®ç°å››åˆ™è¿ç®—"></a>ä½è¿ç®—å®ç°å››åˆ™è¿ç®—</h1><h2 id="åŠ æ³•"><a href="#åŠ æ³•" class="headerlink" title="åŠ æ³•"></a>åŠ æ³•</h2><h3 id="ç®—æ³•æ€è·¯"><a href="#ç®—æ³•æ€è·¯" class="headerlink" title="ç®—æ³•æ€è·¯"></a>ç®—æ³•æ€è·¯</h3><p>â€‹    åœ¨å¹³æ—¶æ‰‹ç®—çš„æ—¶å€™æˆ‘ä»¬ç»å¸¸ä¼š<strong>åˆ—ç«–å¼</strong>ï¼Œå…ˆä¸è€ƒè™‘è¿›ä½ï¼Œåªçœ‹<strong>å’Œ</strong>å’Œ<strong>ç›¸åŠ çš„ä¸¤ä¸ªæ•°</strong>åŒä½çš„æ•°ï¼ŒæŠŠè¿›ä½æ•°å†™å°ä¸€ç‚¹è®°åœ¨æ¨ªçº¿ä¸Šæ–¹ã€‚<strong>è®¡ç®—ä¸‹ä¸€ä½çš„æ—¶å€™å†åŠ ä¸Šä¸Šä¸€ä½çš„è¿›ä½ã€‚</strong></p><p>â€‹    æ‰€ä»¥åœ¨ç¨‹åºä¸­ä¹Ÿæ˜¯æ¨¡æ‹Ÿè¿™æ ·ä¸€ä¸ªæ€è·¯ï¼š</p><ul><li>å…ˆä¸çœ‹è¿›ä½ï¼Œå¾—åˆ°ä¸€ä¸ªå’Œï¼›è®°ä¸‹è¿›ä½</li><li>è¿›ä½åœ¨ä¸å’Œç›¸åŠ ï¼Œä¸çœ‹è¿›ä½å¾—åˆ°ä¸€ä¸ªæ–°çš„å’Œï¼›åŒæ—¶ä¹Ÿå¾—åˆ°æ–°çš„è¿›ä½</li><li>ä¸æ–­è¿­ä»£é€’æ¨ï¼Œç›´åˆ°ä¸å†äº§ç”Ÿæ–°çš„è¿›ä½</li></ul><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief åŠ æ³•å‡½æ•°</span></span><br><span class="line"><span class="comment"> * @param ini_x åŠ æ•°1</span></span><br><span class="line"><span class="comment"> * @param ini_y åŠ æ•°2</span></span><br><span class="line"><span class="comment"> * @return è¡¥ç å½¢å¼çš„ç»“æœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">u32 <span class="title">addition</span><span class="params">(u32 ini_x, u32 ini_y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//ä¸éœ€è¦è½¬æ¢ä¸ºè¡¥ç </span></span><br><span class="line">    u32 x = ini_x, y = ini_y;</span><br><span class="line">    <span class="comment">//å’Œï¼Œè¿›ä½</span></span><br><span class="line">    u32 ans,carry;</span><br><span class="line">    ans = x ^ y;</span><br><span class="line">    carry = (x &amp; y) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//ä¸æ–­è·å–è¿›ä½ä¸ä¸è€ƒè™‘è¿›ä½çš„å’Œï¼Œè¿­ä»£ç›¸åŠ ï¼Œç›´è‡³è¿›ä½ä¸º0</span></span><br><span class="line">    <span class="keyword">while</span>(carry != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        u32 i = ans, j = carry;</span><br><span class="line">        ans = i ^ j;</span><br><span class="line">        carry = (i &amp; j) &lt;&lt; <span class="number">1</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//DEBUGè°ƒè¯•</span></span><br><span class="line">    <span class="comment">//printf(&quot;DE<span class="doctag">BUG:</span> %d add %d = %d\r\n&quot;,ini_x,ini_y,ans);</span></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    å¯ä»¥å‘ç°ï¼Œ</p><ul><li>ä¸çœ‹è¿›ä½å¾—åˆ°çš„å’Œå…¶å®å°±æ˜¯<strong>ä¸¤æ•°å¼‚æˆ–</strong>ï¼Œå³<code>ans = x ^ y;</code>ï¼›</li><li>è¿›ä½å³<strong>ä¸¤æ•°ç›¸ä¸å†å·¦ç§»ä¸€ä½</strong>ï¼Œå³<code>carry = (x &amp; y) &lt;&lt; 1;</code></li></ul><h2 id="å‡æ³•"><a href="#å‡æ³•" class="headerlink" title="å‡æ³•"></a>å‡æ³•</h2><p>â€‹    <strong>a-b</strong> å³ <strong>a+(-b)</strong></p><h2 id="ä¹˜æ³•"><a href="#ä¹˜æ³•" class="headerlink" title="ä¹˜æ³•"></a>ä¹˜æ³•</h2><h3 id="ç®—æ³•æ€è·¯-1"><a href="#ç®—æ³•æ€è·¯-1" class="headerlink" title="ç®—æ³•æ€è·¯"></a>ç®—æ³•æ€è·¯</h3><p>â€‹    å¯ä»¥å°†è¢«ä¹˜æ•°ä¸æ–­åŠ <strong>ä¹˜æ•°æ¬¡æ•°</strong>çš„è‡ªå·±ã€‚ä½†æ˜¯è¿™æ ·æ•ˆç‡ä¸é«˜ã€‚åŒæ ·æ˜¯æ¨¡æ‹Ÿæ‰‹ç®—çš„æ€æƒ³ï¼Œä»<strong>ä¹˜æ•°çš„æœ€ä½ä½</strong>åˆ°<strong>æœ€é«˜ä½</strong>ï¼Œåœ¨<strong>ç¬¬iä½</strong>ï¼Œå³ç»™æœ€åä¹˜ç§¯è´¡çŒ®çš„å€¼ä¸º</p><p>==è¢«ä¹˜æ•° <em> ä¹˜æ•°[i] </em> (è¿›åˆ¶æ•°)^(i-1)^==</p><p>â€‹    åœ¨è¿™ä¸ªç®—æ³•ä¸‹ä¸å†èƒ½ç›´æ¥ç”¨è¡¥ç å‚ä¸è®¡ç®—ï¼Œæ‰€ä»¥è¦æ¢æˆåŸç å¹¶å»é™¤ç¬¦å·ä½ã€‚åœ¨å¼€å§‹çš„æ—¶å€™æ ¹æ®ä¸¤æ•°è®°ä¸‹ä¹˜ç§¯çš„æ­£è´Ÿå€¼ï¼Œè®¡ç®—å®Œæ¯•ä¹‹åå†èµ‹å›å»ã€‚</p><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief ä¹˜æ³•</span></span><br><span class="line"><span class="comment"> * @param ini_x </span></span><br><span class="line"><span class="comment"> * @param ini_y </span></span><br><span class="line"><span class="comment"> * @return u32 ç§¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">u32 <span class="title">multiplication</span><span class="params">(u32 ini_x, u32 ini_y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> negative_flag=<span class="number">0</span>;</span><br><span class="line">    u32 ans=<span class="number">0</span>, x=ini_x, y=ini_y;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ç§¯æ­£è´Ÿ</span></span><br><span class="line">    <span class="keyword">if</span>( ( (x&amp;<span class="number">0x80000000</span>) &amp;&amp; !(y&amp;<span class="number">0x80000000</span>) )||( !(x&amp;<span class="number">0x80000000</span>) &amp;&amp; (y&amp;<span class="number">0x80000000</span>) ) ) &#123;negative_flag=<span class="number">1</span>;&#125;</span><br><span class="line">    <span class="comment">//è¦è½¬æ¢ä¸ºåŸç å¹¶å»æ‰ç¬¦å·ä½</span></span><br><span class="line">    x = <span class="built_in">back_com</span>(x);</span><br><span class="line">    y = <span class="built_in">back_com</span>(y);</span><br><span class="line">    x &amp;= <span class="number">0x7fffffff</span>;</span><br><span class="line">    y &amp;= <span class="number">0x7fffffff</span>;</span><br><span class="line">    <span class="comment">//å€Ÿé‰´ç«–ä¹˜æ³•</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">31</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">0x01</span>) &#123;ans = <span class="built_in">addition</span>(ans,x);&#125;</span><br><span class="line">        y = y&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        x = x&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(y == <span class="number">0</span>) &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŠ ä¸Šæ­£è´Ÿå·</span></span><br><span class="line">    <span class="keyword">if</span> (negative_flag) </span><br><span class="line">    &#123;</span><br><span class="line">        ans |= <span class="number">0x80000000</span>;<span class="comment">//è¿™ä¸ªæ—¶å€™ä¾ç„¶æ˜¯åŸç ï¼Œæƒ³ç›´æ¥ç”¨%dï¼Œè¦è½¬æ¢ä¸ºè¡¥ç </span></span><br><span class="line">        ans = <span class="built_in">get_com</span>(ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//DEBUGè°ƒè¯•</span></span><br><span class="line">    <span class="comment">//printf(&quot;DE<span class="doctag">BUG:</span> %d multiply %d = %d\r\n&quot;,ini_x,ini_y,ans);</span></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™¤æ³•"><a href="#é™¤æ³•" class="headerlink" title="é™¤æ³•"></a>é™¤æ³•</h2><p>â€‹    å› ä¸ºé™¤æ³•æœ‰<strong>å•†</strong>å’Œ<strong>ä½™æ•°</strong>ï¼Œæ‰€ä»¥ç”¨äº†ä¸€ä¸ªç»“æ„ä½“æ–¹ä¾¿å­˜å‚¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief é™¤æ³•ç­”æ¡ˆç»“æ„ä½“</span></span><br><span class="line"><span class="comment"> * @param ans å•†</span></span><br><span class="line"><span class="comment"> * @param mod ä½™æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">__ans_division_t</span>&#123;</span><br><span class="line">    u32 ans;</span><br><span class="line">    u32 mod;</span><br><span class="line">&#125;<span class="type">ans_division_t</span>;</span><br></pre></td></tr></table></figure><h3 id="ç®—æ³•æ€è·¯-2"><a href="#ç®—æ³•æ€è·¯-2" class="headerlink" title="ç®—æ³•æ€è·¯"></a>ç®—æ³•æ€è·¯</h3><p>â€‹    ä¹Ÿæ˜¯æ¨¡æ‹Ÿæ‰‹ç®—æµç¨‹ï¼Œåœ¨ç†è§£äº†ä¹˜æ³•çš„å®ç°æ€è·¯åä¾¿å¾ˆå®¹æ˜“ç†è§£ã€‚</p><ul><li>å°†è¢«é™¤æ•°ä¸æ–­<strong>è¿›ä½</strong>ï¼Œå³ä¹˜ä¸Š<strong>è¿›åˆ¶æ•°</strong>ï¼Œç›´åˆ°æ°å¥½æ¯”è¢«é™¤æ•°å°ã€‚</li><li>ç”¨è¢«é™¤æ•°é™¤ä»¥<strong>è¿›ä½åçš„é™¤æ•°</strong>å¾—åˆ°<strong>å•†</strong>ï¼ˆä¸ºäº†åŒºåˆ«æœ€ç»ˆçš„å•†æŠŠå®ƒå«åš<em>å°å•†</em>å§ï¼‰ï¼ŒåŒæ—¶<strong>å•†</strong>åŠ ä¸Š==å°å•†*è¿›åˆ¶æ•°^(è¿›ä½æ¬¡æ•°)^==</li><li>è¢«é™¤æ•°ä¸æ–­<strong>é€€ä½</strong>ï¼ˆé™¤ä»¥è¿›åˆ¶æ•°ï¼‰ï¼ŒåŒæ—¶é‡å¤ä¸Šè¿°æ“ä½œï¼Œç›´åˆ°å›åˆ°æœ€åˆå¤§å°ï¼Œå³<strong>è¿›ä½æ•°ä¸º0</strong></li></ul><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief é™¤æ³•</span></span><br><span class="line"><span class="comment"> * @param ini_x è¢«é™¤æ•°</span></span><br><span class="line"><span class="comment"> * @param ini_y é™¤æ•°</span></span><br><span class="line"><span class="comment"> * @return ans_division_t* ç­”æ¡ˆæŒ‡é’ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">ans_division_t</span> *<span class="title">division</span><span class="params">(u32 ini_x, u32 ini_y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> negative_flag=<span class="number">0</span>;</span><br><span class="line">    u32 ans=<span class="number">0</span>, carry=<span class="number">0</span>, x=ini_x, y=ini_y;</span><br><span class="line">    <span class="type">ans_division_t</span> *ans_division;</span><br><span class="line">    ans_division = (<span class="type">ans_division_t</span>*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">ans_division_t</span>));</span><br><span class="line">    <span class="keyword">if</span>( ( (x&amp;<span class="number">0x80000000</span>) &amp;&amp; !(y&amp;<span class="number">0x80000000</span>) )||( !(x&amp;<span class="number">0x80000000</span>) &amp;&amp; (y&amp;<span class="number">0x80000000</span>) ) ) &#123;negative_flag=<span class="number">1</span>;&#125;</span><br><span class="line">    <span class="comment">//è¦è½¬æ¢ä¸ºåŸç å¹¶å»æ‰ç¬¦å·ä½</span></span><br><span class="line">    x = <span class="built_in">back_com</span>(x);</span><br><span class="line">    y = <span class="built_in">back_com</span>(y);</span><br><span class="line">    x &amp;= <span class="number">0x7fffffff</span>;</span><br><span class="line">    y &amp;= <span class="number">0x7fffffff</span>;</span><br><span class="line">    <span class="comment">//ä¾ç„¶æ˜¯æ¨¡æ‹Ÿæ‰‹é™¤æµç¨‹</span></span><br><span class="line">    <span class="comment">//é™¤æ•°ä¸æ–­è¿›ä½ç›´è‡³æ¯”è¢«é™¤æ•°å¤§</span></span><br><span class="line">    <span class="keyword">while</span>(y &lt; x) </span><br><span class="line">    &#123;</span><br><span class="line">        y = y&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        carry = <span class="built_in">addition</span>(carry,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¦‚æœèƒ½é™¤ï¼Œå•†å°±åŠ ä¸Š1&lt;&lt;carryï¼Œé™¤æ•°å†ä¸æ–­å³ç§»ç›´è‡³å›åˆ°æœ¬æ¥å¤§å°ã€‚</span></span><br><span class="line">    <span class="keyword">while</span>(carry)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;=y)</span><br><span class="line">        &#123;</span><br><span class="line">            ans = <span class="built_in">addition</span>(ans,<span class="number">1</span>&lt;&lt;carry);</span><br><span class="line">            x = <span class="built_in">addition</span>(x,-y);</span><br><span class="line">        &#125;</span><br><span class="line">        y = y&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        carry = <span class="built_in">addition</span>(carry,<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=y) </span><br><span class="line">    &#123;</span><br><span class="line">        ans = <span class="built_in">addition</span>(ans,<span class="number">1</span>);</span><br><span class="line">        x = <span class="built_in">addition</span>(x,-y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//èµ‹å€¼</span></span><br><span class="line">    ans_division-&gt;ans = ans;</span><br><span class="line">    ans_division-&gt;mod = x;</span><br><span class="line">    <span class="keyword">return</span> ans_division;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    å› ä¸ºè´Ÿæ•°çš„ä½™æ•°æ¯”è¾ƒå¥‡æ€ªï¼Œå¹³æ—¶ä¹Ÿä¸ç”¨ï¼Œè¿™é‡Œæ²¡æœ‰è€ƒè™‘åœ¨å†…ã€‚</p><h2 id="DEBUG"><a href="#DEBUG" class="headerlink" title="DEBUG"></a>DEBUG</h2><p>â€‹    vscode ç¨‹åºæ–‡ä»¶ä¸èƒ½ç”¨ä¸­æ–‡å‘½åã€‚</p><p>â€‹    åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ä½¿ç”¨è¡¥ç è®°å½•ã€‚å³ä¾¿æ˜¯<strong>usigned int</strong>ï¼Œå€˜è‹¥<strong>scanf -9</strong>ï¼Œå¯¹åº”äºŒè¿›åˆ¶ç¼–ç ä¹Ÿæ˜¯<strong>11111111111111111111111111110111</strong>ã€‚<strong>int</strong>å‹åŒæ ·å¦‚æ­¤ã€‚</p><p>â€‹    æ‰€ä»¥åœ¨è¿ç®—çš„æ—¶å€™ä¸éœ€è¦äººä¸ºçš„å»è½¬æ¢ä¸ºè¡¥ç äº†ï¼Œåœ¨è¿™æ–¹é¢è€½è¯¯äº†ä¸å°‘æ—¶é—´ã€‚</p><p>â€‹    è€Œå¯¹äºåŒæ ·çš„ä¸€ä¸²äºŒè¿›åˆ¶ç¼–ç ï¼Œ<strong>printf(â€œ%dâ€)</strong>å’Œ<strong>printf(â€œ%uâ€)</strong>è¾“å‡ºç»“æœæ˜¯ä¸ä¸€æ ·çš„ï¼š%dä¼šè‡ªåŠ¨è½¬æ¢è¾“å‡ºåŸç å¯¹åº”çš„æœ‰ç¬¦å·æ•°ï¼›é‚£%uåˆ™æ˜¯ä¼šå°†è¿™ä¸ªè¡¥ç å½“ä½œåŸç ç›´æ¥æ¢ç®—æˆåè¿›åˆ¶è¾“å‡ºã€‚</p><p><img src="https://s2.loli.net/2022/10/29/PICY3lTj1Q4OKGS.png" alt="å­˜å‚¨å½¢å¼Â·1.png"></p><p><img src="https://s2.loli.net/2022/10/29/2SIuUTAJV9tDnqR.png" alt="å­˜å‚¨å½¢å¼2.png"></p><p>â€‹    å…¶ä½™çš„å°±æ˜¯ä¸€äº›é€»è¾‘æ¼æ´äº†ï¼Œä¸å¾—ä¸è¯´VScodeå†™ä»£ç è¿˜æ˜¯æ¯”Keilèˆ’æœğŸ˜</p><h1 id="æœ‰å…³ä½è¿ç®—çš„ä¸€äº›æœ‰æ„æ€çš„é¢˜ç›®"><a href="#æœ‰å…³ä½è¿ç®—çš„ä¸€äº›æœ‰æ„æ€çš„é¢˜ç›®" class="headerlink" title="æœ‰å…³ä½è¿ç®—çš„ä¸€äº›æœ‰æ„æ€çš„é¢˜ç›®"></a>æœ‰å…³ä½è¿ç®—çš„ä¸€äº›æœ‰æ„æ€çš„é¢˜ç›®</h1><h2 id="åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"><a href="#åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—" class="headerlink" title="åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"></a>åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</h2><blockquote><p>ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚</p><p>è¯´æ˜ï¼šä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—</p><p>ç¤ºä¾‹ 1:</p><blockquote><p>è¾“å…¥: [2,2,1]<br>è¾“å‡º: 1</p></blockquote><p>ç¤ºä¾‹ 2:</p><blockquote><p>è¾“å…¥: [4,1,2,1,2]<br>è¾“å‡º: 4</p></blockquote></blockquote><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>éœ€è¦ç”¨åˆ°å¼‚æˆ–è¿ç®—çš„æ€§è´¨ï¼š</p><p>a \^ a = 0<br>a \^ 0 = a<br>a \^ b \^ a = b \^ (a \^ a) = bï¼ˆäº¤æ¢å¾‹å’Œç»“åˆå¾‹ï¼‰<br>æ‰€ä»¥åªè¦å…¨éƒ¨å¼‚æˆ–æœ€åç»“æœå°±æ˜¯ç­”æ¡ˆ</p><h3 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">singleNumber</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="type">int</span> &amp; num: nums)</span><br><span class="line">        ans ^= num;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¯”ç‰¹ä½è®¡æ•°"><a href="#æ¯”ç‰¹ä½è®¡æ•°" class="headerlink" title="æ¯”ç‰¹ä½è®¡æ•°"></a>æ¯”ç‰¹ä½è®¡æ•°</h2><blockquote><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° nï¼Œæ±‚ä» 0 åˆ° n çš„æ‰€æœ‰æ•°å­—çš„äºŒè¿›åˆ¶è¡¨è¾¾ä¸­ï¼Œåˆ†åˆ«æœ‰å¤šå°‘ä¸ª 1ã€‚</p></blockquote><h3 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æœ¬é¢˜å¯ä»¥åˆ©ç”¨åŠ¨æ€è§„åˆ’å’Œä½è¿ç®—è¿›è¡Œå¿«é€Ÿçš„æ±‚è§£ã€‚å®šä¹‰ä¸€ä¸ªæ•°ç»„ dpï¼Œå…¶ä¸­ dp [i] è¡¨ç¤ºæ•°å­— i çš„äºŒè¿›åˆ¶å«æœ‰ 1 çš„ä¸ªæ•°ã€‚å¯¹äºç¬¬ i ä¸ªæ•°å­—ï¼Œå¦‚æœå®ƒäºŒè¿›åˆ¶çš„æœ€åä¸€ä½ä¸º 1ï¼Œé‚£ä¹ˆå®ƒå«æœ‰ 1 çš„ä¸ªæ•° åˆ™ä¸º dp [i-1] + 1ï¼›å¦‚æœå®ƒäºŒè¿›åˆ¶çš„æœ€åä¸€ä½ä¸º 0ï¼Œé‚£ä¹ˆå®ƒå«æœ‰ 1 çš„ä¸ªæ•°å’Œå…¶ç®—æœ¯å³ç§»ç»“æœç›¸åŒï¼Œå³ dp [i&gt;&gt;1]ã€‚</p><h3 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">countBits</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(num+<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= num; ++i)</span><br><span class="line">        dp[i] = i &amp; <span class="number">1</span>? dp[i<span class="number">-1</span>] + <span class="number">1</span>: dp[i&gt;&gt;<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// ç­‰ä»·äºdp[i] = dp[i&amp;(i-1)] + 1;</span></span><br><span class="line">    <span class="keyword">return</span> dp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> ä½è¿ç®— </tag>
            
            <tag> leecode </tag>
            
            <tag> å››åˆ™è¿ç®— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32ä»¿çœŸå™¨ç¨‹åºçƒ§å½•</title>
      <link href="/2022/10/22/STM32%E4%BB%BF%E7%9C%9F%E5%99%A8%E7%A8%8B%E5%BA%8F%E7%83%A7%E5%BD%95/"/>
      <url>/2022/10/22/STM32%E4%BB%BF%E7%9C%9F%E5%99%A8%E7%A8%8B%E5%BA%8F%E7%83%A7%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>â€‹    è¿™å‡ å¤©æ¯é¥¬äº†ä¸€ä¸‹çƒ§å½•ç¨‹åºçš„æ–¹æ³•ã€‚ä¸»è¦è¿˜æ˜¯<strong>SWD</strong>çƒ§å½•ï¼Œåç»­åº”è¯¥ä¼šå°è¯•å…¶ä»–æ–¹æ³•ã€‚æˆ‘æœ€å¼€å§‹çš„æ—¶å€™å°±ä¸å¤ªä¼šå¼„ï¼Œå³ä¾¿æ‰‹è¾¹æœ‰ä¸ªä»¿çœŸå™¨ä¹Ÿæ²¡æœ‰å»ç”¨ï¼ˆåæ¥å°±ä¸¢äº†ğŸ˜‚ï¼‰ï¼Œä¸€ç›´ç”¨çš„æ˜¯<strong>ISP</strong>ä¸‹è½½ï¼Œä¸ä»…æ•ˆç‡ä½ï¼Œè¿˜ä¸èƒ½åœ¨çº¿è°ƒè¯•ã€‚æ‰€ä»¥å°±æ•´ç†äº†ä¸€ä¸‹çƒ§å½•æ–¹æ³•ã€‚</p><span id="more"></span><h1 id="STM32ä»¿çœŸå™¨ç¨‹åºçƒ§å½•"><a href="#STM32ä»¿çœŸå™¨ç¨‹åºçƒ§å½•" class="headerlink" title="STM32ä»¿çœŸå™¨ç¨‹åºçƒ§å½•"></a>STM32ä»¿çœŸå™¨ç¨‹åºçƒ§å½•</h1><h3 id="SWDçƒ§å½•"><a href="#SWDçƒ§å½•" class="headerlink" title="SWDçƒ§å½•"></a>SWDçƒ§å½•</h3><p>SWDçƒ§å½•æ˜¯ä¸€ç§ä¸²è¡Œè°ƒè¯•æ¥å£ï¼Œå‡ºå»ä¾›ç”µä¸å…±åœ°åªéœ€è¦ä¸¤æ ¹çº¿å³å¯çƒ§å½•è°ƒè¯•</p><ul><li><strong>SWDIOï¼š</strong> ä¸²è¡Œæ•°æ®çº¿ï¼Œç”¨äºæ•°æ®çš„è¯»å‡ºå’Œå†™å…¥;</li><li><strong>SWDCLKï¼š</strong> ä¸²è¡Œæ—¶é’Ÿçº¿ï¼Œæä¾›æ‰€éœ€è¦çš„æ—¶é’Ÿä¿¡å·;</li></ul><p>ä¸‹é¢æ˜¯å®˜æ–¹æ‰‹å†Œé‡Œçƒ§å½•æ¥å£çš„å¼•è„šåˆ°GPIOå£çš„æ˜ å°„å…³ç³»</p><p><img src="https://s2.loli.net/2022/10/22/yxIoZNYtkJiqcvs.png" alt="æ˜ å°„å…³ç³».png"></p><p>è¿™ä¸ªæ˜¯æ ‡å‡†çš„æ¥å£æ’åˆ—ï¼Œè¦æ³¨æ„çš„æ˜¯æŒ‰ç…§æ’åº§è¾¹ä¸Šçš„<strong>ç¼ºå£å‘å·¦</strong>çš„æ–¹å‘æ¥æŸ¥çœ‹ã€‚</p><p><img src="https://s2.loli.net/2022/10/22/NxQRpn7YiqlcZ9j.png" alt="swd_jtagæ’åº§.png"></p><p>ä¸€èˆ¬æƒ…å†µä¸‹å¤§å¤šæ•°å•ç‰‡æœºçš„ JTAG æ¥å£å’Œ SWDIO æ¥å£æ˜¯å¤ç”¨çš„ï¼Œä¸‹é¢å°±æ˜¯MINIæ¿çš„åŸç†å›¾</p><p><img src="https://s2.loli.net/2022/10/22/hPSMBDUczKI6gOZ.png" alt="MINIswdæ’åº§.png"></p><h4 id="J-link"><a href="#J-link" class="headerlink" title="J-link"></a>J-link</h4><p>è¿™ä¸ªæ˜¯æ¯”è¾ƒå¸¸è§ä¹Ÿæ¯”è¾ƒä¾¿å®œçš„ä¸€æ¬¾J-linkï¼Œåªæœ‰<strong>3.3vVCCã€SWDIOã€SWCLKã€GND</strong>å››æ ¹çº¿ï¼Œæ¥çº¿æ–¹å¼ä¹Ÿååˆ†çš„ç®€å• ã€‚</p><p><img src="https://s2.loli.net/2022/10/22/jM2wkymvznOZtS9.jpg" alt="å»‰ä»·j-link.jpg" style="zoom:50%;" /></p><p>åƒ<strong>STM32C8T6ã€openCRP</strong>ç­‰ç­‰å·²ç»ç»™å‡ºè¿™å››ä¸ªæ¥å£çš„æ¿å­ç›´æ¥æ¥ä¸Šå°±å¥½äº†</p><p><img src="https://s2.loli.net/2022/10/22/RGTbYQp9D8sUexm.jpg" alt="swdæ¥å£.jpg"></p><p>å¦‚æœæ˜¯20è„šæ ‡å‡†æ¥å£çš„è¯å¯¹ç…§ä¸Šé¢çš„å›¾ç‰‡æ‰¾åˆ°å¯¹åº”çš„å¼•è„šç›´æ¥æ¥ä¸Šå³å¯ã€‚</p><p><img src="https://s2.loli.net/2022/10/22/EMTGCtwVFrAia9I.jpg" alt="å»‰ä»·j-linkæ¥çº¿.jpg"></p><p>â€‹    å¦‚æœå®åœ¨æ‰¾ä¸åˆ°æ¥å£å‘¢ï¼Œç›´æ¥æŠŠ<strong>SWDIOã€SWCLK</strong>æ¥åœ¨<strong>PA13ã€PA14</strong>ï¼Œå†ä¾›ç”µå…±åœ°ä¹Ÿæ˜¯ä¸€æ ·å¯ä»¥æ­£å¸¸çƒ§å½•çš„ã€‚    </p><p>â€‹    ç»è¿‡æµ‹è¯•å‘¢ï¼Œå¯ä»¥æ­£å¸¸çƒ§å½•ï¼Œä½†æ˜¯ä¼š<strong>ä¾›ç”µä¸è¶³</strong>ã€‚å…¶ä¸­<strong>C8T6å’ŒopenCRP</strong>çš„<strong>5V</strong>å¼•è„šç”µå‹ä¸å¤Ÿï¼Œä¸è¿‡ç¨‹åºå€’æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œï¼›è€Œ<strong>MINI</strong>åˆ™æ˜¯ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œã€‚è¿™ä¸ªå…·ä½“æƒ…å†µè¿˜ä¸å„ä¸ªæ¿å­çš„PCBè®¾è®¡æœ‰å…³ã€‚ä¸€èˆ¬ä¿é™©èµ·è§çš„è¯ï¼Œéœ€è¦<strong>é¢å¤–ä¾›ç”µ</strong>ã€‚</p><h4 id="ST-link"><a href="#ST-link" class="headerlink" title="ST-link"></a>ST-link</h4><p>è¿™ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ä¸€æ¬¾ST-link</p><p><img src="https://s2.loli.net/2022/10/22/wQTMaopVhKlZq7g.jpg" alt="ST-link.jpg"></p><p>â€‹    å¦‚æœèƒ½ç›´æ¥ç”¨20è„šçš„æ¥å£å°±å¾ˆæ–¹ä¾¿ã€‚ä¸è¡Œçš„è¯ä¹Ÿå¯ä»¥ç›´æ¥å¯¹ç…§å‰é¢çš„å›¾ç‰‡æŠŠ<strong>SWD</strong>å¯¹åº”çš„å››æ ¹çº¿æ¥å‡ºæ¥ã€‚</p><p>â€‹    å’Œæ¿å­çš„æ¥çº¿æ–¹æ³•ä¸ä¹‹å‰éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h4 id="è½¯ä»¶é…ç½®"><a href="#è½¯ä»¶é…ç½®" class="headerlink" title="è½¯ä»¶é…ç½®"></a>è½¯ä»¶é…ç½®</h4><p>è¿™é‡Œç”¨çš„æ˜¯<strong>MDK5</strong>æˆ–è€…å«<strong>Keil</strong></p><ol><li>é¦–å…ˆæ˜¯ç‚¹å¼€<strong>é­”æœ¯æ£’</strong>ï¼Œé€‰æ‹©å¯¹åº”çš„è°ƒè¯•å™¨<img src="https://s2.loli.net/2022/10/22/9botRpUDXFnAEqs.png" alt="config.png"></li><li>ç„¶åè¿›å…¥<strong>settings</strong>é€‰æ‹©çƒ§å½•æ–¹å¼å’Œçƒ§å½•é€Ÿåº¦<img src="https://s2.loli.net/2022/10/22/mxFHa8b52YNCoiJ.jpg" alt="config2.jpg"></li><li>ç„¶åå¯ä»¥æ£€æŸ¥ä¸€ä¸‹çƒ§å½•ç®—æ³•å’Œè‡ªå·±çš„èŠ¯ç‰‡å‹å·æ˜¯ä¸æ˜¯å¯¹åº”çš„ã€‚<img src="https://s2.loli.net/2022/10/22/1xEaqv8ANcwoJsX.jpg" alt="config3.jpg"></li><li>æœ€åç‚¹å‡»<strong>load</strong>æŒ‰é’®å°±å¯ä»¥çƒ§å½•äº†ã€‚</li></ol><h3 id="ISPçƒ§å½•"><a href="#ISPçƒ§å½•" class="headerlink" title="ISPçƒ§å½•"></a>ISPçƒ§å½•</h3>]]></content>
      
      
      
        <tags>
            
            <tag> STM32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROSä¸²å£é€šè®¯</title>
      <link href="/2022/08/29/ROS-USART-STM32/"/>
      <url>/2022/08/29/ROS-USART-STM32/</url>
      
        <content type="html"><![CDATA[<p>â€‹    ç®€å•è®°å½•äº†å°è¯•ä½¿ç”¨ROSä¸STM32é€šè®¯çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬è¸©çš„ä¸€ç‚¹å‘ï¼Œå…¶ä¸­ä¸€äº›ä½çº§é—®é¢˜å®åœ¨æ˜¯æœ‰ç‚¹è®©äººå“­ç¬‘ä¸å¾—ğŸ˜‚</p><span id="more"></span><h1 id="ROSä¸²å£é€šè®¯"><a href="#ROSä¸²å£é€šè®¯" class="headerlink" title="ROSä¸²å£é€šè®¯"></a>ROSä¸²å£é€šè®¯</h1><h2 id="ROSä¸²å£é€šè®¯é…ç½®"><a href="#ROSä¸²å£é€šè®¯é…ç½®" class="headerlink" title="ROSä¸²å£é€šè®¯é…ç½®"></a>ROSä¸²å£é€šè®¯é…ç½®</h2><h3 id="Ubuntu20-04æ‰‹åŠ¨è·å–SerialåŒ…"><a href="#Ubuntu20-04æ‰‹åŠ¨è·å–SerialåŒ…" class="headerlink" title="Ubuntu20.04æ‰‹åŠ¨è·å–SerialåŒ…"></a>Ubuntu20.04æ‰‹åŠ¨è·å–SerialåŒ…</h3><h3 id="linux-ros-ä¸²å£æƒé™è·å–"><a href="#linux-ros-ä¸²å£æƒé™è·å–" class="headerlink" title="linux/ros ä¸²å£æƒé™è·å–"></a>linux/ros ä¸²å£æƒé™è·å–</h3><p>è½¬è½½è‡ª<a href="https://blog.csdn.net/qq_16775293/article/details/82822851?utm_medium=distribute.wap_relevant.none-task-blog-2~default~baidujs_title~default-0-82822851-blog-55259778.wap_relevant_multi_platform_whitelistv1&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=1">(9æ¡æ¶ˆæ¯) Linux/ROSâ€”â€”è·å–ä¸²å£æƒé™_ä¸æ‡‚éŸ³ä¹çš„æ¬£èµè€…çš„åšå®¢-CSDNåšå®¢</a></p><p>æˆ‘è¿™é‡Œçš„ä¸²å£å·æ˜¯<strong>/dev/ttyTHS1</strong>ï¼Œéœ€è¦é€‚å½“å˜åŠ¨</p><h4 id="æ°¸ä¹…è§£å†³ä¸²å£æƒé™é—®é¢˜"><a href="#æ°¸ä¹…è§£å†³ä¸²å£æƒé™é—®é¢˜" class="headerlink" title="æ°¸ä¹…è§£å†³ä¸²å£æƒé™é—®é¢˜"></a>æ°¸ä¹…è§£å†³ä¸²å£æƒé™é—®é¢˜</h4><p>ï¼ˆæˆ‘è¯•äº†ä¸€ä¸‹ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼‰</p><p>åˆ›å»ºttyUSBæƒé™è§„åˆ™æ–‡ä»¶etc/udev/rules.d/70-ttyUSB.rules</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim -p /etc/udev/rules.d/70-ttyUSB.rules</span><br></pre></td></tr></table></figure><p>åœ¨<strong>70-ttyUSB.rules</strong>æ–‡ä»¶ä¸­å†™å…¥ä¸‹åˆ—ä»£ç </p><p>KERNEL==â€ttyUSB*â€, OWNER=â€rootâ€, GROUP=â€rootâ€, MODE=â€0666â€<br>ä¿å­˜å³å¯,é‡å¯æˆ–æ³¨é”€ç”¨æˆ·åœ¨ç™»å½•åç”Ÿæ•ˆ</p><h4 id="ä¸´æ—¶è·å–ä¸²å£æƒé™"><a href="#ä¸´æ—¶è·å–ä¸²å£æƒé™" class="headerlink" title="ä¸´æ—¶è·å–ä¸²å£æƒé™"></a>ä¸´æ—¶è·å–ä¸²å£æƒé™</h4><p>å…ˆæŸ¥çœ‹æ’å…¥ç”µè„‘çš„<strong>ä¸²å£å·</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /dev/ | grep ttyUSB</span><br></pre></td></tr></table></figure><p>çŸ¥é“ä¸²å£å·ä¹‹åå¯¹æŒ‡å®šä¸²å£èµ‹äºˆæƒé™,ä»¥<strong>ttyUSB0</strong>ä¸ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+rw /dev/ttyUSB0</span><br></pre></td></tr></table></figure><p>ä¸ç”¨é‡å¯å³å¯ç”Ÿæ•ˆ</p><h3 id="ä»£ç ç¼–å†™é—®é¢˜"><a href="#ä»£ç ç¼–å†™é—®é¢˜" class="headerlink" title="ä»£ç ç¼–å†™é—®é¢˜"></a>ä»£ç ç¼–å†™é—®é¢˜</h3><h2 id="Jetson-nanoä¸STM32é€šè®¯"><a href="#Jetson-nanoä¸STM32é€šè®¯" class="headerlink" title="Jetson nanoä¸STM32é€šè®¯"></a>Jetson nanoä¸STM32é€šè®¯</h2><h3 id="jetson-nanoä¸²å£"><a href="#jetson-nanoä¸²å£" class="headerlink" title="jetson nanoä¸²å£"></a>jetson nanoä¸²å£</h3><p>å¼•è„šå›¾ï¼Œç›´æ¥è¿å³å¯ã€‚</p><p><img src="https://s2.loli.net/2022/10/22/x8melhw2bcjAgqV.jpg" alt="nano_usart.jpg"></p><h3 id="ROSä¸32ä¸²å£é€šè®¯ï¼ˆROSç«¯ï¼‰åªèƒ½æ¥æ”¶ä¸èƒ½å‘é€"><a href="#ROSä¸32ä¸²å£é€šè®¯ï¼ˆROSç«¯ï¼‰åªèƒ½æ¥æ”¶ä¸èƒ½å‘é€" class="headerlink" title="ROSä¸32ä¸²å£é€šè®¯ï¼ˆROSç«¯ï¼‰åªèƒ½æ¥æ”¶ä¸èƒ½å‘é€"></a>ROSä¸32ä¸²å£é€šè®¯ï¼ˆROSç«¯ï¼‰åªèƒ½æ¥æ”¶ä¸èƒ½å‘é€</h3><p>â€‹    è¢«è¿™ä¸ªé—®é¢˜å¡äº†å¾ˆä¹…ã€‚æ ¹æ®æƒ…å†µæè¿°ï¼Œæ—¢ç„¶éƒ½èƒ½æ­£å¸¸æ¥æ”¶äº†ä¸ºä»€ä¹ˆå‘é€ä¼šå¤±è´¥å‘¢ï¼Ÿ</p><h4 id="ROSç«¯"><a href="#ROSç«¯" class="headerlink" title="ROSç«¯"></a>ROSç«¯</h4><p>â€‹    åœ¨ROSç«¯ä¸²å£è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²æ‰€ç”¨åˆ°çš„å‡½æ•°æ˜¯<strong>ser.writeï¼ˆstring valueï¼‰</strong>ï¼Œåœ¨å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°é‡Œé¢åŒæ—¶è°ƒç”¨ã€‚é¦–å…ˆå°±æ˜¯æ£€æŸ¥å®šæ—¶å™¨å›è°ƒå‡½æ•°æ˜¯å¦è¢«æˆåŠŸè°ƒç”¨ï¼Œè¯»å–æ•°æ®å’Œå‘é€æ•°æ®éƒ½æ˜¯åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°é‡Œè°ƒç”¨çš„ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šæ˜¯æ²¡é—®é¢˜çš„ï¼Œ<strong>ROS_INFO</strong>ä¸€ä¸‹ç¡®å®æ²¡é—®é¢˜ã€‚åŒç†<strong>SendMsgs( )</strong>ä¸€æ ·æˆåŠŸè°ƒç”¨äº†ã€‚é‚£è‡³å°‘èƒ½è‚¯å®šï¼Œ<strong>write( )</strong>å‡½æ•°è‚¯å®šè¢«è°ƒç”¨äº†å‘€ã€‚</p><p>â€‹    ä¸­é—´è¿˜å‡ºäº†ä¸€ç‚¹å²”å­ï¼Œå°±æ˜¯ä»£ç ä¸­ä¸å°å¿ƒæ‰“ä¸Šäº†ä¸€ç‚¹ä¹±ç ï¼Œç»“æœç¼–è¯‘å‡ºé—®é¢˜ã€‚ä½†æ˜¯ç¼–è¯‘æ—¥å¿—ä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼Œæˆ‘è™½ç„¶çœ‹ç€å’ŒåŸæ¥çš„ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ²¡æœ‰å¤ªåœ¨æ„ã€‚ä½†æ˜¯è¿™å°±å¯¼è‡´äº†ä¹‹å‰æ”¹å®Œä»£ç åå¥½å‡ æ¬¡ç¼–è¯‘éƒ½æ˜¯ä¸é€šè¿‡çš„ï¼Œä¸€ç›´è¿è¡Œçš„ä¹Ÿæ˜¯é‚£ä¸ªæœ‰é—®é¢˜çš„èŠ‚ç‚¹ä»£ç ã€‚æ‰€ä»¥å¦‚æœç¼–è¯‘æ—¥å¿—åŒå¹³æ—¶æ¯”è¾ƒä¸ºåå¸¸ï¼Œè¦å½“å¿ƒä¸€ä¸‹ã€‚</p><p>â€‹    æ¥ä¸‹æ¥å°†<strong>nano</strong>çš„<strong>TXï¼ŒRX</strong>çŸ­æ¥ï¼Œåˆ¤æ–­åˆ°åº•æ˜¯ä¸æ˜¯nanoç«¯çš„é—®é¢˜ã€‚å‘ç°ç¡®å®èƒ½è‡ªå·±æ¥æ”¶åˆ°è‡ªå·±çš„æ¶ˆæ¯ï¼Œé‚£å°±æ²¡é—®é¢˜äº†</p><p>â€‹    nanoç«¯æ²¡é—®é¢˜äº†ï¼Œä¼°è®¡å°±æ˜¯32ç«¯çš„é—®é¢˜äº†ã€‚rosåªèƒ½æ¥å—ä¸èƒ½å‘é€ï¼Œæ˜¯ä¸æ˜¯<strong>rx</strong>æ¥å¯¹äº†ä½†<strong>tx</strong>æ¥é”™äº†å‘¢ï¼Ÿ</p><blockquote><p>nano 8ï¼šTXâ€”â€”RXï¼šstm32 PA10</p><p>nano 10: RXâ€”â€”TXï¼šstm32 PA9</p></blockquote><p>å†æ£€éªŒä¸€éç€å®æ— è¯¯ã€‚</p><h4 id="32ç«¯"><a href="#32ç«¯" class="headerlink" title="32ç«¯"></a>32ç«¯</h4><p>â€‹    32ç«¯æ²¡æœ‰å†é…ç½®ä¸€ä¸ªä¸²å£ï¼Œä½¿ç”¨<strong>oledå±</strong>DEBUGï¼Œnanoç«¯ä½¿ç”¨cutecomé€šè®¯æ­£å¸¸ï¼Œ32èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ¢æˆroså‘æ¶ˆæ¯å32å´æ˜¯ä¸€ç‚¹ååº”éƒ½æ²¡æœ‰ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±æƒ³åˆ°çœ‹çœ‹<strong>ä¸²å£ä¸­æ–­å‡½æ•°</strong>åˆ°åº•æœ‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œ32åˆ°åº•æœ‰æ²¡æœ‰æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚æˆ‘åœ¨è¯¥å‡½æ•°é‡Œé¢åŠ äº†äº›è¯­å¥ï¼šå¦‚æœä¸²å£ä¸­æ–­å‡½æ•°è¢«è°ƒç”¨çš„è¯oledå°±ä¼šæ˜¾ç¤ºã€‚</p><p>â€‹    é‚£ç»“æœæ˜¯æ²¡æœ‰ååº”ã€‚</p><p>â€‹    å®é™…ä¸Šæ§åˆ¶oledæ˜¾ç¤ºçš„æ—¶å€™è¾“å®Œå†…å®¹ï¼Œè¦åŠ ä¸ª<strong>refresh</strong>ã€‚åŒæ—¶<strong>while( )</strong>é‡Œåœ¨ä¸æ–­<strong>Set_Z( )</strong>,é‡Œé¢ä¹Ÿä¼šä¸æ–­æ›´æ–°å†…å®¹ç„¶årefreshï¼Œæ‰€ä»¥å…¶å®ä¸²å£ä¸­æ–­æ˜¯è¢«è°ƒç”¨äº†çš„ï¼Œä½†åœ¨è¿™æ ·çš„æƒ…å†µä¸‹çœ‹ä¸åˆ°ååº”ã€‚æœ€åæ˜¯ä½¿ç”¨keilçš„<strong>åœ¨çº¿è°ƒè¯•åŠŸèƒ½</strong>è®¾ç½®<strong>æ–­ç‚¹</strong>å‘ç°çš„ï¼Œå…¶å®è°ƒç”¨äº†ã€‚è¿™ä¸ªæ—¶å€™å†çœ‹ä¸€ä¸‹å‡½æ•°å…³äºæ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„è¿‡æ»¤ï¼Œå…¶å®æ­£ç‚¹åŸå­ä¹Ÿè¯´è¿‡â€”â€”<strong>å‘é€æ–°è¡Œ</strong>ã€‚cutecomä¼šï¼Œä½†rosä¸ä¼šã€‚æœ€ç»ˆåœ¨è¦å‘é€çš„å­—ç¬¦ä¸²åé¢åŠ ä¸Š<strong>\r\n</strong>ï¼ŒDEBUGç»“æŸã€‚</p><h4 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h4><ul><li>å‡½æ•°è°ƒç”¨å› oledé”™è¯¯ä½¿ç”¨æ£€æŸ¥å¤±è´¥ã€‚</li><li>ä¸ä¼šä½¿ç”¨Jlinkåœ¨çº¿è°ƒè¯•</li><li>å¿½è§†äº†roså’Œcutecomç»†èŠ‚ä¸Šçš„è¾“å‡ºå·®å¼‚ã€‚</li></ul><p>å¦‚æœè¿™ä¸‰ç‚¹æœ‰ä¸€ç‚¹ä¸å‡ºé—®é¢˜çš„è¯ï¼Œæˆ–è®¸éƒ½èƒ½å¤Ÿæ—©äº›æ‰¾åˆ°ï¼Œé”™è¯¯ã€‚åœ¨æ­¤éå¸¸æ„Ÿè°¢å¸ˆå…„çš„æŒ‡ç‚¹ï¼</p><h2 id="LattePandaä¸å…¶Arduinoé€šè®¯"><a href="#LattePandaä¸å…¶Arduinoé€šè®¯" class="headerlink" title="LattePandaä¸å…¶Arduinoé€šè®¯"></a>LattePandaä¸å…¶Arduinoé€šè®¯</h2><p>æœ¬æ¥æ‰“ç®—ä½¿ç”¨stm32è¿›è¡Œä¸‹æ¸¸è®¾å¤‡çš„æ§åˆ¶ï¼Œä½†æ˜¯å‘ç°LattePandaé›†æˆäº†ä¸€å—<strong>arduino</strong>ï¼Œä¸å¥½å¥½åˆ©ç”¨ä¸€ä¸‹å®åœ¨æ˜¯å¤ªå¯æƒœäº†ã€‚</p><h3 id="Arduino-IDEå®‰è£…"><a href="#Arduino-IDEå®‰è£…" class="headerlink" title="Arduino IDEå®‰è£…"></a>Arduino IDEå®‰è£…</h3><p>â€‹    åœ¨å®˜ç½‘<a href="https://www.arduino.cc/en/software">Software | Arduino</a>ä¸‹è½½Linuxç‰ˆæœ¬çš„å®‰è£…åŒ…ã€‚å¯æ˜¯ä¸‹è½½<strong>2.0.0</strong>ç‰ˆæœ¬çš„ä¼šæ˜¾ç¤º<em>æ²¡æœ‰å¯æ‰§è¡Œçš„è½¯ä»¶</em>ï¼Œæ‰€ä»¥æœ€åé€‰æ‹©äº†<strong>1.8.19</strong>ã€‚lattepandaå¯¹åº”çš„ç‰ˆæœ¬æ˜¯<strong>linux 64 bits</strong></p><p>åœ¨å®‰è£…ç›®å½•å¾—åˆ°äº†<strong>.tar.xz</strong>æ–‡ä»¶ï¼Œè¿è¡Œè§£å‹å‘½ä»¤</p><p><code>tar -xvf arduino-1.8.19-linux64.tar.xz</code></p><p>è¿›å…¥è§£å‹å¾—åˆ°çš„å®‰è£…ç›®å½•ï¼Œè¿è¡Œå®‰è£…è„šæœ¬ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd arduino-1.8.19/</span><br><span class="line">sudo ./install.sh</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿”å› <em>done!</em> åå®‰è£…æˆåŠŸ</p><h3 id="è¿æ¥é…ç½®"><a href="#è¿æ¥é…ç½®" class="headerlink" title="è¿æ¥é…ç½®"></a>è¿æ¥é…ç½®</h3><p>â€‹    å¹³æ—¶ç”¨ç”µè„‘ç»™arduinoçƒ§å½•ç¨‹åºéœ€è¦ç”¨ä¸€æ ¹æ•°æ®çº¿å°†äºŒè€…è¿æ¥èµ·æ¥ã€‚é‚£åœ¨lattepandaä¸Šå°±ç›¸å½“äºæŠŠè¿™ä¸ªæ•°æ®çº¿åœ¨æ¿å­ä¸Šç”»å¥½äº†ï¼Œå†æŠŠç”µè„‘å’Œarduinoç²˜ä¸€å—å„¿</p><p>â€‹    è¿™ä¸ªæ•°æ®çº¿å¯¹åº”çš„ä¸²å£å·æ˜¯<strong>/dev/ttyACM0</strong>ï¼›</p><p>â€‹    å¯¹åº”çš„èŠ¯ç‰‡å‹å·æ˜¯<strong>ATmega32u4</strong>ï¼Œè¿™åœ¨IDEé‡Œé¢æ‰¾ä¸åˆ°ï¼Œå®é™…ä¸Šä¹Ÿå«<strong>Arduino Leonardo</strong></p><p>â€‹    ä¹‹åå°±å¯ä»¥çƒ§ç¨‹åºå’Œé€šè®¯äº†ã€‚</p><h3 id="ç§»æ¤ROSåŒ…æ—¶é‡åˆ°çš„ä¸€ç‚¹å°é—®é¢˜"><a href="#ç§»æ¤ROSåŒ…æ—¶é‡åˆ°çš„ä¸€ç‚¹å°é—®é¢˜" class="headerlink" title="ç§»æ¤ROSåŒ…æ—¶é‡åˆ°çš„ä¸€ç‚¹å°é—®é¢˜"></a>ç§»æ¤ROSåŒ…æ—¶é‡åˆ°çš„ä¸€ç‚¹å°é—®é¢˜</h3>]]></content>
      
      
      
        <tags>
            
            <tag> STM32 </tag>
            
            <tag> USART </tag>
            
            <tag> ROS </tag>
            
            <tag> Arduino </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/08/16/hello-world/"/>
      <url>/2022/08/16/hello-world/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="0858d2d5afc6e71fe61fde17e264b0ebd81b693504324bd451d5b9fe60576581">fa8b13601bdfbf35c816c536e1c943768052b894c07bef87cfe638eadf1a44fb1aca374ccee2eb92dae6b7862d437c4511b8689b401f36543ccb6ab66f72bf0286c6c052ef4e8c7a2ec491afed06f89a2c56b4c8675715f28bfe32cab7840fb26ae21f1cfad9201fc4ca976f5aa9b30b29f1d26800d88d671ada94dcd875d8b3edda1090b2911a1d9b0f465c5e9f8328c5cd48549be6f19403414d9688c6d62003ad856535e633eae2402819f2e0fc0bdf8686ed677e35bdac33f324558f92229db3f692da7bbac0d4cc6fe244237d3881e12c8f3413ef4e51a472e769d89c70bc4a1ae26a03a319d5b01811e30f63ee79c12b32110cdd2101b75c6de84c17f3be550357902045bf9f10615e4aa9f55c8e71d966ce60f9fed9ad627e1df8514777352c0054f33ed102972e4ca63e300ef09e350027436e85314696b7144fe22e8d4b9320a5ce45aca7f544bcbc99e60530d266d9835f87a6a0a07336f75ef08cbadda7e5b4d92dddf83aaaa1a2db7037efdfa3794b1b40d607fee759f6446124297bf0b0c1433f8089cf9f6bc53d63df6a398686aa826d1d784a5fe38e2b7abed2152e574dbd2a77b8f9bb28c18d34ee1915d33fd7092d81ef13ff30ae5ae174f042c7e083e83964e19562840a378af0c06d5ad47b8a740819d946e83b76d9e47e3b976708c03d087cb82be880643e23d138db94b4a4e7d64d0c03e5433d0dc7a95ccf86b3d1c11381f28a78d145297c943ae497edf7127d4a67bbaae900cd1f4b7237f62636f0080b07800702fd6023bb364450f4213fcbb06015f72d601d721e0fa5f9c65feefbddc6986cf86149c7018c45458bb7d201e63e3d475e9ee2c9643f0e36d3ba5b280f9d915ad8b88a5461af0a4e3a964d3fa4120340b848e62dd1682f6064e325d4abfef05e5b588920474cf8bf5da166c9d2f26a3177670d695aeba543ff6d4970a1cff53bb98490c6e1d7bf50eeb810306cd1919e2766e26ee66828b12168bc41b6fd3c6adb22cac57352a6b18a6dc68cca53ef0749db2b13480543a929b5e1a1439f22b7fe7b367c7088e3a6b9b3fbed26b1590eb01b493c</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">ä¸¾æ¯é‚€æ˜æœˆï¼Œå¯¹å½±æˆä¸‰äººã€‚</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
